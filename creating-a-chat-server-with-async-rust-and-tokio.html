<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="robots" content="index,follow"/><meta property="og:type" content="website"/><meta property="og:site_name" content="YangSoon"/><meta property="twitter:domain" content="yangsoon.github.io"/><meta name="twitter:creator" content="@yangsoonlx"/><meta name="description" content="YangSoon, Cloud Native Developer"/><meta property="og:description" content="YangSoon, Cloud Native Developer"/><meta name="twitter:description" content="YangSoon, Cloud Native Developer"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://yangsoon.github.io/api/social-image?id=1d187551-eeba-418f-a731-1c36497feb57"/><meta property="og:image" content="https://yangsoon.github.io/api/social-image?id=1d187551-eeba-418f-a731-1c36497feb57"/><link rel="canonical" href="https://yangsoon.github.io/creating-a-chat-server-with-async-rust-and-tokio"/><meta property="og:url" content="https://yangsoon.github.io/creating-a-chat-server-with-async-rust-and-tokio"/><meta property="twitter:url" content="https://yangsoon.github.io/creating-a-chat-server-with-async-rust-and-tokio"/><link rel="alternate" type="application/rss+xml" href="https://yangsoon.github.io/feed" title="YangSoon"/><meta property="og:title" content="Creating a Chat Server with async Rust and Tokio"/><meta name="twitter:title" content="Creating a Chat Server with async Rust and Tokio"/><title>Creating a Chat Server with async Rust and Tokio</title><meta name="next-head-count" content="21"/><link rel="shortcut icon" href="/favicon.ico"/><link rel="icon" type="image/png" sizes="32x32" href="favicon.png"/><link rel="manifest" href="/manifest.json"/><link rel="preload" href="/_next/static/css/836d11bb8e359ad4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/836d11bb8e359ad4.css" data-n-g=""/><link rel="preload" href="/_next/static/css/2b86574bdeb08777.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2b86574bdeb08777.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script defer="" src="/_next/static/chunks/358.0027340467b29549.js"></script><script src="/_next/static/chunks/webpack-a6dcf48a0f041c92.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-f08b69bdcc7bbb61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8e82bd9eaafa452a.js" defer=""></script><script src="/_next/static/chunks/391-7e14203f5a9c2431.js" defer=""></script><script src="/_next/static/chunks/642-0bcb6e9f6f395ab6.js" defer=""></script><script src="/_next/static/chunks/pages/%5BpageId%5D-20d41f8a977eeca1.js" defer=""></script><script src="/_next/static/PSg0Acersh2oVT5QAnXcP/_buildManifest.js" defer=""></script><script src="/_next/static/PSg0Acersh2oVT5QAnXcP/_ssgManifest.js" defer=""></script></head><body><script>
/** Inlined version of noflash.js from use-dark-mode */
;(function () {
  var storageKey = 'darkMode'
  var classNameDark = 'dark-mode'
  var classNameLight = 'light-mode'
  function setClassOnDocumentBody(darkMode) {
    document.body.classList.add(darkMode ? classNameDark : classNameLight)
    document.body.classList.remove(darkMode ? classNameLight : classNameDark)
  }
  var preferDarkQuery = '(prefers-color-scheme: dark)'
  var mql = window.matchMedia(preferDarkQuery)
  var supportsColorSchemeQuery = mql.media === preferDarkQuery
  var localStorageTheme = null
  try {
    localStorageTheme = localStorage.getItem(storageKey)
  } catch (err) {}
  var localStorageExists = localStorageTheme !== null
  if (localStorageExists) {
    localStorageTheme = JSON.parse(localStorageTheme)
  }
  // Determine the source of truth
  if (localStorageExists) {
    // source of truth from localStorage
    setClassOnDocumentBody(localStorageTheme)
  } else if (supportsColorSchemeQuery) {
    // source of truth from system
    setClassOnDocumentBody(mql.matches)
    localStorage.setItem(storageKey, mql.matches)
  } else {
    // source of truth from document.body
    var isDarkMode = document.body.classList.contains(classNameDark)
    localStorage.setItem(storageKey, JSON.stringify(isDarkMode))
  }
})();
</script><div id="__next"><div class="notion notion-app light-mode notion-block-1d187551eeba418fa7311c36497feb57"><div class="notion-viewport"></div><div class="notion-frame"><header class="notion-header"><div class="notion-nav-header"><div class="breadcrumbs"><a class="breadcrumb" href="/"><div class="notion-page-icon-inline notion-page-icon-image"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27688%27%20height=%27689%27/%3e"/></span><img alt="yangsoon ‘s blog" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="icon notion-page-icon" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRmoAAABXRUJQVlA4IF4AAABQAgCdASoQABAABUB8JbACdH8AF6kqWZq7wgAA/tFZccfpD5SaLC06Ab1xNlhuQgaC2peDlG2wJ+PIWe8AtNjEYYN+9hybVKfEbmvVGYOWRzw8xmakIGSWE0zkkYAA&quot;)"/><noscript><img alt="yangsoon ‘s blog" src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F37907dd5-3c76-4966-a419-daa027a84972%2FIMG_2189.jpg?table=block&amp;id=72a66971-7cf6-42c2-a252-4439d99d8f44&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="icon notion-page-icon" loading="lazy"/></noscript></span></div><span class="title">yangsoon ‘s blog</span></a></div><div class="notion-nav-header-rhs breadcrumbs"><a href="/about" class="breadcrumb button">About</a><div class="breadcrumb button styles_hidden__7gYve"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M256 48v48m0 320v48m147.08-355.08l-33.94 33.94M142.86 369.14l-33.94 33.94M464 256h-48m-320 0H48m355.08 147.08l-33.94-33.94M142.86 142.86l-33.94-33.94"></path><circle cx="256" cy="256" r="80" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32"></circle></svg></div><div role="button" class="breadcrumb button notion-search-button"><svg class="notion-icon searchIcon" viewBox="0 0 17 17"><path d="M6.78027 13.6729C8.24805 13.6729 9.60156 13.1982 10.709 12.4072L14.875 16.5732C15.0684 16.7666 15.3232 16.8633 15.5957 16.8633C16.167 16.8633 16.5713 16.4238 16.5713 15.8613C16.5713 15.5977 16.4834 15.3516 16.29 15.1582L12.1504 11.0098C13.0205 9.86719 13.5391 8.45215 13.5391 6.91406C13.5391 3.19629 10.498 0.155273 6.78027 0.155273C3.0625 0.155273 0.0214844 3.19629 0.0214844 6.91406C0.0214844 10.6318 3.0625 13.6729 6.78027 13.6729ZM6.78027 12.2139C3.87988 12.2139 1.48047 9.81445 1.48047 6.91406C1.48047 4.01367 3.87988 1.61426 6.78027 1.61426C9.68066 1.61426 12.0801 4.01367 12.0801 6.91406C12.0801 9.81445 9.68066 12.2139 6.78027 12.2139Z"></path></svg></div></div></div></header><div class="notion-page-scroller"><main class="notion-page notion-page-no-cover notion-page-has-icon notion-page-has-image-icon notion-full-page"><div class="notion-page-icon-hero notion-page-icon-image"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27417%27%20height=%27358%27/%3e"/></span><img alt="Creating a Chat Server with async Rust and Tokio" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="notion-page-icon" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRrAAAABXRUJQVlA4WAoAAAAQAAAADwAADQAAQUxQSEsAAAARL6CgbRs2VjQPQrtFROCeDRxFtu1E56Eg7/OewsMTQDj+xRBmJET0fwL4YznGrbzMAHa1A051eUngUG1hvSWUl2pB2asZQLlNwe8AVlA4ID4AAABwAQCdASoQAA4ABUB8JbACdAAAAAD2/+qohg8BEYAHgt5vFv+6fX3I3f/to8r4L4uK/4c2W+7517HLrTQAAA==&quot;)"/><noscript><img alt="Creating a Chat Server with async Rust and Tokio" src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F75364b12-256f-4467-84c4-30b0bb9d6739%2Fchat.png?table=block&amp;id=1d187551-eeba-418f-a731-1c36497feb57&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="notion-page-icon" loading="lazy"/></noscript></span></div><h1 class="notion-title"><b>Creating a Chat Server with async Rust and Tokio</b></h1><div class="notion-page-content notion-page-content-has-aside"><article class="notion-page-content-inner"><figure class="notion-asset-wrapper notion-asset-wrapper-video notion-block-db76dae14efb4537b3d30980385839d8"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;padding-bottom:56.20608899297424%"><link rel="preload" href="https://i.ytimg.com/vi/Iapc-qGTEBQ/hqdefault.jpg" as="image"/><div class="notion-yt-lite notion-asset-object-fit" style="object-fit:contain"><img src="https://i.ytimg.com/vi/Iapc-qGTEBQ/hqdefault.jpg" class="notion-yt-thumbnail" alt="Video preview"/><div class="notion-yt-playbtn"></div></div></div></figure><div class="notion-blank notion-block-9b18acbe961644b886d8038720d0afac"> </div><div class="notion-blank notion-block-4e111a5ed7df41e8944de565aca9f246"> </div><div class="notion-blank notion-block-e14381e8e19c4afa9cb8170dd98d3340"> </div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-rust">use tokio::{
    io::{AsyncBufReadExt, AsyncWriteExt, BufReader},
    net::TcpListener,
    sync::broadcast,
};

#[tokio::main]
async fn main() {
    let listener = TcpListener::bind(&quot;localhost:5555&quot;).await.unwrap();

    println!(&quot;listening at localhost:5555&quot;);

    let (_tx, _rx) = broadcast::channel(10);

    loop {
        let (mut socket, addr) = listener.accept().await.unwrap();
        println!(&quot;hello! {addr} is online&quot;);
        let tx = _tx.clone();
        let mut rx = _tx.subscribe();

        _tx.send((format!(&quot;{} enter chat\n&quot;, addr), addr)).unwrap();

        tokio::spawn(async move {
            let (reader, mut writer) = socket.split();
            let mut reader = BufReader::new(reader);
            let mut line = String::new();

            loop {
                tokio::select! {
                    bytes_read = reader.read_line(&amp;mut line) =&gt; {
                        if bytes_read.unwrap() == 0 {
                            continue;
                        }
                        tx.send((line.clone(), addr)).unwrap();
                    }
                    msg = rx.recv() =&gt; {
                        let (msg_info, msg_addr) = msg.unwrap();
                        if msg_addr != addr {
                            writer.write_all(msg_info.as_bytes()).await.unwrap();
                        }
                    }
                }
            }
        });
    }
}</code></pre><div class="notion-blank notion-block-46b79aaf104b42fe9a728115efa7106c"> </div></article><aside class="notion-aside"></aside></div><div class="styles_comments__YEupF"><div><p>Loading Comments...</p></div></div></main><footer class="styles_footer__RBpyk"><div class="styles_copyright__nhL_k">Copyright 2022 <!-- -->yangsoon</div><div class="styles_settings__GyEhi"></div><div class="styles_social__ptL3p"><a class="styles_twitter__3YoqL" href="https://twitter.com/yangsoonlx" title="Twitter @yangsoonlx" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a class="styles_zhihu__Z7IC7" href="https://zhihu.com/people/yangsoon" title="Zhihu @yangsoon" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z"></path></svg></a><a class="styles_github__0JN7a" href="https://github.com/yangsoon" title="GitHub @yangsoon" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></div></footer></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"site":{"domain":"yangsoon.github.io","name":"YangSoon","rootNotionPageId":"72a669717cf642c2a2524439d99d8f44","rootNotionSpaceId":null,"description":"YangSoon, Cloud Native Developer"},"recordMap":{"block":{"1d187551-eeba-418f-a731-1c36497feb57":{"role":"reader","value":{"id":"1d187551-eeba-418f-a731-1c36497feb57","version":50,"type":"page","properties":{"title":[["Creating a Chat Server with async Rust and Tokio",[["b"]]]]},"content":["db76dae1-4efb-4537-b3d3-0980385839d8","9b18acbe-9616-44b8-86d8-038720d0afac","4e111a5e-d7df-41e8-944d-e565aca9f246","e14381e8-e19c-4afa-9cb8-170dd98d3340","d7bc082c-1917-4214-a7e2-73bbcaebfed0","46b79aaf-104b-42fe-9a72-8115efa7106c"],"format":{"page_icon":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/75364b12-256f-4467-84c4-30b0bb9d6739/chat.png","page_full_width":false,"page_small_text":false},"created_time":1664097405070,"last_edited_time":1664106120000,"parent_id":"72a66971-7cf6-42c2-a252-4439d99d8f44","parent_table":"block","alive":true,"file_ids":["9cee5808-df8f-46b3-8ac6-908b6a765c9c","b195f380-b3ae-4986-ae91-2638fe9e7aad","3ed87066-1c22-44d1-8a68-8aed1813b555","75364b12-256f-4467-84c4-30b0bb9d6739"],"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"72a66971-7cf6-42c2-a252-4439d99d8f44":{"role":"reader","value":{"id":"72a66971-7cf6-42c2-a252-4439d99d8f44","version":406,"type":"page","properties":{"title":[["yangsoon ‘s blog"]]},"content":["8a139bd3-c29e-4248-b950-43841f1b0076","ceb8c970-ebd0-4bb1-bd23-c481ed7fefab","b80b3335-c73f-4e47-a39b-3021b4dc650a","02130a54-428f-4e4b-861c-dcbed7945c3b","020410cb-b4a6-4c00-921d-9145fcf35569","091a74ac-4142-4f28-ba1d-5c9810ccc648","0648cf9f-653b-4a40-8c78-52e3a3add115","46b5fd4b-3050-41cb-90ba-45cf6db1e56a","1807cc1c-60f4-47ca-8eb7-99bbef34b28b","1d187551-eeba-418f-a731-1c36497feb57","3ef701ce-2de7-48a4-bb64-2bd45cae827a","52395b31-1471-4332-8b63-bcf6a19b22bf"],"format":{"page_icon":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/37907dd5-3c76-4966-a419-daa027a84972/IMG_2189.jpg","page_full_width":false,"page_small_text":false,"copied_from_pointer":{"id":"bd32b787-e471-49f3-8941-174a9c6846b6","table":"block","spaceId":"bb9288f4-efb5-417f-bf44-1a79fa04feb1"}},"permissions":[{"role":"editor","type":"user_permission","user_id":"d1805983-7869-451d-bf8b-64135a5d4ee7"},{"role":"reader","type":"public_permission","added_timestamp":1660963691744,"allow_duplicate":false}],"created_time":1660961589760,"last_edited_time":1666534560000,"parent_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6","parent_table":"space","alive":true,"copied_from":"bd32b787-e471-49f3-8941-174a9c6846b6","file_ids":["63e89fe9-f5cd-4414-be0e-53d91aa54fc3","37907dd5-3c76-4966-a419-daa027a84972"],"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"db76dae1-4efb-4537-b3d3-0980385839d8":{"role":"reader","value":{"id":"db76dae1-4efb-4537-b3d3-0980385839d8","version":7,"type":"video","properties":{"source":[["https://www.youtube.com/watch?v=Iapc-qGTEBQ"]]},"format":{"block_width":854,"display_source":"https://www.youtube.com/embed/Iapc-qGTEBQ?feature=oembed","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.5620608899297423,"block_preserve_scale":true},"created_time":1664097480000,"last_edited_time":1664097480000,"parent_id":"1d187551-eeba-418f-a731-1c36497feb57","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"9b18acbe-9616-44b8-86d8-038720d0afac":{"role":"reader","value":{"id":"9b18acbe-9616-44b8-86d8-038720d0afac","version":28,"type":"text","created_time":1664101237138,"last_edited_time":1664106120000,"parent_id":"1d187551-eeba-418f-a731-1c36497feb57","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"4e111a5e-d7df-41e8-944d-e565aca9f246":{"role":"reader","value":{"id":"4e111a5e-d7df-41e8-944d-e565aca9f246","version":2,"type":"text","created_time":1664101237138,"last_edited_time":1664106120000,"parent_id":"1d187551-eeba-418f-a731-1c36497feb57","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"e14381e8-e19c-4afa-9cb8-170dd98d3340":{"role":"reader","value":{"id":"e14381e8-e19c-4afa-9cb8-170dd98d3340","version":2,"type":"text","created_time":1664101237138,"last_edited_time":1664106120000,"parent_id":"1d187551-eeba-418f-a731-1c36497feb57","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"d7bc082c-1917-4214-a7e2-73bbcaebfed0":{"role":"reader","value":{"id":"d7bc082c-1917-4214-a7e2-73bbcaebfed0","version":7,"type":"code","properties":{"title":[["use tokio::{\n    io::{AsyncBufReadExt, AsyncWriteExt, BufReader},\n    net::TcpListener,\n    sync::broadcast,\n};\n\n#[tokio::main]\nasync fn main() {\n    let listener = TcpListener::bind(\"localhost:5555\").await.unwrap();\n\n    println!(\"listening at localhost:5555\");\n\n    let (_tx, _rx) = broadcast::channel(10);\n\n    loop {\n        let (mut socket, addr) = listener.accept().await.unwrap();\n        println!(\"hello! {addr} is online\");\n        let tx = _tx.clone();\n        let mut rx = _tx.subscribe();\n\n        _tx.send((format!(\"{} enter chat\\n\", addr), addr)).unwrap();\n\n        tokio::spawn(async move {\n            let (reader, mut writer) = socket.split();\n            let mut reader = BufReader::new(reader);\n            let mut line = String::new();\n\n            loop {\n                tokio::select! {\n                    bytes_read = reader.read_line(\u0026mut line) =\u003e {\n                        if bytes_read.unwrap() == 0 {\n                            continue;\n                        }\n                        tx.send((line.clone(), addr)).unwrap();\n                    }\n                    msg = rx.recv() =\u003e {\n                        let (msg_info, msg_addr) = msg.unwrap();\n                        if msg_addr != addr {\n                            writer.write_all(msg_info.as_bytes()).await.unwrap();\n                        }\n                    }\n                }\n            }\n        });\n    }\n}"]],"language":[["Rust"]]},"created_time":1664106146418,"last_edited_time":1664106120000,"parent_id":"1d187551-eeba-418f-a731-1c36497feb57","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"46b79aaf-104b-42fe-9a72-8115efa7106c":{"role":"reader","value":{"id":"46b79aaf-104b-42fe-9a72-8115efa7106c","version":4,"type":"text","created_time":1664101200000,"last_edited_time":1664101200000,"parent_id":"1d187551-eeba-418f-a731-1c36497feb57","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"dd2baae1-8900-4073-854b-bdde392d5b36":{"role":"reader","value":{"id":"dd2baae1-8900-4073-854b-bdde392d5b36","version":32,"type":"page","properties":{"title":[["About"]]},"content":["36cdda23-4789-4ff5-8d18-99142f89bec4","770dde4e-b74e-4848-8b48-8b1ce3c111ea","2ca1f27b-da43-46f8-b8c0-ef3e05e583d9"],"permissions":[{"role":"editor","type":"user_permission","user_id":"d1805983-7869-451d-bf8b-64135a5d4ee7"},{"role":"reader","type":"public_permission","added_timestamp":1666532032810}],"created_time":1666531980000,"last_edited_time":1666534500000,"parent_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6","parent_table":"space","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"36cdda23-4789-4ff5-8d18-99142f89bec4":{"role":"reader","value":{"id":"36cdda23-4789-4ff5-8d18-99142f89bec4","version":2,"type":"sub_header","properties":{"title":[["Contact Me"]]},"created_time":1666532023649,"last_edited_time":1666531980000,"parent_id":"dd2baae1-8900-4073-854b-bdde392d5b36","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}}},"collection":{},"collection_view":{},"notion_user":{},"collection_query":{},"signed_urls":{},"preview_images":{"notion.so/image/s3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F75364b12-256f-4467-84c4-30b0bb9d6739%2Fchat.png":{"originalWidth":417,"originalHeight":358,"dataURIBase64":"data:image/webp;base64,UklGRrAAAABXRUJQVlA4WAoAAAAQAAAADwAADQAAQUxQSEsAAAARL6CgbRs2VjQPQrtFROCeDRxFtu1E56Eg7/OewsMTQDj+xRBmJET0fwL4YznGrbzMAHa1A051eUngUG1hvSWUl2pB2asZQLlNwe8AVlA4ID4AAABwAQCdASoQAA4ABUB8JbACdAAAAAD2/+qohg8BEYAHgt5vFv+6fX3I3f/to8r4L4uK/4c2W+7517HLrTQAAA=="},"notion.so/image/s3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F37907dd5-3c76-4966-a419-daa027a84972%2FIMG_2189.jpg":{"originalWidth":688,"originalHeight":689,"dataURIBase64":"data:image/webp;base64,UklGRmoAAABXRUJQVlA4IF4AAABQAgCdASoQABAABUB8JbACdH8AF6kqWZq7wgAA/tFZccfpD5SaLC06Ab1xNlhuQgaC2peDlG2wJ+PIWe8AtNjEYYN+9hybVKfEbmvVGYOWRzw8xmakIGSWE0zkkYAA"}}},"pageId":"1d187551-eeba-418f-a731-1c36497feb57"},"__N_SSG":true},"page":"/[pageId]","query":{"pageId":"creating-a-chat-server-with-async-rust-and-tokio"},"buildId":"PSg0Acersh2oVT5QAnXcP","isFallback":false,"dynamicIds":[3358],"gsp":true,"scriptLoader":[]}</script></body></html>