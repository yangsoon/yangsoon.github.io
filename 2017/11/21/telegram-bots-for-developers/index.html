<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> telegram-bots for developers · yangsoon</title><meta name="description" content="telegram-bots for developers - yangs"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://yangsoon.github.io/atom.xml" title="yangsoon"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/yangsoon" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">telegram-bots for developers</h1><div class="post-info">Nov 21, 2017</div><div class="post-content"><h4 id="写给开发者的telegram-bots介绍文档"><a href="#写给开发者的telegram-bots介绍文档" class="headerlink" title="写给开发者的telegram-bots介绍文档"></a>写给开发者的telegram-bots介绍文档</h4><p>bots是运行在telegram内部的第三方应用。用户可以通过发送消息，命令或者<a href="#inline-mode">内联请求</a>和bots进行交互。开发者可以通过向<a href="https://core.telegram.org/bots/api" target="_blank" rel="noopener">bot API</a>发送HTTPS请求来控制自己的bot。</p>
<a id="more"></a>
<h2 id="我能用bots做什么？"><a href="#我能用bots做什么？" class="headerlink" title="我能用bots做什么？"></a>我能用bots做什么？</h2><p>下面举几个例子，你可以用bot来：</p>
<ul>
<li>获得自定义的新闻和通知。一个机器人可以扮演一个智能新闻的角色，发送你需要的新闻。 如：<a href="https://t.me/TechCrunchBot" target="_blank" rel="noopener">TechCrunch Bot</a></li>
<li>和其他服务集成。一个机器人可以通过联系其他的服务来丰富聊天 如:<a href="https://t.me/gmailbot" target="_blank" rel="noopener">Gmail Bot</a></li>
<li>接受来自telegram用户的付款</li>
<li>创建自定义工具 一个机器人可以为你提供预警，天气预报，格式化文本，翻译，或者其他服务.如: <a href="https://t.me/Bold" target="_blank" rel="noopener">Markdown</a></li>
<li>创建单人多人游戏 一个机器人可以提供丰富的HTML5体验，从简单的街机和解谜游戏到3D射击和实时策略游戏。如:  <a href="https://t.me/gamebot" target="_blank" rel="noopener">GameBot</a></li>
<li>建立社交服务 一个机器人能够将一些寻找共同兴趣爱好的人联系在一起。如:<a href="https://t.me/hotorbot" target="_blank" rel="noopener">HotOrBot</a></li>
<li>或者做一些其他的事情 除了做菜–机器人做的菜非常糟糕(官方吐槽)</li>
</ul>
<h2 id="bots是如何工作的"><a href="#bots是如何工作的" class="headerlink" title="bots是如何工作的?"></a>bots是如何工作的?</h2><p>Telegram Bots是一个特别的账号并不需要另外的手机号码去创建，用户可以通过下面两种方式和机器人交互。</p>
<ol>
<li>创建和bots的聊天并发送消息和命令或者将机器人加入聊天群。这对聊天机器人和官方新闻机器人很有用。</li>
<li>直接在输入框中键入<code>@username query</code>来发送请求。这样可以通过内联机器人直接发送内容到任何的聊天，群或者频道。</li>
</ol>
<p>用户发送的消息，命令，和请求被转发给运行在你服务上的应用。我们的中介服务器帮你处理消息的加密和telegram api的通讯。你可以通过简单的HTTPS接口(我们提供了Telegram API的简化版本)和服务通讯。我们把这个接口称为Bot API。</p>
<blockquote>
<p>有关Bot API的详细说明，请参阅 <a href="https://core.telegram.org/bots/api" target="_blank" rel="noopener">bots api</a></p>
</blockquote>
<h2 id="我怎么创建一个bot"><a href="#我怎么创建一个bot" class="headerlink" title="我怎么创建一个bot?"></a>我怎么创建一个bot?</h2><p>我们提供一个bot来帮助你创建bot，你可以直接和<a href="https://telegram.me/botfather" target="_blank" rel="noopener">BotFather</a>交谈，并按照几个简单的步骤就可以创建一个属于自己的bot。一旦你创建了一个bot并获取到你的authorization token，那就直接去查看<a href="https://core.telegram.org/bots/api" target="_blank" rel="noopener">Bot API</a>手册看看你能操作机器人做什么事情</p>
<blockquote>
<p>你也可以查看一些 <strong> <a href="https://core.telegram.org/bots/samples" target="_blank" rel="noopener">示例代码</a> </strong></p>
</blockquote>
<h2 id="bot和普通账号有什么不同"><a href="#bot和普通账号有什么不同" class="headerlink" title="bot和普通账号有什么不同?"></a>bot和普通账号有什么不同?</h2><ul>
<li>Bots没有在线状态和last seen时间戳，界面只显示bot标签</li>
<li>Bots有云存储限制-较旧的消息可能在服务器处理后不久被删除</li>
<li>Bots无法主动与用户交流。用户必须将bot添加到群组中或者先给bot发送消息。其他人可以使用<code>telegram.me/&lt;bot_username&gt;</code>链接或者username来找到你的bot。</li>
<li>Bot的username总是以’bot’结尾。</li>
<li>当bot被加入群中，它默认不会接受所有消息。</li>
<li>机器人不需要吃饭，睡觉或者抱怨(除非程序中有设定) <strong> 又是官方吐槽 </strong></li>
</ul>
<h2 id="与众不同的Bot"><a href="#与众不同的Bot" class="headerlink" title="与众不同的Bot"></a>与众不同的Bot</h2><p>Telegram bots在很多方面都与众不同 – 我们提供两种样式的键盘以及提供对默认指令、深层链接以及文本格式等的额外接口。</p>
<h4 id="内联模式"><a href="#内联模式" class="headerlink" title="内联模式"></a>内联模式</h4><p>用户可以在任意聊天的输入框中通过输入内联请求和你的bot进行交互。只需在输入框中以你的bot命开头并输入请求即可。<br>收到查询后，您的机器人可以返回一些结果。一旦用户点击其中一个，它就发送到用户当前打开的聊天。通过这种方式，人们可以通过任何聊天，小组或频道向您的机器人请求内容。<br>你可以使用<a href="https://telegram.me/sticker" target="_blank" rel="noopener">@sticker</a>来体验一下。</p>
<blockquote>
<p>关于<a href="https://core.telegram.org/bots/inline" target="_blank" rel="noopener">内联模式</a>的更多信息</p>
</blockquote>
<h4 id="付款平台"><a href="#付款平台" class="headerlink" title="付款平台"></a><a href="https://core.telegram.org/bots#payments-platform" target="_blank" rel="noopener">付款平台</a></h4><h4 id="游戏平台"><a href="#游戏平台" class="headerlink" title="游戏平台"></a><a href="https://core.telegram.org/bots#gaming-platform" target="_blank" rel="noopener">游戏平台</a></h4><h4 id="键盘"><a href="#键盘" class="headerlink" title="键盘"></a>键盘</h4><p>传统的机器人当然可以被教会理解人类的语言。但是有时候你想从用户那里获得更加正式的输入–因此我们提供了自定义键盘。</p>
<p>每当你的机器人发送一条消息，它会传递一个特定的键盘与预定义的答复选项(请参阅<a href="https://core.telegram.org/bots/api/#replykeyboardmarkup" target="_blank" rel="noopener">ReplyKeyboardMarkup</a>)，telegram会接收到消息并将你设定的键盘展示给用户。点击任何按钮将立即发送相应的命令。这样你可以大大简化用户与你的机器人交互。</p>
<blockquote>
<p>有关自定义键盘的更多信息，请查阅<a href="https://core.telegram.org/bots/api" target="_blank" rel="noopener">Bot API</a>的<a href="https://core.telegram.org/bots/api#sendmessage" target="_blank" rel="noopener">sendMessage</a>部分。</p>
</blockquote>
<h4 id="内联键盘和即时更新"><a href="#内联键盘和即时更新" class="headerlink" title="内联键盘和即时更新"></a>内联键盘和即时更新</h4><p>有时候用户更喜欢可以不发送消息也能做一些事情。比如，当你的用户正在改变设置或翻阅搜索结果，在这种情况，你可以直接将内联键盘附加到所属的消息中。与自定义回复键盘不同，点击内联键盘上的按钮不会发送消息到当前聊天中。内联键盘支持按钮在后台工作，比如：callback buttons, URL buttons 和switch to inline buttons。</p>
<p>当使用回调按钮时，你的bot可以更新已经存在的消息(或者只是这些消息附加的键盘)所以这样能够保持聊天界面的整洁。你可以查看这些机器人的内联键盘的功能:<a href="https://telegram.me/music" target="_blank" rel="noopener">@music</a>、<a href="https://telegram.me/vote" target="_blank" rel="noopener">@vote</a>。</p>
<blockquote>
<p><a href="https://core.telegram.org/bots/2-0-intro#new-inline-keyboards" target="_blank" rel="noopener">了解更多关于内联键盘和即时编辑的信息 &gt;&gt;</a></p>
</blockquote>
<h4 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h4><p>命令提供了一个更灵活的方式与您的机器人进行通信。可以使用下面的语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/command [optional] [argument]</div></pre></td></tr></table></figure></p>
<p>每个命令必须以‘/’开头且不能超过32个字符，命令可以使用拉丁字母，数字和下划线。下面是几个示例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/get_messages_stats</div><div class="line">/set_timer 10min Alarm!</div><div class="line">/get_timezone London, UK</div></pre></td></tr></table></figure></p>
<p>以斜线开头的消息总是被发送给机器人。telegram 将会这样处理:</p>
<ul>
<li>当用户输入‘/’时，将会出现带有相应描述的命令提示(开发者提供给botFather相应的命令列表)。点击列表中的命令会立即发送命令。</li>
<li>在和机器人的所有聊天的输入字段中显示一个额外的（/）按钮。点击它键入一个“/”并显示命令列表。</li>
<li>在消息中将命令高亮显示，当用户点击突出显示的命令时，立即发送该命令。</li>
</ul>
<p>如果多个机器人在一个组中，可以将bot用户名添加到命令中以避免混淆:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/start@TriviaBot</div><div class="line">/start@ApocalypseBot</div></pre></td></tr></table></figure></p>
<p>这是通过建议列表选择命令时自动完成的，请记住你的bot需要能够处理跟在username后的指令。</p>
<h4 id="全局命令"><a href="#全局命令" class="headerlink" title="全局命令"></a>全局命令</h4><p>为了使所有的用户能够轻松应对各种bots的使用，我们要求开发者必须实现几个基础命令。telegram将会在界面中为这几个基础指令提供相应的快捷键。</p>
<ul>
<li><strong><em> / start </em></strong>  - bots开始和用户交互，例如发送一个欢迎的消息。这个指令同样可以传递几个额外的参数给bot。</li>
<li><strong><em> / help </em></strong> - 返回一个帮助消息。</li>
<li><strong><em> / setting </em></strong> - (如果适用的话)将会返回给用户机器人设定，显示可以编辑设置的指令。</li>
</ul>
<p>用户在第一次打开与您的机器人的对话时将看到一个start按钮。在机器人的配置菜单中有help和setting的链接。</p>
<h4 id="隐私模式"><a href="#隐私模式" class="headerlink" title="隐私模式"></a>隐私模式</h4><p>bots经常被加入到组中来加强人与人之间的沟通。例如通过提供新闻，来自外部服务的通知或其他搜索功能。特别是那些工作聊天组。现在当你与bot共享一个组时，你会问问自己，我怎么能够保证这个小流氓(bot)不会将我的历史记录泄露给竞争对手呢？答案就是-隐私模式。<br>运行在隐私模式下的bot不会收到所有发送给该组的消息。相反，它只会收到：</p>
<ul>
<li>命令</li>
<li>回复机器人自己的消息</li>
<li>服务消息(人员的添加和删减)</li>
<li>来自频道的消息</li>
</ul>
<p>一方面，这有助于我们一些人在晚上更好地睡觉; 另一方面，它允许机器人开发人员节省大量的资源，因为他们每天不需要处理数以万计的不相关的消息。</p>
<p>所有的bots默认启用隐私模式，除了被加入组中当做管理员的bot(bot admin)总是收到所有的消息)它可以被禁用，以便机器人像普通用户一样接收所有消息。如果不必要，我们建议你不要这样做。用户可以随时在组成员列表中查看机器人的当前隐私设置。在大多数情况下，使用机器人消息的<a href="https://core.telegram.org/bots/api#forcereply" target="_blank" rel="noopener">强制回复</a>选项应该是绰绰有余的。</p>
<p><a href="https://core.telegram.org/bots/faq#what-messages-will-my-bot-get" target="_blank" rel="noopener">那么我的bot究竟会收到什么样的信息呢？&gt;&gt;</a></p>
<h4 id="深层链接"><a href="#深层链接" class="headerlink" title="深层链接"></a><a href="https://en.wikipedia.org/wiki/Deep_linking" target="_blank" rel="noopener">深层链接</a></h4><p>百度百科中对deeplink有下面这样的描述</p>
<blockquote>
<p>移动端深度链接 是指在移动端网页或应用内输入搜索结果，可以链接到手机内安装的其他应用。</p>
</blockquote>
<p>telegram bots有深层链接机制，允许在启动时将其他参数传递给机器人，这可能是一个启动机器人的命令，或者是一个身份验证令牌将用户的telegram帐户连接到某个外部服务上的帐户。</p>
<p>每个bot都有一个在telegram打开一个对话的链接。<code>https://telegram.me/&lt;bot username&gt;</code>您可以将参数start或startgroup添加到此链接，参数值最多为64个字符。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://telegram.me/triviabot?startgroup=test</div></pre></td></tr></table></figure>
<p><code>A-Z</code>,<code>a-z</code>,<code>0-9</code>,<code>_</code>和<code>-</code>都可以使用。我们建议使用base64url编码参数与二进制和其他类型的内容。</p>
<p>点击带有启动参数的链接将打开与bot的一对一对话，在输入栏位显示一个START按钮。如果使用startgroup参数，则会提示用户选择要添加机器人的组。一旦用户进行了确认(点击START按钮或者选择了一个组加入bot)，你的机器人将以这种格式接收一个来自该用户的消息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/start PAYLOAD</div></pre></td></tr></table></figure>
<p><code>PAYLOAD</code>表示链接中传递的start或startgroup参数的值。</p>
<h4 id="深层链接示例"><a href="#深层链接示例" class="headerlink" title="深层链接示例"></a>深层链接示例</h4><p>假设网站example.com希望通过bot向用户发送通知。以下是他们为ID<code>123</code>用户开启通知进行的操作。</p>
<ol>
<li>创建一个有合适名字的bot，例如 @ExampleComBot</li>
</ol>
</div></article></div></main><footer><div class="paginator"><a href="/2017/11/11/mpi读书笔记-2/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2017 <a href="https://yangsoon.github.io">yangs</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>