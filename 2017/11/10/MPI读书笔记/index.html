<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> MPI读书笔记 · yangsoon</title><meta name="description" content="MPI读书笔记 - yangs"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://yangsoon.github.io/atom.xml" title="yangsoon"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/yangsoon" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">MPI读书笔记</h1><div class="post-info">Nov 10, 2017</div><div class="post-content"><h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><p>确认研究方向是并行计算之后，却一直没有认真接触。从开学到现在这段时间都在看一些无关紧要的东西，像<a href="https://cn.vuejs.org/" target="_blank" rel="external">vuejs</a>把官方文档过了一遍；<a href="https://book.douban.com/subject/27028517/" target="_blank" rel="external">《流畅的python》</a>也看了一多半，感觉确实写的很nice；接触了python web异步框架<a href="https://tornado-zh.readthedocs.io/zh/latest/#" target="_blank" rel="external">tornado</a>。最近用vue全家桶(<a href="https://cn.vuejs.org/" target="_blank" rel="external">vuejs</a>、<a href="https://router.vuejs.org/zh-cn/" target="_blank" rel="external">vue-router</a>、<a href="https://vuex.vuejs.org/zh-cn/" target="_blank" rel="external">vuex</a>)和<a href="https://tornado-zh.readthedocs.io/zh/latest/#" target="_blank" rel="external">tornado</a>写了一些东西，关于这部分准备以后写篇文章来记录下。近期要开始毕设选题了，北航的学长帮我想了一个和并行计算相关的课题。也推荐了<a href="https://book.douban.com/subject/1244566/" target="_blank" rel="external">《高性能计算-并行编程技术》</a>当做入门书籍。这篇文章就当一个学习笔记，记录mpi一些相关的知识点。后期准备将每个章节出现的代码都用c重新实现一遍。</p>
<a id="more"></a>
<h1 id="并行计算基础"><a href="#并行计算基础" class="headerlink" title="并行计算基础"></a>并行计算基础</h1><h2 id="第1章-并行计算机"><a href="#第1章-并行计算机" class="headerlink" title="第1章-并行计算机"></a>第1章-并行计算机</h2><p>并行计算机即在同一时间执行多条指令(或处理多个数据)的计算机，并行计算机是并行计算的物理载体。</p>
<ul>
<li>根据并行计算机能同时执行指令和数据的多少分为 SIMD(单指令多数据)和MIMD(多指令多数据)</li>
<li>根据执行程序和数据的不同分为SPMD(单程序多数据)和MPMD(多程序多数据)</li>
<li>从存储方式上可以分为共享内存、分布式内存、分布式共享内存并行计算机</li>
</ul>
<h2 id="第2章-并行编程模行与并行语言-amp-amp-第3章-并行算法"><a href="#第2章-并行编程模行与并行语言-amp-amp-第3章-并行算法" class="headerlink" title="第2章-并行编程模行与并行语言&amp;&amp;第3章-并行算法"></a>第2章-并行编程模行与并行语言&amp;&amp;第3章-并行算法</h2><h1 id="基本MPI程序设计"><a href="#基本MPI程序设计" class="headerlink" title="基本MPI程序设计"></a>基本MPI程序设计</h1><h2 id="第4章-MPI简介"><a href="#第4章-MPI简介" class="headerlink" title="第4章-MPI简介"></a>第4章-MPI简介</h2><p>1.MPI是一个库，而不是一门语言。<br>2.MPI是一种规范或标准的代表，不特指某一个对它的具体实现。<br>3.MPI是一种消息传递编程模型。</p>
<h2 id="第5章-第一个MPI程序"><a href="#第5章-第一个MPI程序" class="headerlink" title="第5章-第一个MPI程序"></a>第5章-第一个MPI程序</h2><p>下面演示第一个mpi程序的编写和运行结果。后面解释mpi的api。</p>
<blockquote>
<p><code>hello.c</code></p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> myid, numprocs;</div><div class="line">	<span class="keyword">int</span> namelen;</div><div class="line">	<span class="keyword">char</span> processor_name[MPI_MAX_PROCESSOR_NAME];</div><div class="line"></div><div class="line">	MPI_Init(&amp;argc, &amp;argv);</div><div class="line">	MPI_Comm_rank(MPI_COMM_WORLD, &amp;myid);</div><div class="line">	MPI_Comm_size(MPI_COMM_WORLD, &amp;numprocs);</div><div class="line">	MPI_Get_processor_name(processor_name, &amp;namelen);</div><div class="line"></div><div class="line">	<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Hello World! Process %d of %d on %s\n"</span>, myid, numprocs, processor_name);</div><div class="line"></div><div class="line">	MPI_Finalize();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>执行</p>
<blockquote>
<p><code>mpicc -o hello hello.c</code><br><code>mpirun -n 2 hello</code>(跑在本地2核处理器见谅见谅)</p>
</blockquote>
<p>结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Hello World! Process 1 of 2 on promote.cache-dns.local</div><div class="line">Hello World! Process 0 of 2 on promote.cache-dns.local</div></pre></td></tr></table></figure>
<h2 id="第6章-六个接口构成的MPI子集"><a href="#第6章-六个接口构成的MPI子集" class="headerlink" title="第6章-六个接口构成的MPI子集"></a>第6章-六个接口构成的MPI子集</h2><h4 id="子集介绍"><a href="#子集介绍" class="headerlink" title="子集介绍"></a>子集介绍</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">初始化mpi</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">MPI_Init</span><span class="params">(<span class="keyword">int</span> *argc, <span class="keyword">char</span>***argv)</span></span></div><div class="line">MPI结束 </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">MPI_Finalize</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">当前进程标识 </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">MPI_Comm_rank</span><span class="params">(MPI_Comm comm, <span class="keyword">int</span> *rank)</span></span></div><div class="line">通信域包含的进程数  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">MPI_Comm_size</span><span class="params">(MPI_Comm comm, <span class="keyword">int</span> *size)</span></span></div><div class="line">消息发送 </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">MPI_Send</span><span class="params">(<span class="keyword">void</span>* buff, <span class="keyword">int</span> count, MPI_Datatype datatype, <span class="keyword">int</span> dest, <span class="keyword">int</span> tag, MPI_Comm comm)</span></span></div><div class="line">消息接收 </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">MPI_Recv</span><span class="params">(<span class="keyword">void</span>* buff, <span class="keyword">int</span> count, MPI_Datatype datatype, <span class="keyword">int</span> source, <span class="keyword">int</span> tag, MPI_Comm comm, MPI_Status *status)</span></span></div></pre></td></tr></table></figure>
<h4 id="参数介绍"><a href="#参数介绍" class="headerlink" title="参数介绍"></a>参数介绍</h4><blockquote>
<p><code>MPI_Comm_rank</code></p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MPI_Comm comm 			该进程所在的通信域(句柄)</div><div class="line"><span class="keyword">int</span> *rank     			调用进程在comm中的标识号</div></pre></td></tr></table></figure>
<blockquote>
<p><code>int MPI_Comm_size</code></p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> *size     通信域comm内包含的进程数</div></pre></td></tr></table></figure>
<blockquote>
<p><code>MPI_Send</code></p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span>* buf                  			发送缓冲区的起始地址(可选类型)</div><div class="line"><span class="keyword">int</span> count                  			将发送的数据个数(非负整数)</div><div class="line">MPI_Datatype datatype      			发送数据的数据类型(句柄)</div><div class="line"><span class="keyword">int</span> dest                   			目的进程的标识号(整型)</div><div class="line"><span class="keyword">int</span> tag                    			消息标志(整型)</div></pre></td></tr></table></figure>
<blockquote>
<p><code>MPI_Recv</code></p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span>* buf                  			接收缓冲区的起始地址(可选类型)</div><div class="line"><span class="keyword">int</span> count                  			最多可接受的数据个数(非负整数)</div><div class="line">MPI_Datatype datatype      			接收数据的数据类型(句柄)</div><div class="line"><span class="keyword">int</span> dest                   			接收数据来源进程的标识号(整型)</div><div class="line"><span class="keyword">int</span> tag                    			消息标志(整型)</div><div class="line"><span class="keyword">int</span> *status                			返回状态(状态类型)</div><div class="line">MPI_Status status &#123; MPI_SOURCE, MPI_TAG, MPI_ERROR &#125;</div></pre></td></tr></table></figure>
<h4 id="一个简单的接收和发送的例子"><a href="#一个简单的接收和发送的例子" class="headerlink" title="一个简单的接收和发送的例子"></a>一个简单的接收和发送的例子</h4><blockquote>
<p><code>example1.c</code></p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mpi.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</div><div class="line">    <span class="keyword">char</span> message[<span class="number">20</span>];</div><div class="line">    <span class="keyword">int</span> myrank;</div><div class="line">    <span class="keyword">int</span> number;</div><div class="line">    MPI_Status status;</div><div class="line"></div><div class="line">    <span class="comment">// MPI程序初始化</span></div><div class="line">    MPI_Init(&amp;argc, &amp;argv);</div><div class="line">    <span class="comment">// 得到当前进程的标识</span></div><div class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;myrank);</div><div class="line">    <span class="comment">// 得到通信域下的进程数</span></div><div class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;number);</div><div class="line">    <span class="comment">// 进程0发送消息给进程1</span></div><div class="line">    <span class="keyword">if</span> (myrank == <span class="number">0</span>) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"mpi size:%d\n"</span>, number);</div><div class="line">        <span class="built_in">strcpy</span>(message, <span class="string">"Hello,process 1"</span>);</div><div class="line">        MPI_Send(message, <span class="built_in">strlen</span>(message), MPI_CHAR, <span class="number">1</span>, <span class="number">99</span>, MPI_COMM_WORLD);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"process%d send: %s -&gt; process 1\n"</span>, myrank, message);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 进程1接收来自进程0的消息</span></div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(myrank == <span class="number">1</span>) &#123;</div><div class="line">        MPI_Recv(message, <span class="number">20</span>, MPI_CHAR, <span class="number">0</span>, <span class="number">99</span>, MPI_COMM_WORLD, &amp;status);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"process%d recived: %s &lt;- process 0\n"</span> ,myrank ,message);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"status-&gt;MPI_SOURCE:%d\n"</span>, status.MPI_SOURCE);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"status-&gt;MPI_TAG:%d\n"</span>, status.MPI_TAG);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"status-&gt;MPI_ERROR:%d\n"</span>, status.MPI_ERROR);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 结束</span></div><div class="line">    MPI_Finalize();</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mpi size:2</div><div class="line">process0 send: Hello,process 1 -&gt; process 1</div><div class="line">process1 recived: Hello,process 1 &lt;- process 0</div><div class="line">status-&gt;MPI_SOURCE:0</div><div class="line">status-&gt;MPI_TAG:99</div><div class="line">status-&gt;MPI_ERROR:0</div></pre></td></tr></table></figure></p>
<h4 id="mpi消息组成"><a href="#mpi消息组成" class="headerlink" title="mpi消息组成"></a>mpi消息组成</h4></div></article></div></main><footer><div class="paginator"><a href="/2017/10/01/vagrant开发遇到的坑/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="https://yangsoon.github.io">yangs</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>