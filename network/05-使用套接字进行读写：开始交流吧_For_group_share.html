<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>05-ä½¿ç”¨å¥—æ¥å­—è¿›è¡Œè¯»å†™ï¼šå¼€å§‹äº¤æµå§</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
        html {
            color: #333;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-rendering: optimizelegibility;
            font-family: Helvetica Neue, PingFang SC, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif
        }

        html.borderbox *,
        html.borderbox :after,
        html.borderbox :before {
            box-sizing: border-box
        }

        article,
        aside,
        blockquote,
        body,
        button,
        code,
        dd,
        details,
        dl,
        dt,
        fieldset,
        figcaption,
        figure,
        footer,
        form,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        header,
        hr,
        input,
        legend,
        li,
        menu,
        nav,
        ol,
        p,
        pre,
        section,
        td,
        textarea,
        th,
        ul {
            margin: 0;
            padding: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        menu,
        nav,
        section {
            display: block
        }

        audio,
        canvas,
        video {
            display: inline-block
        }

        body,
        button,
        input,
        select,
        textarea {
            font: 300 1em/1.8 PingFang SC, Lantinghei SC, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, Helvetica, sans-serif
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            padding: 0;
            border: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        fieldset,
        img {
            border: 0
        }

        blockquote {
            position: relative;
            color: #999;
            font-weight: 400;
            border-left: 1px solid #1abc9c;
            padding-left: 1em;
            margin: 1em 3em 1em 2em
        }

        @media only screen and (max-width: 640px) {
            blockquote {
                margin: 1em 0
            }
        }

        abbr,
        acronym {
            border-bottom: 1px dotted;
            font-variant: normal
        }

        abbr {
            cursor: help
        }

        del {
            text-decoration: line-through
        }

        address,
        caption,
        cite,
        code,
        dfn,
        em,
        th,
        var {
            font-style: normal;
            font-weight: 400
        }

        ol,
        ul {
            list-style: none
        }

        caption,
        th {
            text-align: left
        }

        q:after,
        q:before {
            content: ""
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative
        }

        :root sub,
        :root sup {
            vertical-align: baseline
        }

        sup {
            top: -.5em
        }

        sub {
            bottom: -.25em
        }

        a {
            color: #1abc9c
        }

        a:hover {
            text-decoration: underline
        }

        .typo a {
            border-bottom: 1px solid #1abc9c
        }

        .typo a:hover {
            border-bottom-color: #555;
            color: #555
        }

        .typo a:hover,
        a,
        ins {
            text-decoration: none
        }

        .typo-u,
        u {
            text-decoration: underline
        }

        mark {
            background: #fffdd1;
            border-bottom: 1px solid #ffedce;
            padding: 2px;
            margin: 0 5px
        }

        code,
        pre,
        pre tt {
            font-family: Courier, Courier New, monospace
        }

        pre {
            background: hsla(0, 0%, 97%, .7);
            border: 1px solid #ddd;
            padding: 1em 1.5em;
            display: block;
            -webkit-overflow-scrolling: touch
        }

        hr {
            border: none;
            border-bottom: 1px solid #cfcfcf;
            margin-bottom: .8em;
            height: 10px
        }

        .typo-small,
        figcaption,
        small {
            font-size: .9em;
            color: #888
        }

        b,
        strong {
            font-weight: 700;
            color: #000
        }

        [draggable] {
            cursor: move
        }

        .clearfix:after,
        .clearfix:before {
            content: "";
            display: table
        }

        .clearfix:after {
            clear: both
        }

        .clearfix {
            zoom: 1
        }

        .textwrap,
        .textwrap td,
        .textwrap th {
            word-wrap: break-word;
            word-break: break-all
        }

        .textwrap-table {
            table-layout: fixed
        }

        .serif {
            font-family: Palatino, Optima, Georgia, serif
        }

        .typo-dl,
        .typo-form,
        .typo-hr,
        .typo-ol,
        .typo-p,
        .typo-pre,
        .typo-table,
        .typo-ul,
        .typo dl,
        .typo form,
        .typo hr,
        .typo ol,
        .typo p,
        .typo pre,
        .typo table,
        .typo ul,
        blockquote {
            margin-bottom: 1rem
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: PingFang SC, Helvetica Neue, Verdana, Microsoft Yahei, Hiragino Sans GB, Microsoft Sans Serif, WenQuanYi Micro Hei, sans-serif;
            color: #000;
            line-height: 1.35
        }

        .typo-h1,
        .typo-h2,
        .typo-h3,
        .typo-h4,
        .typo-h5,
        .typo-h6,
        .typo h1,
        .typo h2,
        .typo h3,
        .typo h4,
        .typo h5,
        .typo h6 {
            margin-top: 1.2em;
            margin-bottom: .6em;
            line-height: 1.35
        }

        .typo-h1,
        .typo h1 {
            font-size: 2em
        }

        .typo-h2,
        .typo h2 {
            font-size: 1.8em
        }

        .typo-h3,
        .typo h3 {
            font-size: 1.6em
        }

        .typo-h4,
        .typo h4 {
            font-size: 1.4em
        }

        .typo-h5,
        .typo-h6,
        .typo h5,
        .typo h6 {
            font-size: 1.2em
        }

        .typo-ul,
        .typo ul {
            margin-left: 1.3em;
            list-style: disc
        }

        .typo-ol,
        .typo ol {
            list-style: decimal;
            margin-left: 1.9em
        }

        .typo-ol ol,
        .typo-ol ul,
        .typo-ul ol,
        .typo-ul ul,
        .typo li ol,
        .typo li ul {
            margin-bottom: .8em;
            margin-left: 2em
        }

        .typo-ol ul,
        .typo-ul ul,
        .typo li ul {
            list-style: circle
        }

        .typo-table td,
        .typo-table th,
        .typo table caption,
        .typo table td,
        .typo table th {
            border: 1px solid #ddd;
            padding: .5em 1em;
            color: #666
        }

        .typo-table th,
        .typo table th {
            background: #fbfbfb
        }

        .typo-table thead th,
        .typo table thead th {
            background: hsla(0, 0%, 95%, .7)
        }

        .typo table caption {
            border-bottom: none
        }

        .typo-input,
        .typo-textarea {
            -webkit-appearance: none;
            border-radius: 0
        }

        .typo-em,
        .typo em,
        caption,
        legend {
            color: #000;
            font-weight: inherit
        }

        .typo-em {
            position: relative
        }

        .typo-em:after {
            position: absolute;
            top: .65em;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            content: "\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"
        }

        .typo img {
            max-width: 100%
        }

        .common-content {
            font-weight: 400;
            color: #353535;
            line-height: 1.75rem;
            white-space: normal;
            word-break: normal;
            font-size: 1rem
        }

        .common-content img {
            display: block;
            max-width: 100%;
            background-color: #eee
        }

        .common-content audio,
        .common-content video {
            width: 100%;
            background-color: #eee
        }

        .common-content center,
        .common-content font {
            margin-top: 1rem;
            display: inline-block
        }

        .common-content center {
            width: 100%
        }

        .common-content pre {
            margin-top: 1rem;
            padding-left: 0;
            padding-right: 0;
            position: relative;
            overflow: hidden
        }

        .common-content pre code {
            font-size: .8rem;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            width: 100%;
            box-sizing: border-box;
            padding-left: 1rem;
            padding-right: 1rem;
            overflow-x: auto
        }

        .common-content hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        .common-content b,
        .common-content h1,
        .common-content h2,
        .common-content h3,
        .common-content h4,
        .common-content h5,
        .common-content strong {
            font-weight: 700
        }

        .common-content h1,
        .common-content h2 {
            font-size: 1.125rem;
            margin-bottom: .45rem
        }

        .common-content h3,
        .common-content h4,
        .common-content h5 {
            font-size: 1rem;
            margin-bottom: .45rem
        }

        .common-content p {
            font-weight: 400;
            color: #353535;
            margin-top: .15rem
        }

        .common-content .orange {
            color: #ff5a05
        }

        .common-content .reference {
            font-size: 1rem;
            color: #888
        }

        .custom-rich-content h1 {
            margin-top: 0;
            font-weight: 400;
            font-size: 15.25px;
            border-bottom: 1px solid #eee;
            line-height: 2.8
        }

        .custom-rich-content li,
        .custom-rich-content p {
            font-size: 14px;
            color: #888;
            line-height: 1.6
        }

        table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        table.hljs-ln,
        table.hljs-ln tbody,
        table.hljs-ln td,
        table.hljs-ln tr {
            box-sizing: border-box
        }

        table.hljs-ln td {
            padding: 0;
            border: 0
        }

        table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            user-select: none
        }

        table.hljs-ln td.hljs-ln-code,
        table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            font-size: 12px;
            line-height: 20px;
            vertical-align: top
        }

        table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            color: #24292e;
            word-wrap: normal;
            white-space: pre
        }

        video::-webkit-media-controls {
            overflow: hidden !important
        }

        video::-webkit-media-controls-enclosure {
            width: calc(100% + 32px);
            margin-left: auto
        }

        ._29HP61GA_0 {
            max-width:800px;
            margin:0 auto;
            margin-bottom: 20px;
            font-weight: 400;
            color: #353535;
            line-height: 1.76;
            white-space: normal;
            word-break: normal;
            font-size: 17px;
            -webkit-transition: background-color .3s ease;
            transition: background-color .3s ease
        }

        ._29HP61GA_0 .MathJax_Display {
            overflow: auto
        }

        ._29HP61GA_0 .poster {
            position: fixed;
            left: -10000px;
            top: -10000px;
            overflow: hidden;
            padding: 1rem;
            background: #ececec
        }

        ._29HP61GA_0 .richcontent-pre-copy {
            font-size: 13px;
            color: #888;
            position: absolute;
            right: 1em;
            top: .5em;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 .richcontent-pre-copy .iconfont {
            font-size: 12px;
            margin-right: .2em
        }

        ._29HP61GA_0 a {
            color: #fa8919;
            border-bottom: 1px solid #fa8919
        }

        ._29HP61GA_0 img {
            display: block;
            max-width: 100%;
            position: relative;
            left: 50%;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
            background-color: #eee;
            vertical-align: top;
            border-radius: 0
        }

        ._29HP61GA_0 audio,
        ._29HP61GA_0 video {
            width: 100%;
            background-color: #eee
        }

        ._29HP61GA_0 pre {
            margin-top: 16px;
            padding: 34px 0 0;
            margin-bottom: 30px;
            position: relative;
            border-radius: 6px;
            background: rgba(246, 247, 251, .749);
            border: 0
        }

        ._29HP61GA_0 pre code {
            font-size: 12px;
            font-family: Consolas, Liberation Mono, Menlo, monospace, Courier;
            display: block;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            margin-left: 16px;
            margin-right: 16px;
            overflow-x: scroll
        }

        ._29HP61GA_0 pre code:after {
            content: "";
            height: 30px;
            width: 100%;
            display: block
        }

        ._29HP61GA_0 hr {
            border: none;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-top: 1px solid #f5f5f5;
            height: 1px;
            background: none
        }

        ._29HP61GA_0 h1,
        ._29HP61GA_0 h2,
        ._29HP61GA_0 h3,
        ._29HP61GA_0 h4,
        ._29HP61GA_0 h5 {
            margin-bottom: 20px;
            margin-top: 0;
            font-weight: 700
        }

        ._29HP61GA_0 b,
        ._29HP61GA_0 strong {
            font-weight: 700
        }

        ._29HP61GA_0 h1 {
            font-size: 21px
        }

        ._29HP61GA_0 h2 {
            font-size: 20px
        }

        ._29HP61GA_0 h3 {
            font-size: 19px
        }

        ._29HP61GA_0 h4 {
            font-size: 18px
        }

        ._29HP61GA_0 h5 {
            font-size: 17px
        }

        ._29HP61GA_0 center,
        ._29HP61GA_0 p {
            font-weight: 400;
            color: #353535;
            margin-top: 0;
            margin-bottom: 30px;
            word-break: break-word
        }

        ._29HP61GA_0 center {
            text-align: center
        }

        ._29HP61GA_0 blockquote {
            margin-top: 0;
            margin-bottom: 34px;
            border-left: 3px solid #e8e8e8;
            padding-left: 17px;
            color: #353535
        }

        ._29HP61GA_0 blockquote p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol,
        ._29HP61GA_0 ul {
            margin-bottom: 30px
        }

        ._29HP61GA_0 ol p,
        ._29HP61GA_0 ul p {
            margin-top: 0;
            margin-bottom: 0
        }

        ._29HP61GA_0 ol {
            list-style: decimal;
            margin-left: 20px
        }

        ._29HP61GA_0 ul li {
            padding-left: 17px;
            position: relative;
            margin-bottom: 10px
        }

        ._29HP61GA_0 ul li:after {
            content: "";
            height: 6px;
            width: 6px;
            border-radius: 50%;
            background: #353535;
            position: absolute;
            top: 10px;
            left: 0
        }

        ._29HP61GA_0 .orange {
            color: #fa8919
        }

        ._29HP61GA_0 .reference {
            color: #888
        }

        ._29HP61GA_0 .m-right {
            text-align: right
        }

        ._29HP61GA_0 .m-center {
            text-align: center;
            display: block
        }

        ._29HP61GA_0 .m-gray {
            color: #888
        }

        ._29HP61GA_0 .m-small {
            font-size: 15px
        }

        ._29HP61GA_0 table.hljs-ln {
            margin-bottom: 0;
            border-spacing: 0;
            border-collapse: collapse
        }

        ._29HP61GA_0 table.hljs-ln,
        ._29HP61GA_0 table.hljs-ln tbody,
        ._29HP61GA_0 table.hljs-ln td,
        ._29HP61GA_0 table.hljs-ln tr {
            -webkit-box-sizing: border-box;
            box-sizing: border-box
        }

        ._29HP61GA_0 table.hljs-ln td {
            padding: 0;
            border: 0
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            min-width: 15px;
            font-size: 12px;
            color: rgba(27, 31, 35, .3);
            text-align: right;
            white-space: nowrap;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code,
        ._29HP61GA_0 table.hljs-ln td.hljs-ln-numbers {
            font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, Courier, monospace;
            line-height: 20px;
            vertical-align: top
        }

        ._29HP61GA_0 table.hljs-ln td.hljs-ln-code {
            position: relative;
            padding-right: 10px;
            padding-left: 10px;
            overflow: visible;
            font-size: 13px;
            color: #666;
            word-wrap: normal;
            white-space: pre
        }

    </style>
</head>
<body>
<div class="_29HP61GA_0">
<h1>05-ä½¿ç”¨å¥—æ¥å­—è¿›è¡Œè¯»å†™ï¼šå¼€å§‹äº¤æµå§</h1>
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç››å»¶æ•ï¼Œè¿™é‡Œæ˜¯ç½‘ç»œç¼–ç¨‹å®æˆ˜ç¬¬5è®²ï¼Œæ¬¢è¿å›æ¥ã€‚</p><p>åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®²è¿°äº†å¥—æ¥å­—ç›¸å…³çš„çŸ¥è¯†ï¼ŒåŒ…æ‹¬å¥—æ¥å­—çš„æ ¼å¼ï¼Œå¥—æ¥å­—çš„åˆ›å»ºä»¥åŠTCPè¿æ¥çš„å»ºç«‹ç­‰ã€‚åœ¨è¿™ä¸€è®²é‡Œï¼Œæˆ‘æ¥è®²ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨åˆ›å»ºçš„å¥—æ¥å­—æ”¶å‘æ•°æ®ã€‚</p><p>è¿æ¥å»ºç«‹çš„æ ¹æœ¬ç›®çš„æ˜¯ä¸ºäº†æ•°æ®çš„æ”¶å‘ã€‚æ‹¿æˆ‘ä»¬å¸¸ç”¨çš„ç½‘è´­åœºæ™¯ä¸¾ä¾‹å­ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå•†å“æˆ–è€…è´­ä¹°è´§å“çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šå¯Ÿè§‰åˆ°ç½‘ç»œè¿æ¥çš„å­˜åœ¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœŸåˆ‡æ„Ÿè§‰åˆ°æ•°æ®åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æœ‰æ•ˆçš„ä¼ é€ï¼Œ æ¯”å¦‚æµè§ˆå•†å“æ—¶å•†å“ä¿¡æ¯çš„ä¸æ–­åˆ·æ–°ï¼Œè´­ä¹°è´§å“æ—¶æ˜¾ç¤ºè´­ä¹°æˆåŠŸçš„æ¶ˆæ¯ç­‰ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å‘é€æ•°æ®ã€‚</p><h2>å‘é€æ•°æ®</h2><p>å‘é€æ•°æ®æ—¶å¸¸ç”¨çš„æœ‰ä¸‰ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯writeã€sendå’Œsendmsgã€‚</p><pre><code>ssize_t write (int socketfd, const void *buffer, size_t size)
ssize_t send (int socketfd, const void *buffer, size_t size, int flags)
ssize_t sendmsg(int sockfd, const struct msghdr *msg, int flags)
</code></pre><p>æ¯ä¸ªå‡½æ•°éƒ½æ˜¯å•ç‹¬ä½¿ç”¨çš„ï¼Œä½¿ç”¨çš„åœºæ™¯ç•¥æœ‰ä¸åŒï¼š</p><p>ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯å¸¸è§çš„æ–‡ä»¶å†™å‡½æ•°ï¼Œå¦‚æœæŠŠsocketfdæ¢æˆæ–‡ä»¶æè¿°ç¬¦ï¼Œå°±æ˜¯æ™®é€šçš„æ–‡ä»¶å†™å…¥ã€‚</p><p>å¦‚æœæƒ³æŒ‡å®šé€‰é¡¹ï¼Œå‘é€å¸¦å¤–æ•°æ®ï¼Œå°±éœ€è¦ä½¿ç”¨ç¬¬äºŒä¸ªå¸¦flagçš„å‡½æ•°ã€‚æ‰€è°“å¸¦å¤–æ•°æ®ï¼Œæ˜¯ä¸€ç§åŸºäºTCPåè®®çš„ç´§æ€¥æ•°æ®ï¼Œç”¨äºå®¢æˆ·ç«¯-æœåŠ¡å™¨åœ¨ç‰¹å®šåœºæ™¯ä¸‹çš„ç´§æ€¥å¤„ç†ã€‚</p><p>å¦‚æœæƒ³æŒ‡å®šå¤šé‡ç¼“å†²åŒºä¼ è¾“æ•°æ®ï¼Œå°±éœ€è¦ä½¿ç”¨ç¬¬ä¸‰ä¸ªå‡½æ•°ï¼Œä»¥ç»“æ„ä½“msghdrçš„æ–¹å¼å‘é€æ•°æ®ã€‚</p><p>ä½ çœ‹åˆ°è¿™é‡Œå¯èƒ½ä¼šé—®ï¼Œæ—¢ç„¶å¥—æ¥å­—æè¿°ç¬¦æ˜¯ä¸€ç§ç‰¹æ®Šçš„æè¿°ç¬¦ï¼Œé‚£ä¹ˆåœ¨å¥—æ¥å­—æè¿°ç¬¦ä¸Šè°ƒç”¨writeå‡½æ•°ï¼Œåº”è¯¥å’Œåœ¨æ™®é€šæ–‡ä»¶æè¿°ç¬¦ä¸Šè°ƒç”¨writeå‡½æ•°çš„è¡Œä¸ºæ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯é€šè¿‡æè¿°ç¬¦å¥æŸ„å†™å…¥æŒ‡å®šçš„æ•°æ®ã€‚</p><!-- [[[read_end]]] --><p>ä¹ä¸€çœ‹ï¼Œä¸¤è€…çš„è¡¨ç°å½¢å¼æ˜¯ä¸€æ ·ï¼Œå†…åœ¨çš„åŒºåˆ«è¿˜æ˜¯å¾ˆä¸ä¸€æ ·çš„ã€‚</p><p>å¯¹äºæ™®é€šæ–‡ä»¶æè¿°ç¬¦è€Œè¨€ï¼Œä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ä»£è¡¨äº†æ‰“å¼€çš„ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œé€šè¿‡è°ƒç”¨writeå‡½æ•°ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸å¸®æˆ‘ä»¬ä¸æ–­åœ°å¾€æ–‡ä»¶ç³»ç»Ÿä¸­å†™å…¥å­—èŠ‚æµã€‚æ³¨æ„ï¼Œå†™å…¥çš„å­—èŠ‚æµå¤§å°é€šå¸¸å’Œè¾“å…¥å‚æ•°sizeçš„å€¼æ˜¯ç›¸åŒçš„ï¼Œå¦åˆ™è¡¨ç¤ºå‡ºé”™ã€‚</p><p>å¯¹äºå¥—æ¥å­—æè¿°ç¬¦è€Œè¨€ï¼Œå®ƒä»£è¡¨äº†ä¸€ä¸ªåŒå‘è¿æ¥ï¼Œåœ¨å¥—æ¥å­—æè¿°ç¬¦ä¸Šè°ƒç”¨writeå†™å…¥çš„å­—èŠ‚æ•°<strong>æœ‰å¯èƒ½</strong>æ¯”è¯·æ±‚çš„æ•°é‡å°‘ï¼Œè¿™åœ¨æ™®é€šæ–‡ä»¶æè¿°ç¬¦æƒ…å†µä¸‹æ˜¯ä¸æ­£å¸¸çš„ã€‚</p><p>äº§ç”Ÿè¿™ä¸ªç°è±¡çš„åŸå› åœ¨äºæ“ä½œç³»ç»Ÿå†…æ ¸ä¸ºè¯»å–å’Œå‘é€æ•°æ®åšäº†å¾ˆå¤šæˆ‘ä»¬è¡¨é¢ä¸Šçœ‹ä¸åˆ°çš„å·¥ä½œã€‚æ¥ä¸‹æ¥æˆ‘æ‹¿writeå‡½æ•°ä¸¾ä¾‹ï¼Œé‡ç‚¹é˜è¿°å‘é€ç¼“å†²åŒºçš„æ¦‚å¿µã€‚</p><h3>å‘é€ç¼“å†²åŒº</h3><p>ä½ ä¸€å®šè¦å»ºç«‹ä¸€ä¸ªæ¦‚å¿µï¼Œå½“TCPä¸‰æ¬¡æ¡æ‰‹æˆåŠŸï¼ŒTCPè¿æ¥æˆåŠŸå»ºç«‹åï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¼šä¸ºæ¯ä¸€ä¸ªè¿æ¥åˆ›å»ºé…å¥—çš„åŸºç¡€è®¾æ–½ï¼Œæ¯”å¦‚<strong>å‘é€ç¼“å†²åŒº</strong>ã€‚</p><p>å‘é€ç¼“å†²åŒºçš„å¤§å°å¯ä»¥é€šè¿‡å¥—æ¥å­—é€‰é¡¹æ¥æ”¹å˜ï¼Œå½“æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè°ƒç”¨writeå‡½æ•°æ—¶ï¼Œå®é™…æ‰€åšçš„äº‹æƒ…æ˜¯æŠŠæ•°æ®<strong>ä»åº”ç”¨ç¨‹åºä¸­æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„å‘é€ç¼“å†²åŒºä¸­</strong>ï¼Œå¹¶ä¸ä¸€å®šæ˜¯æŠŠæ•°æ®é€šè¿‡å¥—æ¥å­—å†™å‡ºå»ã€‚</p><p>è¿™é‡Œæœ‰å‡ ç§æƒ…å†µï¼š</p><p>ç¬¬ä¸€ç§æƒ…å†µå¾ˆç®€å•ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸çš„å‘é€ç¼“å†²åŒºè¶³å¤Ÿå¤§ï¼Œå¯ä»¥ç›´æ¥å®¹çº³è¿™ä»½æ•°æ®ï¼Œé‚£ä¹ˆçš†å¤§æ¬¢å–œï¼Œæˆ‘ä»¬çš„ç¨‹åºä»writeè°ƒç”¨ä¸­é€€å‡ºï¼Œè¿”å›å†™å…¥çš„å­—èŠ‚æ•°å°±æ˜¯åº”ç”¨ç¨‹åºçš„æ•°æ®å¤§å°ã€‚</p><p>ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸çš„å‘é€ç¼“å†²åŒºæ˜¯å¤Ÿå¤§äº†ï¼Œä¸è¿‡è¿˜æœ‰æ•°æ®æ²¡æœ‰å‘é€å®Œï¼Œæˆ–è€…æ•°æ®å‘é€å®Œäº†ï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸çš„å‘é€ç¼“å†²åŒºä¸è¶³ä»¥å®¹çº³åº”ç”¨ç¨‹åºæ•°æ®ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ é¢„æ–™çš„ç»“æœæ˜¯ä»€ä¹ˆå‘¢ï¼ŸæŠ¥é”™ï¼Ÿè¿˜æ˜¯ç›´æ¥è¿”å›ï¼Ÿ</p><p>æ“ä½œç³»ç»Ÿå†…æ ¸å¹¶ä¸ä¼šè¿”å›ï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯åº”ç”¨ç¨‹åºè¢«é˜»å¡ï¼Œä¹Ÿå°±æ˜¯è¯´åº”ç”¨ç¨‹åºåœ¨writeå‡½æ•°è°ƒç”¨å¤„åœç•™ï¼Œä¸ç›´æ¥è¿”å›ã€‚æœ¯è¯­â€œæŒ‚èµ·â€ä¹Ÿè¡¨è¾¾äº†ç›¸åŒçš„æ„æ€ï¼Œä¸è¿‡â€œæŒ‚èµ·â€æ˜¯ä»æ“ä½œç³»ç»Ÿå†…æ ¸è§’åº¦æ¥è¯´çš„ã€‚</p><p>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™æ‰ä¼šè¿”å›å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œæ¯ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸çš„å¤„ç†æ˜¯ä¸åŒçš„ã€‚å¤§éƒ¨åˆ†UNIXç³»ç»Ÿçš„åšæ³•æ˜¯ä¸€ç›´ç­‰åˆ°å¯ä»¥æŠŠåº”ç”¨ç¨‹åºæ•°æ®å®Œå…¨æ”¾åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„å‘é€ç¼“å†²åŒºä¸­ï¼Œå†ä»ç³»ç»Ÿè°ƒç”¨ä¸­è¿”å›ã€‚æ€ä¹ˆç†è§£å‘¢ï¼Ÿ</p><p>åˆ«å¿˜äº†ï¼Œæˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿå†…æ ¸æ˜¯å¾ˆèªæ˜çš„ï¼Œå½“TCPè¿æ¥å»ºç«‹ä¹‹åï¼Œå®ƒå°±å¼€å§‹è¿ä½œèµ·æ¥ã€‚ä½ å¯ä»¥æŠŠå‘é€ç¼“å†²åŒºæƒ³è±¡æˆä¸€æ¡åŒ…è£¹æµæ°´çº¿ï¼Œæœ‰ä¸ªèªæ˜ä¸”å¿™ç¢Œçš„å·¥äººä¸æ–­åœ°ä»æµæ°´çº¿ä¸Šå–å‡ºåŒ…è£¹ï¼ˆæ•°æ®ï¼‰ï¼Œè¿™ä¸ªå·¥äººä¼šæŒ‰ç…§TCP/IPçš„è¯­ä¹‰ï¼Œå°†å–å‡ºçš„åŒ…è£¹ï¼ˆæ•°æ®ï¼‰å°è£…æˆTCPçš„MSSåŒ…ï¼Œä»¥åŠIPçš„MTUåŒ…ï¼Œæœ€åèµ°æ•°æ®é“¾è·¯å±‚å°†æ•°æ®å‘é€å‡ºå»ã€‚è¿™æ ·æˆ‘ä»¬çš„å‘é€ç¼“å†²åŒºå°±åˆç©ºäº†ä¸€éƒ¨åˆ†ï¼Œäºæ˜¯åˆå¯ä»¥ç»§ç»­ä»åº”ç”¨ç¨‹åºæ¬ä¸€éƒ¨åˆ†æ•°æ®åˆ°å‘é€ç¼“å†²åŒºé‡Œï¼Œè¿™æ ·ä¸€ç›´è¿›è¡Œä¸‹å»ï¼Œåˆ°æŸä¸€ä¸ªæ—¶åˆ»ï¼Œåº”ç”¨ç¨‹åºçš„æ•°æ®å¯ä»¥å®Œå…¨æ”¾ç½®åˆ°å‘é€ç¼“å†²åŒºé‡Œã€‚åœ¨è¿™ä¸ªæ—¶å€™ï¼Œwriteé˜»å¡è°ƒç”¨è¿”å›ã€‚æ³¨æ„è¿”å›çš„æ—¶åˆ»ï¼Œåº”ç”¨ç¨‹åºæ•°æ®å¹¶æ²¡æœ‰å…¨éƒ¨è¢«å‘é€å‡ºå»ï¼Œå‘é€ç¼“å†²åŒºé‡Œè¿˜æœ‰éƒ¨åˆ†æ•°æ®ï¼Œè¿™éƒ¨åˆ†æ•°æ®ä¼šåœ¨ç¨åç”±æ“ä½œç³»ç»Ÿå†…æ ¸é€šè¿‡ç½‘ç»œå‘é€å‡ºå»ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/fd/dc/fdcdc766c6a6ebb7fbf15bb2d1e58bdc.png" alt=""></p><h2>è¯»å–æ•°æ®</h2><p>æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼Œå¥—æ¥å­—æè¿°æœ¬èº«å’Œæœ¬åœ°æ–‡ä»¶æè¿°ç¬¦å¹¶æ— åŒºåˆ«ï¼Œ<strong>åœ¨UNIXçš„ä¸–ç•Œé‡Œä¸‡ç‰©éƒ½æ˜¯æ–‡ä»¶</strong>ï¼Œè¿™å°±æ„å‘³ç€å¯ä»¥å°†å¥—æ¥å­—æè¿°ç¬¦ä¼ é€’ç»™é‚£äº›åŸå…ˆä¸ºå¤„ç†æœ¬åœ°æ–‡ä»¶è€Œè®¾è®¡çš„å‡½æ•°ã€‚è¿™äº›å‡½æ•°åŒ…æ‹¬readå’Œwriteäº¤æ¢æ•°æ®çš„å‡½æ•°ã€‚</p><h3>readå‡½æ•°</h3><p>è®©æˆ‘ä»¬å…ˆä»æœ€ç®€å•çš„readå‡½æ•°å¼€å§‹çœ‹èµ·ï¼Œè¿™ä¸ªå‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼š</p><pre><code>ssize_t read (int socketfd, void *buffer, size_t size)
</code></pre><p>readå‡½æ•°è¦æ±‚æ“ä½œç³»ç»Ÿå†…æ ¸ä»å¥—æ¥å­—æè¿°å­—socketfd<strong>è¯»å–æœ€å¤šå¤šå°‘ä¸ªå­—èŠ‚ï¼ˆsizeï¼‰ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°bufferä¸­ã€‚è¿”å›å€¼å‘Šè¯‰æˆ‘ä»¬å®é™…è¯»å–çš„å­—èŠ‚æ•°ç›®ï¼Œä¹Ÿæœ‰ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œå¦‚æœè¿”å›å€¼ä¸º0ï¼Œè¡¨ç¤ºEOFï¼ˆend-of-fileï¼‰ï¼Œè¿™åœ¨ç½‘ç»œä¸­è¡¨ç¤ºå¯¹ç«¯å‘é€äº†FINåŒ…ï¼Œè¦å¤„ç†æ–­è¿çš„æƒ…å†µ</strong>ï¼›å¦‚æœè¿”å›å€¼ä¸º-1ï¼Œè¡¨ç¤ºå‡ºé”™ã€‚å½“ç„¶ï¼Œå¦‚æœæ˜¯éé˜»å¡I/Oï¼Œæƒ…å†µä¼šç•¥æœ‰ä¸åŒï¼Œåœ¨åé¢çš„æé«˜ç¯‡ä¸­æˆ‘ä»¬ä¼šé‡ç‚¹è®²è¿°éé˜»å¡I/Oçš„ç‰¹ç‚¹ã€‚</p><p>æ³¨æ„è¿™é‡Œæ˜¯æœ€å¤šè¯»å–sizeä¸ªå­—èŠ‚ã€‚å¦‚æœæˆ‘ä»¬æƒ³è®©åº”ç”¨ç¨‹åºæ¯æ¬¡éƒ½è¯»åˆ°sizeä¸ªå­—èŠ‚ï¼Œå°±éœ€è¦ç¼–å†™ä¸‹é¢çš„å‡½æ•°ï¼Œä¸æ–­åœ°å¾ªç¯è¯»å–ã€‚</p><pre><code>/* ä»socketfdæè¿°å­—ä¸­è¯»å–&quot;size&quot;ä¸ªå­—èŠ‚. */
ssize_t readn(int fd, void *vptr, size_t size)
{
    size_t  nleft;
    ssize_t nread;
    char    *ptr;

    ptr = vptr;
    nleft = size;
    
    while (nleft &gt; 0) {
        if ( (nread = read(fd, ptr, nleft)) &lt; 0) {
            if (errno == EINTR)
                nread = 0;      /* è¿™é‡Œéœ€è¦å†æ¬¡è°ƒç”¨read */
            else
                return(-1);
        } else if (nread == 0)
            break;              /* EOF(End of File)è¡¨ç¤ºå¥—æ¥å­—å…³é—­ */


        nleft -= nread;
        ptr   += nread;
    }
    return(n - nleft);      /* è¿”å›çš„æ˜¯å®é™…è¯»å–çš„å­—èŠ‚æ•°*/
}
</code></pre><p>å¯¹è¿™ä¸ªç¨‹åºç¨å¾®è§£é‡Šä¸‹ï¼š</p><ul>
<li>11-25è¡Œçš„å¾ªç¯æ¡ä»¶è¡¨ç¤ºçš„æ˜¯ï¼Œåœ¨æ²¡è¯»æ»¡sizeä¸ªå­—èŠ‚ä¹‹å‰ï¼Œä¸€ç›´éƒ½è¦å¾ªç¯ä¸‹å»ã€‚</li>
<li>13-14è¡Œè¡¨ç¤ºçš„æ˜¯éé˜»å¡I/Oçš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰æ•°æ®å¯ä»¥è¯»ï¼Œéœ€è¦ç»§ç»­è°ƒç”¨readã€‚</li>
<li>17-18è¡Œè¡¨ç¤ºè¯»åˆ°å¯¹æ–¹å‘å‡ºçš„FINåŒ…ï¼Œè¡¨ç°å½¢å¼æ˜¯EOFï¼Œæ­¤æ—¶éœ€è¦å…³é—­å¥—æ¥å­—ã€‚</li>
<li>21-22è¡Œï¼Œéœ€è¦è¯»å–çš„å­—ç¬¦æ•°å‡å°‘ï¼Œç¼“å­˜æŒ‡é’ˆå¾€ä¸‹ç§»åŠ¨ã€‚</li>
<li>24è¡Œæ˜¯åœ¨è¯»å–EOFè·³å‡ºå¾ªç¯åï¼Œè¿”å›å®é™…è¯»å–çš„å­—ç¬¦æ•°ã€‚</li>
</ul><h2>ç¼“å†²åŒºå®éªŒ</h2><p>æˆ‘ä»¬ç”¨ä¸€ä¸ªå®¢æˆ·ç«¯-æœåŠ¡å™¨çš„ä¾‹å­æ¥è§£é‡Šä¸€ä¸‹è¯»å–ç¼“å†²åŒºå’Œå‘é€ç¼“å†²åŒºçš„æ¦‚å¿µã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­å®¢æˆ·ç«¯ä¸æ–­åœ°å‘é€æ•°æ®ï¼ŒæœåŠ¡å™¨ç«¯æ¯è¯»å–ä¸€æ®µæ•°æ®ä¹‹åè¿›è¡Œä¼‘çœ ï¼Œä»¥æ¨¡æ‹Ÿå®é™…ä¸šåŠ¡å¤„ç†æ‰€éœ€è¦çš„æ—¶é—´ã€‚</p><h3>æœåŠ¡å™¨ç«¯è¯»å–æ•°æ®ç¨‹åº</h3><p>ä¸‹é¢æ˜¯æœåŠ¡å™¨ç«¯è¯»å–æ•°æ®çš„ç¨‹åºï¼š</p><pre><code>int main(int argc, char **argv)
{
    int                 listenfd, connfd;
    socklen_t           clilen;
    struct sockaddr_in  cliaddr, servaddr;

    listenfd = socket(AF_INET, SOCK_STREAM, 0);

    bzero(&amp;servaddr, sizeof(servaddr));
    servaddr.sin_family      = AF_INET;
    servaddr.sin_addr.s_addr = htonl(INADDR_ANY);
    servaddr.sin_port        = htons(12345);

    /* bindåˆ°æœ¬åœ°åœ°å€ï¼Œç«¯å£ä¸º12345 */ 
    bind(listenfd, (SA *) &amp;servaddr, sizeof(servaddr));
    /* listençš„backlogä¸º1024 */
    listen(listenfd, 1024);

    /* å¾ªç¯å¤„ç†ç”¨æˆ·è¯·æ±‚ */
    for ( ; ; ) {
        clilen = sizeof(cliaddr);
        connfd = accept(listenfd, (SA *) &amp;cliaddr, &amp;clilen);
        read_data(connfd);   /* è¯»å–æ•°æ® */
        close(connfd);          /* å…³é—­è¿æ¥å¥—æ¥å­—ï¼Œæ³¨æ„ä¸æ˜¯ç›‘å¬å¥—æ¥å­—*/
    }
}

void read_data(int sockfd)
{
    ssize_t  n;
    char buf[1024];

    int time = 0;
    for ( ; ; ) {
        fprintf(stdout, &quot;block in read\n&quot;);
        if ( (n = Readn(sockfd, buf, 1024)) == 0)
            return;     /* connection closed by other end */

        time ++;
        fprintf(stdout, &quot;1K read for %d \n&quot;, time);
        usleep(1000);
    }
}
</code></pre><p>å¯¹æœåŠ¡å™¨ç«¯ç¨‹åºè§£é‡Šå¦‚ä¸‹ï¼š</p><ul>
<li>6-17è¡Œå…ˆååˆ›å»ºäº†socketå¥—æ¥å­—ï¼Œbindåˆ°å¯¹åº”åœ°å€å’Œç«¯å£ï¼Œå¹¶å¼€å§‹è°ƒç”¨listenæ¥å£ç›‘å¬ã€‚</li>
<li>20-25è¡Œå¾ªç¯ç­‰å¾…è¿æ¥ï¼Œé€šè¿‡acceptè·å–å®é™…çš„è¿æ¥ï¼Œå¹¶å¼€å§‹è¯»å–æ•°æ®ã€‚</li>
<li>28-42è¡Œå®é™…æ¯æ¬¡è¯»å–1Kæ•°æ®ï¼Œä¹‹åä¼‘çœ 1ç§’ï¼Œç”¨æ¥æ¨¡æ‹ŸæœåŠ¡å™¨ç«¯å¤„ç†æ—¶å»¶ã€‚</li>
</ul><h3>å®¢æˆ·ç«¯å‘é€æ•°æ®ç¨‹åº</h3><p>ä¸‹é¢æ˜¯å®¢æˆ·ç«¯å‘é€æ•°æ®çš„ç¨‹åºï¼š</p><pre><code>int main(int argc, char **argv)
{
    int                 sockfd;
    struct sockaddr_in  servaddr;

    if (argc != 2)
        err_quit(&quot;usage: tcpclient &lt;IPaddress&gt;&quot;);

    sockfd = socket(AF_INET, SOCK_STREAM, 0);

    bzero(&amp;servaddr, sizeof(servaddr));
    servaddr.sin_family = AF_INET;
    servaddr.sin_port = htons(SERV_PORT);
    inet_pton(AF_INET, argv[1], &amp;servaddr.sin_addr);
    connect(sockfd, (SA *) &amp;servaddr, sizeof(servaddr));
    send_data(stdin, sockfd);
    exit(0);
}

# define MESSAGE_SIZE 10240000
void send_data(FILE *fp, int sockfd)
{
    char * query;
    query = malloc(MESSAGE_SIZE+1);
    for(int i=0; i&lt; MESSAGE_SIZE; i++){
        query[i] = 'a';
    }
    query[MESSAGE_SIZE] = '\0';

    const char *cp;
    cp = query;
    remaining = strlen(query);
    while (remaining) {
      n_written = send(sockfd, cp, remaining, 0);
      fprintf(stdout, &quot;send into buffer %ld \n&quot;, n_written);
      if (n_written &lt;= 0) {
        perror(&quot;send&quot;);
        return;
      }
      remaining -= n_written;
      cp += n_written;
    }

    return;
}
</code></pre><p>å¯¹å®¢æˆ·ç«¯ç¨‹åºè§£é‡Šå¦‚ä¸‹ï¼š</p><ul>
<li>9-15è¡Œå…ˆååˆ›å»ºäº†socketå¥—æ¥å­—ï¼Œè°ƒç”¨connectå‘å¯¹åº”æœåŠ¡å™¨ç«¯å‘èµ·è¿æ¥è¯·æ±‚ã€‚</li>
<li>16è¡Œåœ¨è¿æ¥å»ºç«‹æˆåŠŸåï¼Œè°ƒç”¨send_dataå‘é€æ•°æ®ã€‚</li>
<li>23-28è¡Œåˆå§‹åŒ–äº†ä¸€ä¸ªé•¿åº¦ä¸ºMESSAGE_SIZEçš„å­—ç¬¦ä¸²æµã€‚</li>
<li>33-42è¡Œè°ƒç”¨sendå‡½æ•°å°†MESSAGE_SIZEé•¿åº¦çš„å­—ç¬¦ä¸²æµå‘é€å‡ºå»ã€‚</li>
</ul><h3>å®éªŒä¸€: è§‚å¯Ÿå®¢æˆ·ç«¯æ•°æ®å‘é€è¡Œä¸º</h3><p>å®¢æˆ·ç«¯ç¨‹åºå‘é€äº†ä¸€ä¸ªå¾ˆå¤§çš„å­—èŠ‚æµï¼Œç¨‹åºè¿è¡Œèµ·æ¥ä¹‹åï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æœåŠ¡ç«¯ä¸æ–­åœ°åœ¨å±å¹•ä¸Šæ‰“å°å‡ºè¯»å–å­—èŠ‚æµçš„è¿‡ç¨‹ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/ca/58/ca86fcf0254a76e61e68259a79446c58.png" alt=""><br>
è€Œå®¢æˆ·ç«¯ç›´åˆ°æœ€åæ‰€æœ‰çš„å­—èŠ‚æµå‘é€å®Œæ¯•æ‰æ‰“å°å‡ºä¸‹é¢çš„ä¸€å¥è¯ï¼Œè¯´æ˜åœ¨æ­¤ä¹‹å‰sendå‡½æ•°ä¸€ç›´éƒ½æ˜¯é˜»å¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>é˜»å¡å¼å¥—æ¥å­—æœ€ç»ˆå‘é€è¿”å›çš„å®é™…å†™å…¥å­—èŠ‚æ•°å’Œè¯·æ±‚å­—èŠ‚æ•°æ˜¯ç›¸ç­‰çš„ã€‚</strong></p><p>è€Œå…³äºéé˜»å¡å¥—æ¥å­—çš„æ“ä½œï¼Œæˆ‘ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­è®²è§£ã€‚</p><h3>å®éªŒäºŒ: æœåŠ¡ç«¯å¤„ç†å˜æ…¢</h3><p>å¦‚æœæˆ‘ä»¬æŠŠæœåŠ¡ç«¯çš„ä¼‘çœ æ—¶é—´ç¨å¾®è°ƒå¤§ï¼ŒæŠŠå®¢æˆ·ç«¯å‘é€çš„å­—èŠ‚æ•°ä»ä»10240000è°ƒæ•´ä¸º1024000ï¼Œå†æ¬¡è¿è¡Œåˆšæ‰çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œå®¢æˆ·ç«¯å¾ˆå¿«æ‰“å°å‡ºä¸€å¥è¯ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/50/d8/500739df57e9bc668cb4dce392e14bd8.png" alt=""><br>
ä½†ä¸æ­¤åŒæ—¶ï¼ŒæœåŠ¡ç«¯è¯»å–ç¨‹åºè¿˜åœ¨å±å¹•ä¸Šä¸æ–­æ‰“å°è¯»å–æ•°æ®çš„è¿›åº¦ï¼Œæ˜¾ç¤ºå‡ºæœåŠ¡ç«¯è¯»å–ç¨‹åºè¿˜åœ¨è¾›è‹¦åœ°ä»ç¼“å†²åŒºä¸­è¯»å–æ•°æ®ã€‚</p><p>é€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘æƒ³å†æ¬¡å¼ºè°ƒä¸€ä¸‹ï¼š</p><p><strong>å‘é€æˆåŠŸä»…ä»…è¡¨ç¤ºçš„æ˜¯æ•°æ®è¢«æ‹·è´åˆ°äº†å‘é€ç¼“å†²åŒºä¸­ï¼Œå¹¶ä¸æ„å‘³ç€è¿æ¥å¯¹ç«¯å·²ç»æ”¶åˆ°æ‰€æœ‰çš„æ•°æ®ã€‚è‡³äºä»€ä¹ˆæ—¶å€™å‘é€åˆ°å¯¹ç«¯çš„æ¥æ”¶ç¼“å†²åŒºï¼Œæˆ–è€…æ›´è¿›ä¸€æ­¥è¯´ï¼Œä»€ä¹ˆæ—¶å€™è¢«å¯¹æ–¹åº”ç”¨ç¨‹åºç¼“å†²æ‰€æ¥æ”¶ï¼Œå¯¹æˆ‘ä»¬è€Œè¨€å®Œå…¨éƒ½æ˜¯é€æ˜çš„ã€‚</strong></p><h2>æ€»ç»“</h2><p>è¿™ä¸€è®²é‡ç‚¹è®²è¿°äº†é€šè¿‡sendå’Œreadæ¥æ”¶å‘æ•°æ®åŒ…ï¼Œä½ éœ€è¦ç‰¢è®°ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ul>
<li>å¯¹äºsendæ¥è¯´ï¼Œè¿”å›æˆåŠŸä»…ä»…è¡¨ç¤ºæ•°æ®å†™åˆ°å‘é€ç¼“å†²åŒºæˆåŠŸï¼Œå¹¶ä¸è¡¨ç¤ºå¯¹ç«¯å·²ç»æˆåŠŸæ”¶åˆ°ã€‚</li>
<li>å¯¹äºreadæ¥è¯´ï¼Œéœ€è¦å¾ªç¯è¯»å–æ•°æ®ï¼Œå¹¶ä¸”éœ€è¦è€ƒè™‘EOFç­‰å¼‚å¸¸æ¡ä»¶ã€‚</li>
</ul><h2>æ€è€ƒé¢˜</h2><p>æœ€åä½ ä¸å¦¨æ€è€ƒä¸€ä¸‹ï¼Œæ—¢ç„¶ç¼“å†²åŒºå¦‚æ­¤é‡è¦ï¼Œæˆ‘ä»¬å¯ä¸å¯ä»¥æŠŠç¼“å†²åŒºæå¾—å¤§å¤§çš„ï¼Œè¿™æ ·ä¸å°±å¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„ååé‡äº†ä¹ˆï¼Ÿä½ å¯ä»¥æƒ³ä¸€æƒ³è¿™ä¸ªæ–¹æ³•å¯è¡Œå—ï¼Ÿå¦å¤–ä½ å¯ä»¥è‡ªå·±æ€»ç»“ä¸€ä¸‹ï¼Œä¸€æ®µæ•°æ®æµä»åº”ç”¨ç¨‹åºå‘é€ç«¯ï¼Œä¸€ç›´åˆ°åº”ç”¨ç¨‹åºæ¥æ”¶ç«¯ï¼Œæ€»å…±ç»è¿‡äº†å¤šå°‘æ¬¡æ‹·è´ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºä¸æˆ‘åˆ†äº«ä½ çš„ç­”æ¡ˆï¼Œå¦‚æœä½ ç†è§£äº†å¥—æ¥å­—è¯»å†™çš„è¿‡ç¨‹ï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–è€…åŒäº‹ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/bf/25/bfc96ae0d8f839919b9d9866cfb8b025.jpg" alt=""></p><h2>ç²¾é€‰ç•™è¨€ï¼š</h2>
        <ul>
        
<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ä¸šä½™çˆ±å¥½è€…  2019-08-12 07:58:10
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ç½‘ç»œç¨‹åºçš„æ€§èƒ½ç“¶é¢ˆä¸€èˆ¬åœ¨äºæœåŠ¡ç«¯ï¼Œæ‰€ä»¥è€å¸ˆè¯´çš„å¢åŠ ç¼“å†²åŒºå¤§å°åº”è¯¥æŒ‡çš„æ˜¯æœåŠ¡ç«¯ã€‚å¦‚æœåº”ç”¨ç¨‹åºçš„å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šï¼Œå³ä½¿ç¼“å†²åŒºå†å¤§ï¼Œä¹Ÿä¸èƒ½åœ¨æ•´ä½“ä¸Šæé«˜å¤ªå¤šçš„ååç‡ã€‚æ€§èƒ½ï¼Œä»æ¥éƒ½åªèƒ½ä»æ•´ä½“ä¸Šä¼˜åŒ–ï¼Œç®€å•ç²—æš´åœ°æå‡æŸä¸€ä¸ªæŒ‡æ ‡çš„æ•ˆæœä¸€èˆ¬ã€‚<br><br>é¦–å…ˆè®²å®¢æˆ·ç«¯å‘é€çš„æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºï¼Œ<br>ç„¶åæ“ä½œç³»ç»Ÿè®²æ•°æ®ä»å®¢æˆ·ç«¯çš„ç¼“å†²åŒºä¸­å‘å¾€æœåŠ¡ç«¯çš„ç¼“å†²åŒºã€‚æœåŠ¡ç«¯æ“ä½œç³»ç»Ÿæœ€åæŠŠæ•°æ®ä»ç¼“å†²åŒºæ¬ç§»åˆ°åº”ç”¨ç¨‹åºã€‚å®¢æˆ·ç«¯åº”ç”¨--å®¢æˆ·ç«¯ç¼“å†²åŒº--æœåŠ¡ç«¯ç¼“å†²åŒº--æœåŠ¡ç«¯åº”ç”¨ç¨‹åºã€‚ä¸€å…±3æ¬¡? [1èµ]
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            åœ¨è·¯ä¸Š  2019-08-12 07:37:26
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ä¸ªäººçš„æƒ³æ³•ï¼š<br>å•çº¯çš„æé«˜ç¼“å†²åŒºåº”è¯¥ä¸æ˜¯å¯è¡Œçš„æ–¹æ³•ï¼Œä»¥ä¸€å°è®¡ç®—æœºæ€è€ƒï¼Œå†…å­˜æ¯•ç«Ÿæ˜¯æœ‰é™çš„ï¼Œä¸ºæ¯ä¸ªå¥—æ¥å­—éƒ½å¼€è¾Ÿä¸€å¤§å—å†…å­˜ï¼Œé‚£ç›¸åº”å¯ä»¥åˆ›å»ºçš„å¥—æ¥å­—çš„å°±å‡å°‘äº†æŠŠ [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-08-12 11:11:04</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">ç›¸å½“äºè®©ä»“åº“å˜å¤§ï¼Œå¯ä»¥å­˜å‚¨äº†æ›´å¤šçš„è´§ç‰©ï¼Œå¦‚æœå‡ºè´§çš„é€Ÿåº¦æœ‰é™ï¼Œä¼šæœ‰æ›´å¤šçš„è´§ç‰©çƒ‚åœ¨ä»“åº“é‡Œã€‚</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            æ˜Ÿäº¦è¾°  2019-08-12 00:21:28
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æœ‰è¿™ä¹ˆä¸€ä¸ªé—®é¢˜ï¼š<br><br>å‡å¦‚å®¢æˆ·ç«¯å¾€æœåŠ¡ç«¯å‘é€äº†1025ä¸ªå­—èŠ‚ï¼Œè€Œåªæœ‰1024ä¸ªå­—èŠ‚æ˜¯æœ‰ç”¨çš„ã€‚<br>æˆ‘åœ¨æœåŠ¡ç«¯ç”¨read è¯»å–1024ä¸ªå­—èŠ‚ï¼Œæœ€åä¸€å®šæ˜¯è¿”å›1024ã€‚<br>ç„¶åï¼Œå‰©ä¸‹çš„æ²¡æœ‰ç”¨äº†ï¼Œä¸æ‰“ç®—è¯»äº†ï¼Œæ€ä¹ˆæ ·æŠ›å¼ƒå¤šä½™çš„å†…å®¹å‘¢ã€‚ [1èµ]
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-08-12 11:09:27</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">é‚£ä½ ä¸ºå•¥è¦ä¼ è¿™ç¬¬1025ä¸ªå­—èŠ‚å‘¢ï¼Ÿå¦‚æœæ˜¯æ¶ˆæ¯çš„è¾¹ç•Œï¼Œä¾‹å¦‚æ¢è¡Œï¼Œè¿˜æ˜¯è¦è¯»åˆ°è¿™ä¸ªå­—ç¬¦çš„ï¼Œè¯»å®Œä»¥åä¸æ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„ç¼“å†²åŒºå°±å¯ä»¥è®¤ä¸ºæ˜¯ä¸¢å¼ƒäº†ã€‚</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            Geek_Wison  2019-08-12 11:25:36
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆå¯ä»¥å°†å®Œæ•´çš„ä»£ç çš„githubåœ°å€è´´å‡ºæ¥å—ï¼Œæˆ‘æƒ³è‡ªå·±ç¼–è¯‘è°ƒè¯•è¿è¡Œä¸€ä¸‹ã€‚ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-08-12 11:49:02</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ­£åœ¨è¿›è¡Œä¸­</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            é˜¿è¥¿å§  2019-08-12 10:06:50
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            serv.c: In function â€˜mainâ€™:<br>serv.c:17: warning: incompatible implicit declaration of built-in function â€˜bzeroâ€™<br>serv.c:24: error: â€˜SAâ€™ undeclared (first use in this function)<br>serv.c:24: error: (Each undeclared identifier is reported only once<br>serv.c:24: error: for each function it appears in.)<br>serv.c:24: error: expected expression before â€˜)â€™ token<br>serv.c:24: error: too few arguments to function â€˜bindâ€™<br>serv.c:32: error: expected expression before â€˜)â€™ token<br>serv.c:32: error: too few arguments to function â€˜acceptâ€™<br>serv.c: At top level:<br>serv.c:39: warning: conflicting types for â€˜read_dataâ€™<br>serv.c:33: note: previous implicit declaration of â€˜read_dataâ€™ was here<br>ç¼–è¯‘è¿è¡Œåå‡ºç°ä»¥ä¸Šé”™è¯¯ï¼Œæ˜¯å› ä¸ºè¿˜æœ‰å…¶å®ƒæ–‡ä»¶æœªå¼•ç”¨å—ï¼Œå¯å¦å°†å®Œæ•´æºç æ”¾ä¸Šgithub,è°¢è°¢ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-08-12 11:14:11</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ­£åœ¨å‡†å¤‡ä¸­......</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å¤§ç°ç‹¼  2019-08-12 09:13:28
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            ç½‘å¡é©±åŠ¨æ‹¿åˆ°æ•°æ®ï¼Œä¸­æ–­åå†™å…¥æ”¶ç¼“å†²åŒº<br>ä»ç¼“å†²åŒºåˆ°åº”ç”¨ä¸€æ¬¡ã€‚<br>æ‰€ä»¥æœ€å°‘ä¸¤æ¬¡ã€‚<br>æ— é™å¤§å°çš„ç¼“å†²åŒºæµªè´¹å†…å­˜ï¼Œå¹¶ä¸æ˜¯è¶Šå¤§è¶Šå¥½ã€‚å¦‚æœç¼“å†²åŒºå¢å¤§å¹¶ä¸èƒ½æå‡æ”¶å‘åŒ…æ•ˆç‡ï¼Œå¯ä»¥é‡‡å–å…¶ä»–æ–¹é¢çš„ä¼˜åŒ–ã€‚ 
        </div>
        
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ç ´æ™“^_^  2019-08-12 09:11:59
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æ— é™å¢å¤§ç¼“å†²åŒºè‚¯å®šä¸è¡Œï¼Œæ–‡ç« ä¸­å·²ç»è¯´è¿‡writeå‡½æ•°å‘é€æ•°æ®åªæ˜¯å°†æ•°æ®å‘é€åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œè€Œä»€ä¹ˆæ—¶å€™å‘é€ç”±å†…æ ¸è§‰å®šã€‚å†…æ ¸ç¼“å†²åŒºæ€»æ˜¯å……æ»¡æ•°æ®æ—¶ä¼šäº§ç”Ÿç²˜åŒ…é—®é¢˜ï¼ŒåŒæ—¶ç½‘ç»œçš„ä¼ è¾“å¤§å°MTUä¹Ÿä¼šé™åˆ¶æ¯æ¬¡å‘é€çš„å¤§å°ï¼Œæœ€åç”±äºæ•°æ®å µå¡éœ€è¦æ¶ˆè€—å¤§é‡å†…å­˜èµ„æºï¼Œèµ„æºä½¿ç”¨æ•ˆç‡ä¸é«˜ã€‚<br>ç”¨æˆ·ç¼“å†²åŒºåˆ°å†…æ ¸ç¼“å†²åŒº<br>å†…æ ¸ç¼“å†²åŒºIPæŠ¥æ–‡ï¼Œä¸€æ¬¡ä¸‰æ‹·è´ï¼Œæ€»å…±6æ¬¡ã€‚ä¸çŸ¥å¯¹å¦ï¼Ÿ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-08-12 11:13:20</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">éƒ½æ˜¯å¼ºäººğŸ˜„</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            ç ´æ™“^_^  2019-08-12 08:58:07
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            è€å¸ˆä½ å¥½ï¼Œæ–‡ä¸­å‡ å¤„è´´ä»£ç çš„ä½ç½®ï¼Œä¸ªäººè§‰å¾—ä¸ç®¡æ˜¯ä»£ç ç‰‡æ®µè¿˜æ˜¯å®Œæ•´ç¨‹åºï¼Œåº”è¯¥ä¿æŒå®Œæ•´æ€§ï¼Œæ–‡ä¸­å‡ å¤„éƒ½ç¼ºå°‘èŠ±æ‹¬å·è¡¥é½ï¼Œå®Œæ•´æ€§ã€‚ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-08-12 09:42:48</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">æ„Ÿè°¢æŒ‡å‡ºï¼Œä»£ç ä¼šåŠ å¼ºå®¡é˜…</div>
</div>
            
    </div>
</li>
            
<br/>

<li>
    <div>
        <div style="color: #888;font-size:15.25px;font-weight:400;line-height:1.2">
            å¤©èåº§çš„ç‹®å­ç‹—  2019-08-12 07:55:06
        </div>
        <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">
            æˆ‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå‘é€å‡½æ•°sendå‡½æ•°è¿”å›å€¼ç«Ÿç„¶æ¯”æˆ‘å†™çš„æ—¶å€™ä¼ å…¥çš„buffçš„bufflenå¤§ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆğŸ˜³ã€‚ 
        </div>
        <br/>
<div>
    <div style="color:#888;font-size:15.25px;font-weight:400;line-height:1.2">ä½œè€…å›å¤2019-08-12 11:11:54</div>
    <div style="color:#353535;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6">å‡ºé”™äº†.... ä»£ç è´´å‡ºæ¥çœ‹çœ‹</div>
</div>
            
    </div>
</li>
            </ul>
</div>
</body>
</html>