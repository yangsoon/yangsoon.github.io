<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="robots" content="index,follow"/><meta property="og:type" content="website"/><meta name="google-site-verification" content="_OJuJrMAK0_lxr0--eH6RZyMOn2Mg_zY1hDyBBKU8fI"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-Y4TMBBH2RZ"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
              gtag('config', 'G-Y4TMBBH2RZ', {
                page_path: window.location.pathname,
              });
          </script><meta property="og:site_name" content="YangSoon"/><meta property="twitter:domain" content="yangsoon.github.io"/><meta name="twitter:creator" content="@yangsoonlx"/><meta name="description" content="YangSoon, Cloud Native Developer"/><meta property="og:description" content="YangSoon, Cloud Native Developer"/><meta name="twitter:description" content="YangSoon, Cloud Native Developer"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://yangsoon.github.io/api/social-image?id=f8e41082-81f4-4d47-a6f3-3489e7c3453c"/><meta property="og:image" content="https://yangsoon.github.io/api/social-image?id=f8e41082-81f4-4d47-a6f3-3489e7c3453c"/><link rel="canonical" href="https://yangsoon.github.io/100-go-mistakes-and-how-to-avoid-them--2"/><meta property="og:url" content="https://yangsoon.github.io/100-go-mistakes-and-how-to-avoid-them--2"/><meta property="twitter:url" content="https://yangsoon.github.io/100-go-mistakes-and-how-to-avoid-them--2"/><link rel="alternate" type="application/rss+xml" href="https://yangsoon.github.io/feed" title="YangSoon"/><meta property="og:title" content="100 Go Mistakes and How to Avoid Them - 2"/><meta name="twitter:title" content="100 Go Mistakes and How to Avoid Them - 2"/><title>100 Go Mistakes and How to Avoid Them - 2</title><link rel="preload" as="image" href="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F47263733-11bc-4ae7-9e1e-c3401a49c171%2FManning.100.Go.Mistakes.and.How.to.Avoid.Them.2022-1%25EF%25BC%2588%25E6%258B%2596%25E7%25A7%25BB%25E9%25A1%25B9%25E7%259B%25AE%25EF%25BC%2589.png?table=block&amp;id=f8e41082-81f4-4d47-a6f3-3489e7c3453c&amp;cache=v2"/><meta name="next-head-count" content="25"/><link rel="shortcut icon" href="/favicon.ico"/><link rel="icon" type="image/png" sizes="32x32" href="favicon.png"/><link rel="manifest" href="/manifest.json"/><link rel="preload" href="/_next/static/css/836d11bb8e359ad4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/836d11bb8e359ad4.css" data-n-g=""/><link rel="preload" href="/_next/static/css/1d993c1b8c3f1e3a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1d993c1b8c3f1e3a.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script defer="" src="/_next/static/chunks/3607272e.d338bf53926ee7c2.js"></script><script defer="" src="/_next/static/chunks/853.526a4df21aef109c.js"></script><script defer="" src="/_next/static/chunks/358.0027340467b29549.js"></script><script src="/_next/static/chunks/webpack-d0f6f9fb604748c4.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-f08b69bdcc7bbb61.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e341ab6855f9c9f4.js" defer=""></script><script src="/_next/static/chunks/446-eacec4350a1e0802.js" defer=""></script><script src="/_next/static/chunks/642-42755b97efa073d8.js" defer=""></script><script src="/_next/static/chunks/pages/%5BpageId%5D-69b62fc61f7d7f72.js" defer=""></script><script src="/_next/static/0jlsjuX7o0EQ7wPlD8p0p/_buildManifest.js" defer=""></script><script src="/_next/static/0jlsjuX7o0EQ7wPlD8p0p/_ssgManifest.js" defer=""></script></head><body><script>
/** Inlined version of noflash.js from use-dark-mode */
;(function () {
  var storageKey = 'darkMode'
  var classNameDark = 'dark-mode'
  var classNameLight = 'light-mode'
  function setClassOnDocumentBody(darkMode) {
    document.body.classList.add(darkMode ? classNameDark : classNameLight)
    document.body.classList.remove(darkMode ? classNameLight : classNameDark)
  }
  var preferDarkQuery = '(prefers-color-scheme: dark)'
  var mql = window.matchMedia(preferDarkQuery)
  var supportsColorSchemeQuery = mql.media === preferDarkQuery
  var localStorageTheme = null
  try {
    localStorageTheme = localStorage.getItem(storageKey)
  } catch (err) {}
  var localStorageExists = localStorageTheme !== null
  if (localStorageExists) {
    localStorageTheme = JSON.parse(localStorageTheme)
  }
  // Determine the source of truth
  if (localStorageExists) {
    // source of truth from localStorage
    setClassOnDocumentBody(localStorageTheme)
  } else if (supportsColorSchemeQuery) {
    // source of truth from system
    setClassOnDocumentBody(mql.matches)
    localStorage.setItem(storageKey, mql.matches)
  } else {
    // source of truth from document.body
    var isDarkMode = document.body.classList.contains(classNameDark)
    localStorage.setItem(storageKey, JSON.stringify(isDarkMode))
  }
})();
</script><div id="__next"><div class="notion notion-app light-mode notion-block-f8e4108281f44d47a6f33489e7c3453c"><div class="notion-viewport"></div><div class="notion-frame"><header class="notion-header"><div class="notion-nav-header"><div class="breadcrumbs"><a class="breadcrumb" href="/"><div class="notion-page-icon-inline notion-page-icon-image"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%272003%27/%3e"/></span><img alt="流心家的羊" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="icon notion-page-icon" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRmoAAABXRUJQVlA4IF4AAADQAQCdASoQABAABUB8JbACdAERATxWoAD+0Vlxx+kOh3kDC0Z3s4OjUZzRpnTiXUiN5qtuCLGbw3Q3meKHmbJDj3X9KoWlb/kas/KasMX31nkEcPwD09TPGVsO8AAA&quot;)"/><noscript><img alt="流心家的羊" src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F37907dd5-3c76-4966-a419-daa027a84972%2FIMG_2189.jpg?table=block&amp;id=72a66971-7cf6-42c2-a252-4439d99d8f44&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="icon notion-page-icon" loading="lazy"/></noscript></span></div><span class="title">流心家的羊</span></a></div><div class="notion-nav-header-rhs breadcrumbs"><a href="/关于作者" class="breadcrumb button">About</a><div class="breadcrumb button styles_hidden__7gYve"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M256 48v48m0 320v48m147.08-355.08l-33.94 33.94M142.86 369.14l-33.94 33.94M464 256h-48m-320 0H48m355.08 147.08l-33.94-33.94M142.86 142.86l-33.94-33.94"></path><circle cx="256" cy="256" r="80" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32"></circle></svg></div></div></div></header><div class="notion-page-scroller"><div class="notion-page-cover-wrapper"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%272508%27/%3e"/></span><img alt="100 Go Mistakes and How to Avoid Them - 2" src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F47263733-11bc-4ae7-9e1e-c3401a49c171%2FManning.100.Go.Mistakes.and.How.to.Avoid.Them.2022-1%25EF%25BC%2588%25E6%258B%2596%25E7%25A7%25BB%25E9%25A1%25B9%25E7%259B%25AE%25EF%25BC%2589.png?table=block&amp;id=f8e41082-81f4-4d47-a6f3-3489e7c3453c&amp;cache=v2" decoding="async" data-nimg="intrinsic" class="notion-page-cover" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-position:center 17.390000000000004%;background-size:cover;background-position:center 17.390000000000004%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRkoAAABXRUJQVlA4ID4AAACQAQCdASoNABAABUB8JZQAAUJYnCAA/i3sgO0Yegdb+5LvlWhw/psHDLyVDpX8zYYcjaZB/BXtD4y71SAAAA==&quot;)"/><noscript><img alt="100 Go Mistakes and How to Avoid Them - 2" src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F47263733-11bc-4ae7-9e1e-c3401a49c171%2FManning.100.Go.Mistakes.and.How.to.Avoid.Them.2022-1%25EF%25BC%2588%25E6%258B%2596%25E7%25A7%25BB%25E9%25A1%25B9%25E7%259B%25AE%25EF%25BC%2589.png?table=block&amp;id=f8e41082-81f4-4d47-a6f3-3489e7c3453c&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-position:center 17.390000000000004%" class="notion-page-cover"/></noscript></span></div><main class="notion-page notion-page-has-cover notion-page-has-icon notion-page-has-image-icon notion-full-page"><div class="notion-page-icon-hero notion-page-icon-image"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%271159%27/%3e"/></span><img alt="100 Go Mistakes and How to Avoid Them - 2" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="notion-page-icon" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRjwAAABXRUJQVlA4IDAAAACwAQCdASoQAAkABUB8JQAAT6/36IiAAP4EcU3AJPD5WZWYi6rGw+MWNhG0kKdLMAA=&quot;)"/><noscript><img alt="100 Go Mistakes and How to Avoid Them - 2" src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa22fb73f-5a7d-4fdc-8319-52ed15316e76%2Fimages.jpeg?table=block&amp;id=f8e41082-81f4-4d47-a6f3-3489e7c3453c&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="notion-page-icon" loading="lazy"/></noscript></span></div><h1 class="notion-title">100 Go Mistakes and How to Avoid Them - 2</h1><div class="notion-collection-page-properties"><div class="notion-collection-row"><div class="notion-collection-row-body"><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M6.986 14c-1.79 0-3.582-.69-4.944-2.068-2.723-2.72-2.723-7.172 0-9.892 2.725-2.72 7.182-2.72 9.906 0A6.972 6.972 0 0114 6.996c0 1.88-.728 3.633-2.052 4.955A7.058 7.058 0 016.986 14zm3.285-6.99v1.645H5.526v-5.47h1.841v3.63h2.904v.194zm1.89-.014c0-1.379-.542-2.67-1.522-3.648-2.006-2.005-5.287-2.007-7.297-.009l-.009.009a5.168 5.168 0 000 7.295c2.01 2.007 5.297 2.007 7.306 0a5.119 5.119 0 001.521-3.647z"></path></svg><div class="notion-collection-column-title-body">Created</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-created_time">Feb 25, 2023 10:08 AM</span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M4 3a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zM2 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2z"></path></svg><div class="notion-collection-column-title-body">Tags</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-multi_select"><div class="notion-property-multi_select-item notion-item-brown">golang</div></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">Text</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text">WIP(80%)</span></div></div></div></div></div><div class="notion-page-content notion-page-content-has-aside notion-page-content-has-toc"><article class="notion-page-content-inner"><div class="notion-callout notion-gray_background_co notion-block-a85d9fed92aa4cf4ae9200751ec8ab5b"><div class="notion-page-icon-inline notion-page-icon-span"><span class="notion-page-icon" role="img" aria-label="💡">💡</span></div><div class="notion-callout-text">本文是 100 Go Mistakes读书笔记 的下篇</div></div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-7c7869cc60ca4e108583d4a5062b6ac4" data-id="7c7869cc60ca4e108583d4a5062b6ac4"><span><div id="7c7869cc60ca4e108583d4a5062b6ac4" class="notion-header-anchor"></div><a class="notion-hash-link" href="#7c7869cc60ca4e108583d4a5062b6ac4" title="关于本书"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">关于本书</span></span></h3><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-164f95cbc34d469cb85c2bc356b4e3c0" href="https://book.douban.com/subject/36084407/"><div><div class="notion-bookmark-title">100 Go Mistakes and How to Avoid Them</div><div class="notion-bookmark-description">Spot errors in your Go code you didn’t even know you were making and boost your productivity by avoi...</div><div class="notion-bookmark-link"><div class="notion-bookmark-link-icon"><img src="https://www.notion.so/image/https%3A%2F%2Fimg1.doubanio.com%2Ffavicon.ico?table=block&amp;id=164f95cb-c34d-469c-b85c-2bc356b4e3c0&amp;cache=v2" alt="100 Go Mistakes and How to Avoid Them" loading="lazy" decoding="async"/></div><div class="notion-bookmark-link-text">https://book.douban.com/subject/36084407/</div></div></div><div class="notion-bookmark-image"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%272507%27/%3e"/></span><img alt="100 Go Mistakes and How to Avoid Them" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRk4AAABXRUJQVlA4IEIAAACwAQCdASoNABAABUB8JZQAAcCzMdgAAP1pPb5smyxoh54e7LDGK8Yk2gEHbh/20RBmhShKjfB1bjvvEl7pU7XAAAA=&quot;)"/><noscript><img alt="100 Go Mistakes and How to Avoid Them" src="https://www.notion.so/image/https%3A%2F%2Fimg2.doubanio.com%2Fview%2Fsubject%2Fl%2Fpublic%2Fs34311243.jpg?table=block&amp;id=164f95cb-c34d-469c-b85c-2bc356b4e3c0&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></a></div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-0decdc5a63f64cbca101acf83211ccff" data-id="0decdc5a63f64cbca101acf83211ccff"><span><div id="0decdc5a63f64cbca101acf83211ccff" class="notion-header-anchor"></div><a class="notion-hash-link" href="#0decdc5a63f64cbca101acf83211ccff" title="7 Error management"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">7 Error management</span></span></h3><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-76b64bafa8dd4007a565664a00046b06" data-id="76b64bafa8dd4007a565664a00046b06"><span><div id="76b64bafa8dd4007a565664a00046b06" class="notion-header-anchor"></div><a class="notion-hash-link" href="#76b64bafa8dd4007a565664a00046b06" title="7.1 #48: Panicking（什么是panic）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">7.1 #48: Panicking（什么是panic）</span></span></h4><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">func main() {
  // 在defer中执行 recover 可以恢复panic，defer也会在周围出现panic的时候执行
	defer func() {
		if r := recover(); r != nil {
			fmt.Println(&quot;recover&quot;, r)
		}
	}()
	f()
}
func f() {
	fmt.Println(&quot;a&quot;)
	panic(&quot;foo&quot;)
	fmt.Println(&quot;b&quot;)
}</code></pre><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-c94b3a792507408d8aefc2d11343c7fc" data-id="c94b3a792507408d8aefc2d11343c7fc"><span><div id="c94b3a792507408d8aefc2d11343c7fc" class="notion-header-anchor"></div><a class="notion-hash-link" href="#c94b3a792507408d8aefc2d11343c7fc" title="7.2 #49: Ignoring when to wrap an error（不明确何时包装一个error，fmt.Errorf用法）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">7.2 #49: Ignoring when to wrap an error（不明确何时包装一个error，fmt.Errorf用法）</span></span></h4><div class="notion-text notion-block-91b46093116642ecbf709fcf8d6b87ec">在如下场景你可以选择包装一下error：</div><ol start="1" class="notion-list notion-list-numbered notion-block-aa03455014d14e868475807cfc28c526"><li>你需要在错误上增加一些上下文</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-104c6b88dfb342538e2666b685beae33"><li>你需要把错误封装在另一个错误内</li></ol><div class="notion-row notion-block-b0dbcc2bd143444fa9c4fa7b2bd1466a"><div class="notion-column notion-block-a0af9c7a485d4991b55ffc99c001c7cd" style="width:calc((100% - (1 * min(32px, 4vw))) * 0.5)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-7b47c76007b5445891c027039f752bed"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%27841%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAAAwAQCdASoQAAcABUB8JZQAA3AA/vBmGaPoMMfT+4RThezUN53k8lwNzeTsgAAA&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbfjzjehr4j30tc0ccq5c.jpg?table=block&amp;id=7b47c760-07b5-4458-91c0-27039f752bed&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure></div><div class="notion-spacer"></div><div class="notion-column notion-block-0bbfdf78648f4f12bb15c263feb01acc" style="width:calc((100% - (1 * min(32px, 4vw))) * 0.5)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-29ea918e04ec45278b380076f604b0a5"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%27801%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRjYAAABXRUJQVlA4ICoAAACQAQCdASoQAAYABUB8JZQAApuLmvgA/usyeOnRnoxEhb3C52zBu7IA3AA=&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbfjzrczn0j30t00bmgnc.jpg?table=block&amp;id=29ea918e-04ec-4527-8b38-0076f604b0a5&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure></div><div class="notion-spacer"></div></div><div class="notion-text notion-block-476a803598db443cb30357897ee1a5b3">GO支持如下几种包装error的方式：</div><ol start="1" class="notion-list notion-list-numbered notion-block-d063db166f75400f83978a908920b734"><li>自定义Error结构体</li><ol class="notion-list notion-list-numbered notion-block-d063db166f75400f83978a908920b734"><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">type BarError struct {
	Err error
}

func (b BarError) Error() string {
	return &quot;bar failed:&quot; + b.Err.Error()
}

func test() {
	err := bar()
	if err != nil {
		return BarError{Err: err}
	}
}</code></pre></ol></ol><ol start="2" class="notion-list notion-list-numbered notion-block-fe958b5d0a7c4d06a05a39fff22ece70"><li>使用 fmt.Errorf 方法，⚠️ %w 和 %v 有不同的执行效果</li><ol class="notion-list notion-list-numbered notion-block-fe958b5d0a7c4d06a05a39fff22ece70"><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">if err != nil {
		// 使用 %w 指令，会返回一个包装了err的错误，接收方可以从父error中获取到源error
		// 并根据判断错误是否为某一个错误类型
		// sourceErr --wrap--&gt; WrapErr(sourceErr)
    return fmt.Errorf(&quot;bar failed: %w&quot;, err)
}

if err != nil {
		// 使用 %v 指令，不会包装错误，会直接转化为另一个错误，源错误不再可用
    // sourceErr --transform--&gt; otherErr
    return fmt.Errorf(&quot;bar failed: %v&quot;, err)
}
</code></pre></ol></ol><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-5eea680d96d54622bf61fc9df8741066"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%27687%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRiwAAABXRUJQVlA4ICAAAACQAQCdASoQAAUABUB8JZwAAudR6dAA/sYFJUtPYAAAAA==&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbfkkxdgp1j31gw0i6tel.jpg?table=block&amp;id=5eea680d-96d5-4622-bf61-fc9df8741066&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure><div class="notion-text notion-block-8e9fc5aff060464f83fb8f2954c0406e">如果保留源错误的信息，会有潜在的耦合信息，因为接收方需要直接函数实现的细节，需要知道被包装的错误是什么类型，所以没有特殊需求在使用fmt.Errorf的时候使用%v指令。</div><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-3cd2c017ab3e4a788dbb855fe703e324" data-id="3cd2c017ab3e4a788dbb855fe703e324"><span><div id="3cd2c017ab3e4a788dbb855fe703e324" class="notion-header-anchor"></div><a class="notion-hash-link" href="#3cd2c017ab3e4a788dbb855fe703e324" title="7.3 #50: Checking an error type inaccurately（如何正确的判断Error类型-error.As用法）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">7.3 #50: Checking an error type inaccurately（如何正确的判断Error类型-error.As用法）</span></span></h4><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">func handler(w http.ResponseWriter, r *http.Request) {
	transactionID := r.URL.Query().Get(&quot;transaction&quot;)

	amount, err := getTransactionAmount(transactionID)
	if err != nil {
		if errors.As(err, &amp;transientError{}) {
			http.Error(w, err.Error(), http.StatusServiceUnavailable)
		} else {
			http.Error(w, err.Error(), http.StatusBadRequest)
		}
		return
	}

	// Write response
	_ = amount
}

func getTransactionAmount(transactionID string) (float32, error) {
	// Check transaction ID validity

	amount, err := getTransactionAmountFromDB(transactionID)
	if err != nil {
		return 0, fmt.Errorf(&quot;failed to get transaction %s: %w&quot;,
			transactionID, err)
	}
	return amount, nil
}

func getTransactionAmountFromDB(transactionID string) (float32, error) {
	// ...
	var err error
	if err != nil {
		return 0, transientError{err: err}
	}
	// ...
	return 0, nil
}</code></pre><div class="notion-text notion-block-cc26dc03b1fd4a0c8aea2d47acc1d32e">当使用%w指令或者结构体封装的方式包装一个错误的时候，可以使用 errors.As 递归判断错误类型，errors.As函数需要传递一个目标错误类型的指针。</div><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-6a42791f2d9547509eac5152c344224d" data-id="6a42791f2d9547509eac5152c344224d"><span><div id="6a42791f2d9547509eac5152c344224d" class="notion-header-anchor"></div><a class="notion-hash-link" href="#6a42791f2d9547509eac5152c344224d" title="7.4 #51: Checking an error value inaccurately（如何正确的处理Error的值-error.Is用法）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">7.4 #51: Checking an error value inaccurately（如何正确的处理Error的值-error.Is用法）</span></span></h4><div class="notion-text notion-block-cf04f3b698524eccaf8a394a75a9d1da"><b>sentinel error </b>是指定义为全局变量的错误类型。<b>命名规约是以Err开头加上类型</b>。</div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">import &quot;errors&quot;
var ErrFoo = errors.New(&quot;foo&quot;)</code></pre><div class="notion-text notion-block-a1743b61d7ec4a819de917c0c47a8499">这种类型的错误，有时候是程序允许存在的错误，比如查询数据库返回没有查询到结果的sql.ErrNoRows和io.Reader读取返回io.EOF.他们传递的信息客户端可以接受，并认为是正常的情况。</div><div class="notion-text notion-block-00be84709c6141e1b49ac4e652c48e70">在查询数据的场景，我们想判断错误的值是否等于sql.ErrNoRows这种<b>sentinel error，</b>使用 == 可能会出现问题，因为ErrNoRows可能已经被包装过。对于这种问题，可以直接使用 <a target="_blank" rel="noopener noreferrer" class="notion-link" href="http://errors.Is"><b>errors.Is</b></a><b> </b>来判断，他可以帮你递归判断出正确的错误。</div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">func main() {
	err := query()
	if err != nil {
		// if err == sql.ErrNoRows {
		if errors.Is(err, sql.ErrNoRows) {
			// ...
		} else {
			// ...
		}
	}
}

func query() error {
	return nil
}</code></pre><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-17dbaba54db2446b89667b17d775b52b" data-id="17dbaba54db2446b89667b17d775b52b"><span><div id="17dbaba54db2446b89667b17d775b52b" class="notion-header-anchor"></div><a class="notion-hash-link" href="#17dbaba54db2446b89667b17d775b52b" title="7.5 #52: Handling an error twice（多次处理错误）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">7.5 #52: Handling an error twice（多次处理错误）</span></span></h4><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-ff246c9ee04f46619c0a3baffd9239d3"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%271071%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACwAQCdASoQAAkABUB8JQAAXOudR8AAAP7tzTjaDKMHDJ3iIuQAAyBaRRsyGwAA&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbfqoq89goj31ja0tmani.jpg?table=block&amp;id=ff246c9e-e04f-4661-9c0a-3baffd9239d3&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-d5985c13735b497c862cab8b526e92e2" data-id="d5985c13735b497c862cab8b526e92e2"><span><div id="d5985c13735b497c862cab8b526e92e2" class="notion-header-anchor"></div><a class="notion-hash-link" href="#d5985c13735b497c862cab8b526e92e2" title="7.6 #53: Not handling an error（没有处理error）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">7.6 #53: Not handling an error（没有处理error）</span></span></h4><div class="notion-text notion-block-313fa9109059498c8d595a950ed0f995">如果代码中没有处理一个函数返回的error，需要编写注释明确指明不处理error的原因</div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">// At-most once delivery.
// Hence, it&#x27;s accepted to miss some of them in case of errors.
 _ = notify()</code></pre><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-2f5c6e56e9e644a1815addd5a1186c76" data-id="2f5c6e56e9e644a1815addd5a1186c76"><span><div id="2f5c6e56e9e644a1815addd5a1186c76" class="notion-header-anchor"></div><a class="notion-hash-link" href="#2f5c6e56e9e644a1815addd5a1186c76" title="7.7 #54: Not handling defer errors（没有处理defer语句中的error）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">7.7 #54: Not handling defer errors（没有处理defer语句中的error）</span></span></h4><div class="notion-text notion-block-d673a08e511e40538d79ee1ff9fe4cef">defer语句经常会做一些收尾工作，关闭socket，释放锁等..,有些语句会返回错误，如果不处理这些错误就会导致错误信息丢失，造成资源泄露等问题。本节提出了一个通过给错误返回值命名，在defer的时候把错误值赋值给返回结果，向上传递错误。</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-c6b629f676c949c28d26ce643e0eb665"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%27763%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRjAAAABXRUJQVlA4ICQAAAAwAQCdASoQAAYABUB8JYwAA3AA/vBl/VgRnYjho4mzKY1AAAA=&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbfr8gkmhjj319a0hatdy.jpg?table=block&amp;id=c6b629f6-76c9-49c2-8d26-ce643e0eb665&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">// 一种解决方式是使用命名结果，把错误信息通过命名结果返回
func getBalance(db *sql.DB, clientID string) (balance float32, err error) {
	rows, err := db.Query(query, clientID)
	if err != nil {
		return 0, err
	}
	defer func() {
		closeErr := rows.Close()
		if err != nil {
			if closeErr != nil {
        // 如果db.Query语句也出现了执行错误，把close错误的信息打印出来
				log.Printf(&quot;failed to close rows: %v&quot;, err)
			}
			return
		}
		// 当只要close的时候有错误，把closeErr赋值给err传递到上一层
		err = closeErr
	}()

	// Use rows
	return 0, nil
}</code></pre><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-71c585c466b9491d9911837721721de8" data-id="71c585c466b9491d9911837721721de8"><span><div id="71c585c466b9491d9911837721721de8" class="notion-header-anchor"></div><a class="notion-hash-link" href="#71c585c466b9491d9911837721721de8" title="8 Concurrency: Foundations"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">8 Concurrency: Foundations</span></span></h3><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-c2d13cad020f4e319e377b0bfed1c883" href="https://golang.design/under-the-hood/zh-cn/part1basic/ch05sync/mem/"><div><div class="notion-bookmark-title">5.9 内存一致模型</div><div class="notion-bookmark-description">5.9 内存一致模型 读者可能注意到了，无论是在谈论 Go 的运行时还是编译器，直到目前为止我们都有意无意的 尝试去回避 Go 语言的「内存模型」这个话题。 这有非常多的原因，作为本章的收尾，也是全书对 Go 语言同步原语与同步模式的一个总结， 我们最后来详细展开内存模型这个话题，解答读者心中的疑惑。 对为什么到目前为止我们都刻意的回避有关内存模型的内容作出一个相对完整的解释。 5.9.1 内存模型的重要性 内存一致模型，或称内存模型，是一份语言用户与语言自身、语言自身与所在的操作系统平台、 所在操作系统平台与硬件平台之间的契约。它定义了并行状态下拥有确定读取和写入的时序的条件， 并回答了一个共享变量是否具有足够的同步机制来保障一个线程的写入能否发生在另一个线程的读取之前这个问题。 在一份 Go 语言的程序被写成后，将经过编译器的转换与优化、所运行操作系统或虚拟机等动态优化器的优化，以及 CPU 硬件平台对指令流的优化才最终得以被执行。这个过程意味着，对于某一个变量的读取与写入操作，可能 被这个过程中任何一个中间步骤进行调整，从而偏离程序员在程序中所指定的原有顺序。 没有内存模型的保障，就无法正确的推演程序在最终被执行时的正确性。 内存模型的策略同样有着长期影响，并且直接决定了程序的可移植性和可维护性。 例如，过强的内存模型将约束硬件和编译器优化的空间，从而严重降低程序性能上限； 已经选择了强内存模型的硬件体系结构，无法在不破坏兼容性的情况下向更弱的内存模型进行迁移， 这种兼容性破坏所带来的代价就是要求其平台上的程序重新实现其源码。 这种横跨用户、软件与硬件三大领域的主题使得内存模型的设计愿景变得异常的困难，至今仍是一个开放的研究问题。因此在讨论 Go 语言的内存模型之前，我们还需要了解现有的内存模型、历史上软硬件平台之间形成契约的经验教训。 5.9.2 强序与弱序 令同步模型为对内存访问的一组约束，这些约束指定了需要如何以及何时完成同步，则当且仅当硬件与遵循该同步模型的所有软件顺序一致时，称该同步模型对于硬件而言满足弱序（Weak Ordering）。 5.9.3 免数据竞争范式 当一个程序在特定输入上具有顺序一致的执行顺序时，且其中两个相互冲突的操作同时执行，则称其为无数据竞争（Data-Race-Free, DRF）。 5.9.4 历史实践 C++ 是一个在内存模型方面实践优秀的一个例子。 线性一致性：又称强一致性或原子一致性。它要求任何一次读操作都能读到某个数据的最近一次写的数据，并且所有线程的操作顺序与全局时钟下的顺序是一致的。  x.store(1) x.load() G1 ---------+----------------+------&gt; G2 -------------------+-------------&gt; x.store(2) 在这种情况下线程 G1, G2 对 x 的两次写操作是原子的，且 x.store(1) 是严格的发生在 x.store(2) 之前，x.store(2) 严格的发生在 x.load() 之前。 值得一提的是，线性一致性对全局时钟的要求是难以实现的，这也是人们不断研究比这个一致性更弱条件下其他一致性的算法的原因。 顺序一致性：同样要求任何一次读操作都能读到数据最近一次写入的数据，但未要求与全局时钟的顺序一致。  x.store(1) x.</div><div class="notion-bookmark-link"><div class="notion-bookmark-link-icon"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%272000%27/%3e"/></span><img alt="5.9 内存一致模型" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRnwAAABXRUJQVlA4WAoAAAAQAAAADwAADwAAQUxQSD0AAAARL0AWYJocyO4IEugqIgK/FAohSXLmEE5hFR4hGPz6w3w2iOj/BPB/2HYPtOSwLIPa5mAvSdOwHUBmJj8BAFZQOCAYAAAAMAEAnQEqEAAQAAVAfCWkAANwAP7w5sAA&quot;)"/><noscript><img alt="5.9 内存一致模型" src="https://www.notion.so/image/https%3A%2F%2Fgolang.design%2Funder-the-hood%2Ffavicon.png?table=block&amp;id=c2d13cad-020f-4e31-9e37-7b0bfed1c883&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><div class="notion-bookmark-link-text">https://golang.design/under-the-hood/zh-cn/part1basic/ch05sync/mem/</div></div></div></a></div><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-d772c84a7288470fb5727ee663d840ab" data-id="d772c84a7288470fb5727ee663d840ab"><span><div id="d772c84a7288470fb5727ee663d840ab" class="notion-header-anchor"></div><a class="notion-hash-link" href="#d772c84a7288470fb5727ee663d840ab" title="8.6 #60: Misunderstanding Go contexts"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">8.6 #60: Misunderstanding Go contexts</span></span></h4><div class="notion-blank notion-block-a8d376b317f84cd9b3148ad7176d9e1b"> </div><h3 class="notion-h notion-h2 notion-h-indent-0 notion-block-c2b1bec366024ee29f324d77c553a7a5" data-id="c2b1bec366024ee29f324d77c553a7a5"><span><div id="c2b1bec366024ee29f324d77c553a7a5" class="notion-header-anchor"></div><a class="notion-hash-link" href="#c2b1bec366024ee29f324d77c553a7a5" title="9 Concurrency: Practice"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9 Concurrency: Practice</span></span></h3><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-5a466fc5c0394c7c97a9620f2d136d32" data-id="5a466fc5c0394c7c97a9620f2d136d32"><span><div id="5a466fc5c0394c7c97a9620f2d136d32" class="notion-header-anchor"></div><a class="notion-hash-link" href="#5a466fc5c0394c7c97a9620f2d136d32" title="9.1 #61: Propagating an inappropriate context（错误传递context）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.1 #61: Propagating an inappropriate context（错误传递context）</span></span></h4><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-cf7a70d4a1664ad6a1b928796d6c3d63"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%27720%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRkIAAABXRUJQVlA4IDYAAADwAQCdASoQAAYABUB8JQBdgCIhCA5MkBgA/u/D+wKXNbqWDcr/ALDtIhD/DxlKxDxIjiT4AAA=&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbibdjgitaj31q80meank.jpg?table=block&amp;id=cf7a70d4-a166-4ad6-a1b9-28796d6c3d63&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure><div class="notion-text notion-block-0123f31d91754e75a1f25bd45fcfb612">为了能够异步执行写入消息队列的动作，又能继承来自request context中的值，我们可以编写自定义的context，只继承父context的值。</div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">type detach struct {
	ctx context.Context
}

func (d detach) Deadline() (time.Time, bool) {
	return time.Time{}, false
}

func (d detach) Done() &lt;-chan struct{} {
	return nil
}

func (d detach) Err() error {
	return nil
}

func (d detach) Value(key any) any {
	return d.ctx.Value(key)
}

func handler(w http.ResponseWriter, r *http.Request) {
	response, err := doSomeTask(r.Context(), r)
	if err != nil {
		http.Error(w, err.Error(), http.StatusInternalServerError)
		return
	}

	go func() {
		err := publish(detach{ctx: r.Context()}, response)
		// Do something with err
		_ = err
	}()

	writeResponse(response)
}</code></pre><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-9f6aff3b0c784ae2812685c866c15393" data-id="9f6aff3b0c784ae2812685c866c15393"><span><div id="9f6aff3b0c784ae2812685c866c15393" class="notion-header-anchor"></div><a class="notion-hash-link" href="#9f6aff3b0c784ae2812685c866c15393" title="9.2 #62: Starting a goroutine without knowing when to stop it（管理好协程）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.2 #62: Starting a goroutine without knowing when to stop it（管理好协程）</span></span></h4><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">func main() {
	w := newWatcher()
	defer w.close()

	// Run the application
}

func newWatcher() watcher {
	w := watcher{}
	go w.watch()
	return w
}

type watcher struct { /* Some resources */
}

func (w watcher) watch() {}

func (w watcher) close() {
	// Close the resources
}</code></pre><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-255963cd490e4c81be70d07858aaa2ee" data-id="255963cd490e4c81be70d07858aaa2ee"><span><div id="255963cd490e4c81be70d07858aaa2ee" class="notion-header-anchor"></div><a class="notion-hash-link" href="#255963cd490e4c81be70d07858aaa2ee" title="9.3 #63: Not being careful with goroutines and loop variables（在range loop中执行协程，注意不要引用range生成的变量）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.3 #63: Not being careful with goroutines and loop variables（在range loop中执行协程，注意不要引用range生成的变量）</span></span></h4><div class="notion-text notion-block-dfcc4d9861f449eb8deae93e16f9ca93">参考 <a class="notion-link" href="https://yangsoon.github.io/100-go-mistakes-and-how-to-avoid-them--1#f78ef2507ea64ebda88578bfb188720c">#30</a></div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">func listing1() {
	s := []int{1, 2, 3}
	// 协程打印的结果可能会出现相同的值
	for _, i := range s {
		go func() {
			fmt.Print(i)
		}()
	}
}
// 解决方案一
func listing2() {
	s := []int{1, 2, 3}
	
	for _, i := range s {
		val := i
		go func() {
			fmt.Print(val)
		}()
	}
}
// 解决方案二
func listing3() {
	s := []int{1, 2, 3}

	for _, i := range s {
		go func(val int) {
			fmt.Print(val)
		}(i)
	}
}</code></pre><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-cc9257701c7b4ae5823f025bd222029b" data-id="cc9257701c7b4ae5823f025bd222029b"><span><div id="cc9257701c7b4ae5823f025bd222029b" class="notion-header-anchor"></div><a class="notion-hash-link" href="#cc9257701c7b4ae5823f025bd222029b" title="9.4 #64: Expecting deterministic behavior using select and channels（错误的以为 select 的执行结果是确定的）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.4 #64: Expecting deterministic behavior using select and channels（错误的以为 select 的执行结果是确定的）</span></span></h4><ul class="notion-list notion-list-disc notion-block-fccf2654571d4d2092266509e082c70c"><li>select 中的 case 执行时机是随机的</li></ul><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-4c4b43ef4eda4ed29773699c3d1943db"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%27888%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRkAAAABXRUJQVlA4IDQAAABwAQCdASoQAAcABUB8JQAAXILjAAD+78P0LX+qJKHEgMI0ar+zRjIgffCYuPUeFApoAAAA&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjjepyykqj31ca0lg47c.jpg?table=block&amp;id=4c4b43ef-4eda-4ed2-9773-699c3d1943db&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure><div class="notion-text notion-block-34f14f8a46164a189c6989de6aa6781c">解决方案可以是使用for-select嵌套：</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-ae22c659121143ce9e835a792f1a021a"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%271079%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRigAAABXRUJQVlA4IBwAAAAwAQCdASoQAAkABUB8JaQAA3AA/vCTr0unFgAA&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjjgb39klj310s0juwh4.jpg?table=block&amp;id=ae22c659-1211-43ce-9e83-5a792f1a021a&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-0adc00225b0949c593a91ba31aff7abb" data-id="0adc00225b0949c593a91ba31aff7abb"><span><div id="0adc00225b0949c593a91ba31aff7abb" class="notion-header-anchor"></div><a class="notion-hash-link" href="#0adc00225b0949c593a91ba31aff7abb" title="9.5 #65: Not using notification channels（chan struct{} 可以用于通知事件）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.5 #65: Not using notification channels（chan struct{} 可以用于通知事件）</span></span></h4><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">// struct{} 不占用内存，经常用于通知场景
chan struct{}</code></pre><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-1f280e09a0dd42168597b64b70fef159" data-id="1f280e09a0dd42168597b64b70fef159"><span><div id="1f280e09a0dd42168597b64b70fef159" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1f280e09a0dd42168597b64b70fef159" title="9.6 #66: Not using nil channels（利用nil的channel读写都会block的特性）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.6 #66: Not using nil channels（利用nil的channel读写都会block的特性）</span></span></h4><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-0715f0c55f794522a41f27233d9ed647"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:480px;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%271225%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRkQAAABXRUJQVlA4IDgAAADQAQCdASoQAAoABUB8JZAAAudSvXUaAAD+78Nlqe7GDD+q7mOMW/2C5MYVqQTcWQBmV3rBjogAAA==&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjjsatms6j310a0m8q8p.jpg?table=block&amp;id=0715f0c5-5f79-4522-a41f-27233d9ed647&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure><ul class="notion-list notion-list-disc notion-block-7d4a3d12980440f6a65897353929b8e6"><li>GO对于close的channel仍然能够读取到0值，所以需要使用  <code class="notion-inline-code">v, open := &lt;-ch</code> 语法中的open来判断channel是否被close</li></ul><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-8e1c18ad763a475e89f7e6bc06005ee2"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:576px;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%271547%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRjQAAABXRUJQVlA4ICgAAABwAQCdASoQAAwABUB8JQAAXOi1gAD+78PTalf6BwRerTmRXpyaRDAA&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjjx84ansj31bs10yaip.jpg?table=block&amp;id=8e1c18ad-763a-475e-89f7-e6bc06005ee2&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure><div class="notion-text notion-block-b8eaa0a4d4354ee095514733f8163b15"><b>解决方案：通过 </b><b><code class="notion-inline-code">v, open := &lt;-ch</code></b><b> 语法判断 chan 是否被close，避免读取0值，close之后的channel置为nil，避免for循环空转</b></div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-5f0c7c0c7607468f85ebd4b215228044"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:576px;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%271369%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRjgAAABXRUJQVlA4ICwAAACwAQCdASoQAAsABUB8JQAAXQXhlZwAAP7vvWec+Y0zLFdOWoXJvR5h4AAAAA==&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjjzxzub1j31520s445i.jpg?table=block&amp;id=5f0c7c0c-7607-468f-85eb-d4b215228044&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-08e9a857ec474fdb8aa9c5bc48c869ed" data-id="08e9a857ec474fdb8aa9c5bc48c869ed"><span><div id="08e9a857ec474fdb8aa9c5bc48c869ed" class="notion-header-anchor"></div><a class="notion-hash-link" href="#08e9a857ec474fdb8aa9c5bc48c869ed" title="9.7 #67: Being puzzled about channel size（不清楚channel的大小如何设置）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.7 #67: Being puzzled about channel size（不清楚channel的大小如何设置）</span></span></h4><ul class="notion-list notion-list-disc notion-block-e8cdcd4cee404960a078eafd872eafb5"><li>无缓存的channel可以用于同步场景</li></ul><ul class="notion-list notion-list-disc notion-block-0546b16358e443c39e72b73acad85c60"><li>带有缓存的channel经常用于传递消息，控制协程数量等等</li></ul><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-f2c2e94e998a4de7a5aebcf06d550ed8" data-id="f2c2e94e998a4de7a5aebcf06d550ed8"><span><div id="f2c2e94e998a4de7a5aebcf06d550ed8" class="notion-header-anchor"></div><a class="notion-hash-link" href="#f2c2e94e998a4de7a5aebcf06d550ed8" title="9.8 #68: Forgetting about possible side effects with string formatting（字符串格式化可能会带来的并发错误）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.8 #68: Forgetting about possible side effects with string formatting（字符串格式化可能会带来的并发错误）</span></span></h4><div class="notion-text notion-block-ee5bb67f6ad14fabbb0b1a7dce24d9c2">如下例子，在 age &lt; 0 的场景下 UpdateAge 会执行到 fmt.Errorf 函数并打印结构体c，fmt.Errorf会直接调用c结构的 String 方法导致死锁。</div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">type Customer struct {
	mutex sync.RWMutex
	id    string
	age   int
}

func (c *Customer) UpdateAge(age int) error {
	c.mutex.Lock()
	defer c.mutex.Unlock()

	if age &lt; 0 {
		return fmt.Errorf(&quot;age should be positive for customer %v&quot;, c)
	}

	c.age = age
	return nil
}

func (c *Customer) String() string {
	c.mutex.RLock()
	defer c.mutex.RUnlock()
	return fmt.Sprintf(&quot;id %s, age %d&quot;, c.id, c.age)
}</code></pre><div class="notion-text notion-block-6cfd237816aa497193d6409a1d72e941">解决方案是缩小加锁的范围，只在对临界区的值进行修改的时候才加锁</div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">func (c *Customer) UpdateAge2(age int) error {
	if age &lt; 0 {
		return fmt.Errorf(&quot;age should be positive for customer %v&quot;, c)
	}

	c.mutex.Lock()
	defer c.mutex.Unlock()

	c.age = age
	return nil
}</code></pre><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-a48e9d534a7b4ccd98c663a6fa09431b" data-id="a48e9d534a7b4ccd98c663a6fa09431b"><span><div id="a48e9d534a7b4ccd98c663a6fa09431b" class="notion-header-anchor"></div><a class="notion-hash-link" href="#a48e9d534a7b4ccd98c663a6fa09431b" title="9.9 #69: Creating data races with append（使用append函数的时候出现data race）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.9 #69: Creating data races with append（使用append函数的时候出现data race）</span></span></h4><ul class="notion-list notion-list-disc notion-block-453398a11f7d4d7fa1a2e55388f769ed"><li>注意append操作不是线程安全的</li></ul><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-afeef38e58d141e490fb9eb2c37f6023"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%27919%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRjQAAABXRUJQVlA4ICgAAACwAQCdASoQAAcABUB8JZQAAxZgjkQAAP7nrpu3K66aoH3cjtsAS8gA&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjh3fld7pj31eg0n6n7d.jpg?table=block&amp;id=afeef38e-58d1-41e4-90fb-9eb2c37f6023&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-0ffe02a27a294bee80cb975ea1a74581" data-id="0ffe02a27a294bee80cb975ea1a74581"><span><div id="0ffe02a27a294bee80cb975ea1a74581" class="notion-header-anchor"></div><a class="notion-hash-link" href="#0ffe02a27a294bee80cb975ea1a74581" title="9.10 #70: Using mutexes inaccurately with slices and maps（错误的给slice和map加锁）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.10 #70: Using mutexes inaccurately with slices and maps（错误的给slice和map加锁）</span></span></h4><div class="notion-text notion-block-88f060bd7d3f4788ba4ebfbc76dab641">当有2个协程同事调用 AddBalance 和 AverageBalance，还会出现data race，因为 AverageBalance 中对 c.balances 只拷贝引用，对slice同理。</div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">type Cache struct {
	mu       sync.RWMutex
	balances map[string]float64
}

func (c *Cache) AddBalance(id string, balance float64) {
	c.mu.Lock()
	c.balances[id] = balance
	c.mu.Unlock()
}

func (c *Cache) AverageBalance() float64 {
	c.mu.RLock()
	balances := c.balances
	c.mu.RUnlock()

	sum := 0.
	for _, balance := range balances {
		sum += balance
	}
	return sum / float64(len(balances))
}</code></pre><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-beeca05016534a87b16010addf066c52" data-id="beeca05016534a87b16010addf066c52"><span><div id="beeca05016534a87b16010addf066c52" class="notion-header-anchor"></div><a class="notion-hash-link" href="#beeca05016534a87b16010addf066c52" title="9.11 #71: Misusing sync.WaitGroup（错误使用 sync.WaitGroup）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.11 #71: Misusing sync.WaitGroup（错误使用 sync.WaitGroup）</span></span></h4><div class="notion-text notion-block-f77b15bb406e4855b5ef24046fc192d3">因为 for 循环创建的3个协程是异步执行，可能执行到wg.Wait的时候有2个协程已经执行成功并退出了，所以v的值可能为2</div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">func main() {
	wg := sync.WaitGroup{}
	var v uint64

	for i := 0; i &lt; 3; i++ {
		go func() {
			wg.Add(1)
			atomic.AddUint64(&amp;v, 1)
			wg.Done()
		}()
	}

	wg.Wait()
	fmt.Println(v)
}</code></pre><div class="notion-text notion-block-8d2479834f18442da7c4b6bbb17290c7">解决方案一</div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">func main() {
	wg := sync.WaitGroup{}
	var v uint64

	wg.Add(3)
	for i := 0; i &lt; 3; i++ {
		go func() {
			atomic.AddUint64(&amp;v, 1)
			wg.Done()
		}()
	}

	wg.Wait()
	fmt.Println(v)
}</code></pre><div class="notion-text notion-block-6c29ce3f4eed49b593c858df7a2a7e2b">解决方案二</div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">func main() {
	wg := sync.WaitGroup{}
	var v uint64

	for i := 0; i &lt; 3; i++ {
		wg.Add(1)
		go func() {
			atomic.AddUint64(&amp;v, 1)
			wg.Done()
		}()
	}

	wg.Wait()
	fmt.Println(v)
}</code></pre><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-21c7ccf6a3364bb6bcfa675201e730b7" data-id="21c7ccf6a3364bb6bcfa675201e730b7"><span><div id="21c7ccf6a3364bb6bcfa675201e730b7" class="notion-header-anchor"></div><a class="notion-hash-link" href="#21c7ccf6a3364bb6bcfa675201e730b7" title="9.12 #72: Forgetting about sync.Cond（别忘记条件变量sync.Cond）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.12 #72: Forgetting about sync.Cond（别忘记条件变量sync.Cond）</span></span></h4><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-b2f2680997644f19a03422447742004b" href="https://geektutu.com/post/hpg-sync-cond.html"><div><div class="notion-bookmark-title">Go sync.Cond | Go 语言高性能编程 | 极客兔兔</div><div class="notion-bookmark-description">Go 语言/golang 高性能编程，Go 语言进阶教程，Go 语言高性能编程(high performance go)。sync.Cond 是一个条件锁，也被称为条件变量，常用来一写多读(一个 goroutine 通知多个在等待的 goroutines)的场景。</div><div class="notion-bookmark-link"><div class="notion-bookmark-link-icon"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%272000%27/%3e"/></span><img alt="Go sync.Cond | Go 语言高性能编程 | 极客兔兔" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRmYAAABXRUJQVlA4IFoAAABwAgCdASoQABAABUB8JbACdH8AFC6wyImyc7DAAPaOm7ZuB9T9glxeiEuAabs/A/Yx58LekgPLrFy+aWU25Bqx00Pi1ZMHr4aDoxmAEN/qo7Ux6LN80bBgAAA=&quot;)"/><noscript><img alt="Go sync.Cond | Go 语言高性能编程 | 极客兔兔" src="https://www.notion.so/image/https%3A%2F%2Fgeektutu.com%2Fimg%2Ficon.png?table=block&amp;id=b2f26809-9764-4f19-a034-22447742004b&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><div class="notion-bookmark-link-text">https://geektutu.com/post/hpg-sync-cond.html</div></div></div></a></div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">func main() {
	type Donation struct {
		cond    *sync.Cond
		balance int
	}

	donation := &amp;Donation{
		cond: sync.NewCond(&amp;sync.Mutex{}),
	}

	// Listener goroutines
	f := func(goal int) {
		donation.cond.L.Lock()
		for donation.balance &lt; goal {
			donation.cond.Wait()
		}
		fmt.Printf(&quot;%d$ goal reached\n&quot;, donation.balance)
		donation.cond.L.Unlock()
	}

	go f(10)
	go f(15)

	// Updater goroutine
	for {
		time.Sleep(time.Second)
		donation.cond.L.Lock()
		donation.balance++
		donation.cond.L.Unlock()
		donation.cond.Broadcast()
	}
}</code></pre><div class="notion-text notion-block-1403eaf66acf49a0a0bf63b7110b08c8">使用Cond可以避免CPU空转的情况。</div><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-05073c8f5ad7409aa74519510ffa810a" data-id="05073c8f5ad7409aa74519510ffa810a"><span><div id="05073c8f5ad7409aa74519510ffa810a" class="notion-header-anchor"></div><a class="notion-hash-link" href="#05073c8f5ad7409aa74519510ffa810a" title="9.13 #73: Not using errgroup（使用 errgroup 采集多个协程执行结果）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.13 #73: Not using errgroup（使用 errgroup 采集多个协程执行结果）</span></span></h4><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-2ae63cfd1c6e411595d88c9cdad6ed48"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%27701%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRigAAABXRUJQVlA4IBwAAAAwAQCdASoQAAYABUB8JaQAA3AA/vBnJdvxRIAA&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjiirbgghj31f60hywhb.jpg?table=block&amp;id=2ae63cfd-1c6e-4115-95d8-8c9cdad6ed48&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure><div class="notion-text notion-block-57ce497e3cf849bcb7d80b07f519d22f">使用 <a target="_blank" rel="noopener noreferrer" class="notion-link" href="http://golang.org/x/sync/errgroup">golang.org/x/sync/errgroup</a> 采集多个协程的错误, 但是 errorgroup限制比较多，需要函数签名符合<code class="notion-inline-code">func() error {}</code> </div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-f399ca3ff7da4e33897a2bec1ce11812"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%271189%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRjIAAABXRUJQVlA4ICYAAAAwAQCdASoQAAoABUB8JZwAA3AA/vBkMLPCIt2QO3UjS1tNtwaAAA==&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjiqad262j31aq0rsaib.jpg?table=block&amp;id=f399ca3f-f7da-4e33-897a-2bec1ce11812&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure><div class="notion-text notion-block-13051c2fd25940038708bd92d9da1e65">k8s 中提供了集合多种错误的功能，可以参考 k8s.io/apimachinery/pkg/util/errors/errors.go:35</div><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-025990b71780448ebddbc41d3b01a39d" data-id="025990b71780448ebddbc41d3b01a39d"><span><div id="025990b71780448ebddbc41d3b01a39d" class="notion-header-anchor"></div><a class="notion-hash-link" href="#025990b71780448ebddbc41d3b01a39d" title="9.14 #74: Copying a sync type（同步类型的值不能被拷贝）"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">9.14 #74: Copying a sync type（同步类型的值不能被拷贝）</span></span></h4><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-ab42b85ce154496c89b6fe46d0422f90"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:528px;max-width:100%;flex-direction:column"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%272000%27%20height=%27950%27/%3e"/></span><img alt="notion image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover;background-size:cover;background-position:0% 0%;filter:blur(20px);background-image:url(&quot;data:image/webp;base64,UklGRjwAAABXRUJQVlA4IDAAAACwAQCdASoQAAgABUB8JQAAXUjdZLLAAP7vxEd0wiRocXfi5fbFND1NmUxfYhGGAAA=&quot;)"/><noscript><img alt="notion image" src="https://www.notion.so/image/http%3A%2F%2Ftva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjj0adk20j31200i2q9f.jpg?table=block&amp;id=ab42b85c-e154-496c-89b6-fe46d0422f90&amp;cache=v2" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div></figure></article><aside class="notion-aside"><div class="notion-aside-table-of-contents"><div class="notion-aside-table-of-contents-header">Table of Contents</div><nav class="notion-table-of-contents"><a href="#7c7869cc60ca4e108583d4a5062b6ac4" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-0"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">关于本书</span></a><a href="#0decdc5a63f64cbca101acf83211ccff" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-0"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">7 Error management</span></a><a href="#76b64bafa8dd4007a565664a00046b06" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">7.1 #48: Panicking（什么是panic）</span></a><a href="#c94b3a792507408d8aefc2d11343c7fc" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">7.2 #49: Ignoring when to wrap an error（不明确何时包装一个error，fmt.Errorf用法）</span></a><a href="#3cd2c017ab3e4a788dbb855fe703e324" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">7.3 #50: Checking an error type inaccurately（如何正确的判断Error类型-error.As用法）</span></a><a href="#6a42791f2d9547509eac5152c344224d" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">7.4 #51: Checking an error value inaccurately（如何正确的处理Error的值-error.Is用法）</span></a><a href="#17dbaba54db2446b89667b17d775b52b" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">7.5 #52: Handling an error twice（多次处理错误）</span></a><a href="#d5985c13735b497c862cab8b526e92e2" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">7.6 #53: Not handling an error（没有处理error）</span></a><a href="#2f5c6e56e9e644a1815addd5a1186c76" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">7.7 #54: Not handling defer errors（没有处理defer语句中的error）</span></a><a href="#71c585c466b9491d9911837721721de8" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-0"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">8 Concurrency: Foundations</span></a><a href="#d772c84a7288470fb5727ee663d840ab" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">8.6 #60: Misunderstanding Go contexts</span></a><a href="#c2b1bec366024ee29f324d77c553a7a5" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-0"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">9 Concurrency: Practice</span></a><a href="#5a466fc5c0394c7c97a9620f2d136d32" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.1 #61: Propagating an inappropriate context（错误传递context）</span></a><a href="#9f6aff3b0c784ae2812685c866c15393" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.2 #62: Starting a goroutine without knowing when to stop it（管理好协程）</span></a><a href="#255963cd490e4c81be70d07858aaa2ee" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.3 #63: Not being careful with goroutines and loop variables（在range loop中执行协程，注意不要引用range生成的变量）</span></a><a href="#cc9257701c7b4ae5823f025bd222029b" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.4 #64: Expecting deterministic behavior using select and channels（错误的以为 select 的执行结果是确定的）</span></a><a href="#0adc00225b0949c593a91ba31aff7abb" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.5 #65: Not using notification channels（chan struct{} 可以用于通知事件）</span></a><a href="#1f280e09a0dd42168597b64b70fef159" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.6 #66: Not using nil channels（利用nil的channel读写都会block的特性）</span></a><a href="#08e9a857ec474fdb8aa9c5bc48c869ed" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.7 #67: Being puzzled about channel size（不清楚channel的大小如何设置）</span></a><a href="#f2c2e94e998a4de7a5aebcf06d550ed8" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.8 #68: Forgetting about possible side effects with string formatting（字符串格式化可能会带来的并发错误）</span></a><a href="#a48e9d534a7b4ccd98c663a6fa09431b" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.9 #69: Creating data races with append（使用append函数的时候出现data race）</span></a><a href="#0ffe02a27a294bee80cb975ea1a74581" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.10 #70: Using mutexes inaccurately with slices and maps（错误的给slice和map加锁）</span></a><a href="#beeca05016534a87b16010addf066c52" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.11 #71: Misusing sync.WaitGroup（错误使用 sync.WaitGroup）</span></a><a href="#21c7ccf6a3364bb6bcfa675201e730b7" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.12 #72: Forgetting about sync.Cond（别忘记条件变量sync.Cond）</span></a><a href="#05073c8f5ad7409aa74519510ffa810a" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.13 #73: Not using errgroup（使用 errgroup 采集多个协程执行结果）</span></a><a href="#025990b71780448ebddbc41d3b01a39d" class="notion-table-of-contents-item notion-table-of-contents-item-indent-level-1"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:16px">9.14 #74: Copying a sync type（同步类型的值不能被拷贝）</span></a></nav></div></aside></div><div class="styles_comments__YEupF"><div><p>Loading Comments...</p></div></div></main><footer class="styles_footer__RBpyk"><div class="styles_copyright__nhL_k">Copyright 2022 <!-- -->yangsoon</div><div class="styles_settings__GyEhi"></div><div class="styles_social__ptL3p"><a class="styles_github__0JN7a" href="https://yangsoon.github.io" title="YangSoon @yangsoon.github.io" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M8 3.293l6 6V13.5a1.5 1.5 0 01-1.5 1.5h-9A1.5 1.5 0 012 13.5V9.293l6-6zm5-.793V6l-2-2V2.5a.5.5 0 01.5-.5h1a.5.5 0 01.5.5z" clip-rule="evenodd"></path><path fill-rule="evenodd" d="M7.293 1.5a1 1 0 011.414 0l6.647 6.646a.5.5 0 01-.708.708L8 2.207 1.354 8.854a.5.5 0 11-.708-.708L7.293 1.5z" clip-rule="evenodd"></path></svg></a><a class="styles_github__0JN7a" href="https://github.com/yangsoon" title="GitHub @yangsoon" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a class="styles_zhihu__Z7IC7" href="https://zhihu.com/people/yangsoon" title="Zhihu @yangsoon" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z"></path></svg></a><a class="styles_twitter__3YoqL" href="https://twitter.com/yangsoonlx" title="Twitter @yangsoonlx" target="_blank" rel="noopener noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a></div></footer></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"site":{"domain":"yangsoon.github.io","name":"YangSoon","rootNotionPageId":"72a669717cf642c2a2524439d99d8f44","rootNotionSpaceId":null,"description":"YangSoon, Cloud Native Developer"},"recordMap":{"block":{"f8e41082-81f4-4d47-a6f3-3489e7c3453c":{"role":"reader","value":{"id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","version":687,"type":"page","properties":{"Zr\u003cq":[["golang"]],"z`pV":[["WIP(80%)"]],"title":[["100 Go Mistakes and How to Avoid Them - 2"]]},"content":["a85d9fed-92aa-4cf4-ae92-00751ec8ab5b","7c7869cc-60ca-4e10-8583-d4a5062b6ac4","164f95cb-c34d-469c-b85c-2bc356b4e3c0","0decdc5a-63f6-4cbc-a101-acf83211ccff","76b64baf-a8dd-4007-a565-664a00046b06","db506446-b2b1-4506-ad5e-c86683194e91","c94b3a79-2507-408d-8aef-c2d11343c7fc","91b46093-1166-42ec-bf70-9fcf8d6b87ec","aa034550-14d1-4e86-8475-807cfc28c526","104c6b88-dfb3-4253-8e26-66b685beae33","b0dbcc2b-d143-444f-a9c4-fa7b2bd1466a","476a8035-98db-443c-b303-57897ee1a5b3","d063db16-6f75-400f-8397-8a908920b734","fe958b5d-0a7c-4d06-a05a-39fff22ece70","5eea680d-96d5-4622-bf61-fc9df8741066","8e9fc5af-f060-464f-83fb-8f2954c0406e","3cd2c017-ab3e-4a78-8dbb-855fe703e324","92fe02f6-abe8-4191-b122-9174b3a93017","cc26dc03-b1fd-4a0c-8aea-2d47acc1d32e","6a42791f-2d95-4750-9eac-5152c344224d","cf04f3b6-9852-4ecc-af8a-394a75a9d1da","e331508f-44af-4e24-88ca-94e3be618be7","a1743b61-d7ec-4a81-9de9-17c0c47a8499","00be8470-9c61-41e1-b49a-c4e652c48e70","a8ae21ec-bb85-4c71-af75-fab84fc7b7dd","17dbaba5-4db2-446b-8966-7b17d775b52b","ff246c9e-e04f-4661-9c0a-3baffd9239d3","d5985c13-735b-497c-862c-ab8b526e92e2","313fa910-9059-498c-8d59-5a950ed0f995","57f95bce-c9bb-4270-a8dd-92a40ef3a1a3","2f5c6e56-e9e6-44a1-815a-ddd5a1186c76","d673a08e-511e-4053-8d79-ee1ff9fe4cef","c6b629f6-76c9-49c2-8d26-ce643e0eb665","e56a2dd0-827d-4a93-a846-c995966af5e2","71c585c4-66b9-491d-9911-837721721de8","c2d13cad-020f-4e31-9e37-7b0bfed1c883","d772c84a-7288-470f-b572-7ee663d840ab","a8d376b3-17f8-4cd9-b314-8ad7176d9e1b","c2b1bec3-6602-4ee2-9f32-4d77c553a7a5","5a466fc5-c039-4c7c-97a9-620f2d136d32","cf7a70d4-a166-4ad6-a1b9-28796d6c3d63","0123f31d-9175-4e75-a1f2-5bd45fcfb612","3dd7eaf0-156f-4c6a-bdcd-3a55c5fbcb3a","9f6aff3b-0c78-4ae2-8126-85c866c15393","205795a0-9ae6-4bb9-b9b4-84402296fb54","255963cd-490e-4c81-be70-d07858aaa2ee","dfcc4d98-61f4-49eb-8dea-e93e16f9ca93","c1fd97d9-c1ee-4dd1-9332-36d5595b086c","cc925770-1c7b-4ae5-823f-025bd222029b","fccf2654-571d-4d20-9226-6509e082c70c","4c4b43ef-4eda-4ed2-9773-699c3d1943db","34f14f8a-4616-4a18-9c69-89de6aa6781c","ae22c659-1211-43ce-9e83-5a792f1a021a","0adc0022-5b09-49c5-93a9-1ba31aff7abb","9dded198-efb5-4a1e-bcd0-b9b75f8ec55b","1f280e09-a0dd-4216-8597-b64b70fef159","0715f0c5-5f79-4522-a41f-27233d9ed647","7d4a3d12-9804-40f6-a658-97353929b8e6","8e1c18ad-763a-475e-89f7-e6bc06005ee2","b8eaa0a4-d435-4ee0-9551-4733f8163b15","5f0c7c0c-7607-468f-85eb-d4b215228044","08e9a857-ec47-4fdb-8aa9-c5bc48c869ed","e8cdcd4c-ee40-4960-a078-eafd872eafb5","0546b163-58e4-43c3-9e72-b73acad85c60","f2c2e94e-998a-4de7-a5ae-bcf06d550ed8","ee5bb67f-6ad1-4fab-bb0b-1a7dce24d9c2","f3ffd82d-32aa-4f02-a213-4433dc49ac47","6cfd2378-16aa-4971-93d6-409a1d72e941","05126ba2-4ec4-4fc7-95da-075532c368a1","a48e9d53-4a7b-4ccd-98c6-63a6fa09431b","453398a1-1f7d-4d7f-a1a2-e55388f769ed","afeef38e-58d1-41e4-90fb-9eb2c37f6023","0ffe02a2-7a29-4bee-80cb-975ea1a74581","88f060bd-7d3f-4788-ba4e-bfbc76dab641","f02802f2-ac92-45b2-9e34-8249cc28f83c","beeca050-1653-4a87-b160-10addf066c52","f77b15bb-406e-4855-b5ef-24046fc192d3","96d2f9c4-34eb-4e34-bb63-49498741c591","8d247983-4f18-442d-a7c4-b6bbb17290c7","1246aa68-9cc7-4a6e-a08c-52954f88c4ff","6c29ce3f-4eed-49b5-93c8-58df7a2a7e2b","cd5ee62f-517b-47ff-9a8c-8225dda1402b","21c7ccf6-a336-4bb6-bcfa-675201e730b7","b2f26809-9764-4f19-a034-22447742004b","27550b2d-9cb9-4723-ab32-e19460bbdaf3","1403eaf6-6acf-49a0-a0bf-63b7110b08c8","05073c8f-5ad7-409a-a745-19510ffa810a","2ae63cfd-1c6e-4115-95d8-8c9cdad6ed48","57ce497e-3cf8-49bc-b7d8-0b07f519d22f","f399ca3f-f7da-4e33-897a-2bec1ce11812","13051c2f-d259-4003-8708-bd92d9da1e65","025990b7-1780-448e-bddb-c41d3b01a39d","ab42b85c-e154-496c-89b6-fe46d0422f90"],"format":{"page_icon":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a22fb73f-5a7d-4fdc-8319-52ed15316e76/images.jpeg","page_cover":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/47263733-11bc-4ae7-9e1e-c3401a49c171/Manning.100.Go.Mistakes.and.How.to.Avoid.Them.2022-1%EF%BC%88%E6%8B%96%E7%A7%BB%E9%A1%B9%E7%9B%AE%EF%BC%89.png","copied_from_pointer":{"id":"db80f497-e22c-4bff-bdcb-0ac06b5c4528","table":"block","spaceId":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"},"page_cover_position":0.8261},"created_time":1677290925684,"last_edited_time":1677594548268,"parent_id":"89829c97-9e4b-43b0-b37c-457a3da9ad96","parent_table":"collection","alive":true,"copied_from":"db80f497-e22c-4bff-bdcb-0ac06b5c4528","file_ids":["47263733-11bc-4ae7-9e1e-c3401a49c171","425f0231-9af0-4f62-a9f7-f9f567cfe460","a22fb73f-5a7d-4fdc-8319-52ed15316e76"],"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"e7596c25-bafa-4ece-94b6-e7973c7a2ab3":{"role":"reader","value":{"id":"e7596c25-bafa-4ece-94b6-e7973c7a2ab3","version":49,"type":"collection_view","view_ids":["11f62eb2-ba92-4ffd-91b4-c964b8cedfeb"],"collection_id":"89829c97-9e4b-43b0-b37c-457a3da9ad96","format":{"collection_pointer":{"id":"89829c97-9e4b-43b0-b37c-457a3da9ad96","table":"collection","spaceId":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"},"copied_from_pointer":{"id":"4176c3f0-95d8-4ac1-9df1-7f705120857b","table":"block","spaceId":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"created_time":1667525160616,"last_edited_time":1677290922625,"parent_id":"72a66971-7cf6-42c2-a252-4439d99d8f44","parent_table":"block","alive":true,"copied_from":"4176c3f0-95d8-4ac1-9df1-7f705120857b","created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"72a66971-7cf6-42c2-a252-4439d99d8f44":{"role":"reader","value":{"id":"72a66971-7cf6-42c2-a252-4439d99d8f44","version":616,"type":"page","properties":{"title":[["流心家的羊"]]},"content":["23b11c7c-8146-4639-912c-14406e078331","416b3867-4b4b-4ac0-bc8e-196792a57c07","fec36412-bc7e-4ec3-972d-b67b1ddd20f8","8b4d1555-cb50-45a3-a875-87242a4548bb","4176c3f0-95d8-4ac1-9df1-7f705120857b","1118fa3e-20b3-488c-976d-3346081fde80","e7596c25-bafa-4ece-94b6-e7973c7a2ab3","20cd31e6-ea32-4c1b-b7ef-c70749c2f4cb","ab7c7afa-73c5-4b21-9759-89a9dee4d7e8","82aad922-cb77-4452-81bf-56f4e8e5a408"],"format":{"page_icon":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/37907dd5-3c76-4966-a419-daa027a84972/IMG_2189.jpg","page_full_width":false,"page_small_text":false,"copied_from_pointer":{"id":"bd32b787-e471-49f3-8941-174a9c6846b6","table":"block","spaceId":"bb9288f4-efb5-417f-bf44-1a79fa04feb1"}},"permissions":[{"role":"editor","type":"user_permission","user_id":"d1805983-7869-451d-bf8b-64135a5d4ee7"},{"role":"reader","type":"public_permission","added_timestamp":1660963691744,"allow_duplicate":false}],"created_time":1660961589760,"last_edited_time":1677584050499,"parent_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6","parent_table":"space","alive":true,"copied_from":"bd32b787-e471-49f3-8941-174a9c6846b6","file_ids":["63e89fe9-f5cd-4414-be0e-53d91aa54fc3","37907dd5-3c76-4966-a419-daa027a84972"],"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"a85d9fed-92aa-4cf4-ae92-00751ec8ab5b":{"role":"reader","value":{"id":"a85d9fed-92aa-4cf4-ae92-00751ec8ab5b","version":34,"type":"callout","properties":{"title":[["本文是 100 Go Mistakes读书笔记 的下篇"]]},"format":{"page_icon":"💡","block_color":"gray_background"},"created_time":1677291093556,"last_edited_time":1677396896301,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"7c7869cc-60ca-4e10-8583-d4a5062b6ac4":{"role":"reader","value":{"id":"7c7869cc-60ca-4e10-8583-d4a5062b6ac4","version":36,"type":"sub_header","properties":{"title":[["关于本书"]]},"created_time":1677396013332,"last_edited_time":1677396018423,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"164f95cb-c34d-469c-b85c-2bc356b4e3c0":{"role":"reader","value":{"id":"164f95cb-c34d-469c-b85c-2bc356b4e3c0","version":10,"type":"bookmark","properties":{"link":[["https://book.douban.com/subject/36084407/"]],"title":[["100 Go Mistakes and How to Avoid Them"]],"description":[["Spot errors in your Go code you didn’t even know you were making and boost your productivity by avoi..."]]},"format":{"bookmark_icon":"https://img1.doubanio.com/favicon.ico","bookmark_cover":"https://img2.doubanio.com/view/subject/l/public/s34311243.jpg"},"created_time":1677396001021,"last_edited_time":1677396001024,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"0decdc5a-63f6-4cbc-a101-acf83211ccff":{"role":"reader","value":{"id":"0decdc5a-63f6-4cbc-a101-acf83211ccff","version":29,"type":"sub_header","properties":{"title":[["7 Error management"]]},"created_time":1677291024848,"last_edited_time":1677291039984,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"76b64baf-a8dd-4007-a565-664a00046b06":{"role":"reader","value":{"id":"76b64baf-a8dd-4007-a565-664a00046b06","version":45,"type":"sub_sub_header","properties":{"title":[["7.1 #48: Panicking（什么是panic）"]]},"created_time":1677292203010,"last_edited_time":1677294732692,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"db506446-b2b1-4506-ad5e-c86683194e91":{"role":"reader","value":{"id":"db506446-b2b1-4506-ad5e-c86683194e91","version":333,"type":"code","properties":{"title":[["func main() {\n  // 在defer中执行 recover 可以恢复panic，defer也会在周围出现panic的时候执行\n\tdefer func() {\n\t\tif r := recover(); r != nil {\n\t\t\tfmt.Println(\"recover\", r)\n\t\t}\n\t}()\n\tf()\n}\nfunc f() {\n\tfmt.Println(\"a\")\n\tpanic(\"foo\")\n\tfmt.Println(\"b\")\n}"]],"language":[["Go"]]},"created_time":1677292570881,"last_edited_time":1677292814251,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"c94b3a79-2507-408d-8aef-c2d11343c7fc":{"role":"reader","value":{"id":"c94b3a79-2507-408d-8aef-c2d11343c7fc","version":167,"type":"sub_sub_header","properties":{"title":[["7.2 #49: Ignoring when to wrap an error（不明确何时包装一个error，fmt.Errorf用法）"]]},"created_time":1677293210806,"last_edited_time":1677299316602,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"91b46093-1166-42ec-bf70-9fcf8d6b87ec":{"role":"reader","value":{"id":"91b46093-1166-42ec-bf70-9fcf8d6b87ec","version":168,"type":"text","properties":{"title":[["在如下场景你可以选择包装一下error："]]},"created_time":1677293269422,"last_edited_time":1677294355241,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"aa034550-14d1-4e86-8475-807cfc28c526":{"role":"reader","value":{"id":"aa034550-14d1-4e86-8475-807cfc28c526","version":265,"type":"numbered_list","properties":{"title":[["你需要在错误上增加一些上下文"]]},"created_time":1677293957481,"last_edited_time":1677293981449,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"104c6b88-dfb3-4253-8e26-66b685beae33":{"role":"reader","value":{"id":"104c6b88-dfb3-4253-8e26-66b685beae33","version":248,"type":"numbered_list","properties":{"title":[["你需要把错误封装在另一个错误内"]]},"created_time":1677293981774,"last_edited_time":1677294353841,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"b0dbcc2b-d143-444f-a9c4-fa7b2bd1466a":{"role":"reader","value":{"id":"b0dbcc2b-d143-444f-a9c4-fa7b2bd1466a","version":7,"type":"column_list","content":["a0af9c7a-485d-4991-b55f-fc99c001c7cd","0bbfdf78-648f-4f12-bb15-c263feb01acc"],"created_time":1677294255341,"last_edited_time":1677294255345,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"a0af9c7a-485d-4991-b55f-fc99c001c7cd":{"role":"reader","value":{"id":"a0af9c7a-485d-4991-b55f-fc99c001c7cd","version":7,"type":"column","content":["7b47c760-07b5-4458-91c0-27039f752bed"],"format":{"column_ratio":0.5},"created_time":1677294255341,"last_edited_time":1677294255345,"parent_id":"b0dbcc2b-d143-444f-a9c4-fa7b2bd1466a","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"0bbfdf78-648f-4f12-bb15-c263feb01acc":{"role":"reader","value":{"id":"0bbfdf78-648f-4f12-bb15-c263feb01acc","version":6,"type":"column","content":["29ea918e-04ec-4527-8b38-0076f604b0a5"],"format":{"column_ratio":0.5},"created_time":1677294255343,"last_edited_time":1677294255345,"parent_id":"b0dbcc2b-d143-444f-a9c4-fa7b2bd1466a","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"7b47c760-07b5-4458-91c0-27039f752bed":{"role":"reader","value":{"id":"7b47c760-07b5-4458-91c0-27039f752bed","version":14,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbfjzjehr4j30tc0ccq5c.jpg"]]},"format":{"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbfjzjehr4j30tc0ccq5c.jpg"},"created_time":1677294203420,"last_edited_time":1677294255345,"parent_id":"a0af9c7a-485d-4991-b55f-fc99c001c7cd","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"29ea918e-04ec-4527-8b38-0076f604b0a5":{"role":"reader","value":{"id":"29ea918e-04ec-4527-8b38-0076f604b0a5","version":15,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbfjzrczn0j30t00bmgnc.jpg"]]},"format":{"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbfjzrczn0j30t00bmgnc.jpg"},"created_time":1677294216319,"last_edited_time":1677294255345,"parent_id":"0bbfdf78-648f-4f12-bb15-c263feb01acc","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"476a8035-98db-443c-b303-57897ee1a5b3":{"role":"reader","value":{"id":"476a8035-98db-443c-b303-57897ee1a5b3","version":185,"type":"text","properties":{"title":[["GO支持如下几种包装error的方式："]]},"created_time":1677294259429,"last_edited_time":1677294520912,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"d063db16-6f75-400f-8397-8a908920b734":{"role":"reader","value":{"id":"d063db16-6f75-400f-8397-8a908920b734","version":83,"type":"numbered_list","properties":{"title":[["自定义Error结构体"]]},"content":["220667b1-4edb-473c-a0d5-920c5a702a1b"],"created_time":1677294521443,"last_edited_time":1677294715630,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"220667b1-4edb-473c-a0d5-920c5a702a1b":{"role":"reader","value":{"id":"220667b1-4edb-473c-a0d5-920c5a702a1b","version":74,"type":"code","properties":{"title":[["type BarError struct {\n\tErr error\n}\n\nfunc (b BarError) Error() string {\n\treturn \"bar failed:\" + b.Err.Error()\n}\n\nfunc test() {\n\terr := bar()\n\tif err != nil {\n\t\treturn BarError{Err: err}\n\t}\n}"]],"language":[["Go"]]},"created_time":1677294587323,"last_edited_time":1677294624021,"parent_id":"d063db16-6f75-400f-8397-8a908920b734","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"fe958b5d-0a7c-4d06-a05a-39fff22ece70":{"role":"reader","value":{"id":"fe958b5d-0a7c-4d06-a05a-39fff22ece70","version":191,"type":"numbered_list","properties":{"title":[["使用 fmt.Errorf 方法，⚠️ %w 和 %v 有不同的执行效果"]]},"content":["4f3b56c1-9172-45de-92a6-9830d93e06fc"],"created_time":1677294714721,"last_edited_time":1677295436285,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"4f3b56c1-9172-45de-92a6-9830d93e06fc":{"role":"reader","value":{"id":"4f3b56c1-9172-45de-92a6-9830d93e06fc","version":1178,"type":"code","properties":{"title":[["if err != nil {\n\t\t// 使用 %w 指令，会返回一个包装了err的错误，接收方可以从父error中获取到源error\n\t\t// 并根据判断错误是否为某一个错误类型\n\t\t// sourceErr --wrap--\u003e WrapErr(sourceErr)\n    return fmt.Errorf(\"bar failed: %w\", err)\n}\n\nif err != nil {\n\t\t// 使用 %v 指令，不会包装错误，会直接转化为另一个错误，源错误不再可用\n    // sourceErr --transform--\u003e otherErr\n    return fmt.Errorf(\"bar failed: %v\", err)\n}\n"]],"language":[["Go"]]},"created_time":1677294755363,"last_edited_time":1677295051738,"parent_id":"fe958b5d-0a7c-4d06-a05a-39fff22ece70","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"5eea680d-96d5-4622-bf61-fc9df8741066":{"role":"reader","value":{"id":"5eea680d-96d5-4622-bf61-fc9df8741066","version":10,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbfkkxdgp1j31gw0i6tel.jpg"]]},"format":{"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbfkkxdgp1j31gw0i6tel.jpg"},"created_time":1677295438230,"last_edited_time":1677295440903,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"8e9fc5af-f060-464f-83fb-8f2954c0406e":{"role":"reader","value":{"id":"8e9fc5af-f060-464f-83fb-8f2954c0406e","version":686,"type":"text","properties":{"title":[["如果保留源错误的信息，会有潜在的耦合信息，因为接收方需要直接函数实现的细节，需要知道被包装的错误是什么类型，所以没有特殊需求在使用fmt.Errorf的时候使用%v指令。"]]},"created_time":1677295447353,"last_edited_time":1677295639610,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"3cd2c017-ab3e-4a78-8dbb-855fe703e324":{"role":"reader","value":{"id":"3cd2c017-ab3e-4a78-8dbb-855fe703e324","version":187,"type":"sub_sub_header","properties":{"title":[["7.3 #50: Checking an error type inaccurately（如何正确的判断Error类型-error.As用法）"]]},"created_time":1677295625002,"last_edited_time":1677299300560,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"92fe02f6-abe8-4191-b122-9174b3a93017":{"role":"reader","value":{"id":"92fe02f6-abe8-4191-b122-9174b3a93017","version":34,"type":"code","properties":{"title":[["func handler(w http.ResponseWriter, r *http.Request) {\n\ttransactionID := r.URL.Query().Get(\"transaction\")\n\n\tamount, err := getTransactionAmount(transactionID)\n\tif err != nil {\n\t\tif errors.As(err, \u0026transientError{}) {\n\t\t\thttp.Error(w, err.Error(), http.StatusServiceUnavailable)\n\t\t} else {\n\t\t\thttp.Error(w, err.Error(), http.StatusBadRequest)\n\t\t}\n\t\treturn\n\t}\n\n\t// Write response\n\t_ = amount\n}\n\nfunc getTransactionAmount(transactionID string) (float32, error) {\n\t// Check transaction ID validity\n\n\tamount, err := getTransactionAmountFromDB(transactionID)\n\tif err != nil {\n\t\treturn 0, fmt.Errorf(\"failed to get transaction %s: %w\",\n\t\t\ttransactionID, err)\n\t}\n\treturn amount, nil\n}\n\nfunc getTransactionAmountFromDB(transactionID string) (float32, error) {\n\t// ...\n\tvar err error\n\tif err != nil {\n\t\treturn 0, transientError{err: err}\n\t}\n\t// ...\n\treturn 0, nil\n}"]],"language":[["Go"]]},"created_time":1677298025270,"last_edited_time":1677298065539,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"cc26dc03-b1fd-4a0c-8aea-2d47acc1d32e":{"role":"reader","value":{"id":"cc26dc03-b1fd-4a0c-8aea-2d47acc1d32e","version":473,"type":"text","properties":{"title":[["当使用%w指令或者结构体封装的方式包装一个错误的时候，可以使用 errors.As 递归判断错误类型，errors.As函数需要传递一个目标错误类型的指针。"]]},"created_time":1677295637489,"last_edited_time":1677298204646,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"6a42791f-2d95-4750-9eac-5152c344224d":{"role":"reader","value":{"id":"6a42791f-2d95-4750-9eac-5152c344224d","version":239,"type":"sub_sub_header","properties":{"title":[["7.4 #51: Checking an error value inaccurately（如何正确的处理Error的值-error.Is用法）"]]},"format":{"copied_from_pointer":{"id":"3cd2c017-ab3e-4a78-8dbb-855fe703e324","table":"block","spaceId":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"created_time":1677298199263,"last_edited_time":1677299292543,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"copied_from":"3cd2c017-ab3e-4a78-8dbb-855fe703e324","created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"cf04f3b6-9852-4ecc-af8a-394a75a9d1da":{"role":"reader","value":{"id":"cf04f3b6-9852-4ecc-af8a-394a75a9d1da","version":182,"type":"text","properties":{"title":[["sentinel error ",[["b"]]],["是指定义为全局变量的错误类型。"],["命名规约是以Err开头加上类型",[["b"]]],["。"]]},"created_time":1677298251378,"last_edited_time":1677298525470,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"e331508f-44af-4e24-88ca-94e3be618be7":{"role":"reader","value":{"id":"e331508f-44af-4e24-88ca-94e3be618be7","version":7,"type":"code","properties":{"title":[["import \"errors\"\nvar ErrFoo = errors.New(\"foo\")"]],"language":[["Go"]]},"created_time":1677298442204,"last_edited_time":1677298442535,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"a1743b61-d7ec-4a81-9de9-17c0c47a8499":{"role":"reader","value":{"id":"a1743b61-d7ec-4a81-9de9-17c0c47a8499","version":813,"type":"text","properties":{"title":[["这种类型的错误，有时候是程序允许存在的错误，比如查询数据库返回没有查询到结果的sql.ErrNoRows和io.Reader读取返回io.EOF.他们传递的信息客户端可以接受，并认为是正常的情况。"]]},"created_time":1677298398268,"last_edited_time":1677298853588,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"00be8470-9c61-41e1-b49a-c4e652c48e70":{"role":"reader","value":{"id":"00be8470-9c61-41e1-b49a-c4e652c48e70","version":641,"type":"text","properties":{"title":[["在查询数据的场景，我们想判断错误的值是否等于sql.ErrNoRows这种"],["sentinel error，",[["b"]]],["使用 == 可能会出现问题，因为ErrNoRows可能已经被包装过。对于这种问题，可以直接使用 "],["errors.Is",[["b"],["a","http://errors.Is"]]],[" ",[["b"]]],["来判断，他可以帮你递归判断出正确的错误。"]]},"created_time":1677299145007,"last_edited_time":1677299283955,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"a8ae21ec-bb85-4c71-af75-fab84fc7b7dd":{"role":"reader","value":{"id":"a8ae21ec-bb85-4c71-af75-fab84fc7b7dd","version":64,"type":"code","properties":{"title":[["func main() {\n\terr := query()\n\tif err != nil {\n\t\t// if err == sql.ErrNoRows {\n\t\tif errors.Is(err, sql.ErrNoRows) {\n\t\t\t// ...\n\t\t} else {\n\t\t\t// ...\n\t\t}\n\t}\n}\n\nfunc query() error {\n\treturn nil\n}"]],"language":[["Go"]]},"created_time":1677299093575,"last_edited_time":1677299142421,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"17dbaba5-4db2-446b-8966-7b17d775b52b":{"role":"reader","value":{"id":"17dbaba5-4db2-446b-8966-7b17d775b52b","version":128,"type":"sub_sub_header","properties":{"title":[["7.5 #52: Handling an error twice（多次处理错误）"]]},"created_time":1677307531800,"last_edited_time":1677308154505,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"ff246c9e-e04f-4661-9c0a-3baffd9239d3":{"role":"reader","value":{"id":"ff246c9e-e04f-4661-9c0a-3baffd9239d3","version":10,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbfqoq89goj31ja0tmani.jpg"]]},"format":{"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbfqoq89goj31ja0tmani.jpg"},"created_time":1677308112085,"last_edited_time":1677308114911,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"d5985c13-735b-497c-862c-ab8b526e92e2":{"role":"reader","value":{"id":"d5985c13-735b-497c-862c-ab8b526e92e2","version":51,"type":"sub_sub_header","properties":{"title":[["7.6 #53: Not handling an error（没有处理error）"]]},"created_time":1677308130897,"last_edited_time":1677308429032,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"313fa910-9059-498c-8d59-5a950ed0f995":{"role":"reader","value":{"id":"313fa910-9059-498c-8d59-5a950ed0f995","version":298,"type":"text","properties":{"title":[["如果代码中没有处理一个函数返回的error，需要编写注释明确指明不处理error的原因"]]},"created_time":1677308430132,"last_edited_time":1677308457699,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"57f95bce-c9bb-4270-a8dd-92a40ef3a1a3":{"role":"reader","value":{"id":"57f95bce-c9bb-4270-a8dd-92a40ef3a1a3","version":9,"type":"code","properties":{"title":[["// At-most once delivery.\n// Hence, it's accepted to miss some of them in case of errors.\n _ = notify()"]],"language":[["Go"]]},"created_time":1677308799865,"last_edited_time":1677308806084,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"2f5c6e56-e9e6-44a1-815a-ddd5a1186c76":{"role":"reader","value":{"id":"2f5c6e56-e9e6-44a1-815a-ddd5a1186c76","version":154,"type":"sub_sub_header","properties":{"title":[["7.7 #54: Not handling defer errors（没有处理defer语句中的error）"]]},"created_time":1677308477042,"last_edited_time":1677308676033,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"d673a08e-511e-4053-8d79-ee1ff9fe4cef":{"role":"reader","value":{"id":"d673a08e-511e-4053-8d79-ee1ff9fe4cef","version":923,"type":"text","properties":{"title":[["defer语句经常会做一些收尾工作，关闭socket，释放锁等..,有些语句会返回错误，如果不处理这些错误就会导致错误信息丢失，造成资源泄露等问题。本节提出了一个通过给错误返回值命名，在defer的时候把错误值赋值给返回结果，向上传递错误。"]]},"created_time":1677309507905,"last_edited_time":1677309618103,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"c6b629f6-76c9-49c2-8d26-ce643e0eb665":{"role":"reader","value":{"id":"c6b629f6-76c9-49c2-8d26-ce643e0eb665","version":10,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbfr8gkmhjj319a0hatdy.jpg"]]},"format":{"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbfr8gkmhjj319a0hatdy.jpg"},"created_time":1677309250974,"last_edited_time":1677309254348,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"e56a2dd0-827d-4a93-a846-c995966af5e2":{"role":"reader","value":{"id":"e56a2dd0-827d-4a93-a846-c995966af5e2","version":771,"type":"code","properties":{"title":[["// 一种解决方式是使用命名结果，把错误信息通过命名结果返回\nfunc getBalance(db *sql.DB, clientID string) (balance float32, err error) {\n\trows, err := db.Query(query, clientID)\n\tif err != nil {\n\t\treturn 0, err\n\t}\n\tdefer func() {\n\t\tcloseErr := rows.Close()\n\t\tif err != nil {\n\t\t\tif closeErr != nil {\n        // 如果db.Query语句也出现了执行错误，把close错误的信息打印出来\n\t\t\t\tlog.Printf(\"failed to close rows: %v\", err)\n\t\t\t}\n\t\t\treturn\n\t\t}\n\t\t// 当只要close的时候有错误，把closeErr赋值给err传递到上一层\n\t\terr = closeErr\n\t}()\n\n\t// Use rows\n\treturn 0, nil\n}"]],"language":[["Go"]]},"created_time":1677309378674,"last_edited_time":1677309503274,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"71c585c4-66b9-491d-9911-837721721de8":{"role":"reader","value":{"id":"71c585c4-66b9-491d-9911-837721721de8","version":13,"type":"sub_header","properties":{"title":[["8 Concurrency: Foundations"]]},"created_time":1677460048529,"last_edited_time":1677462029011,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"c2d13cad-020f-4e31-9e37-7b0bfed1c883":{"role":"reader","value":{"id":"c2d13cad-020f-4e31-9e37-7b0bfed1c883","version":12,"type":"bookmark","properties":{"link":[["https://golang.design/under-the-hood/zh-cn/part1basic/ch05sync/mem/"]],"title":[["5.9 内存一致模型"]],"description":[["5.9 内存一致模型 读者可能注意到了，无论是在谈论 Go 的运行时还是编译器，直到目前为止我们都有意无意的 尝试去回避 Go 语言的「内存模型」这个话题。 这有非常多的原因，作为本章的收尾，也是全书对 Go 语言同步原语与同步模式的一个总结， 我们最后来详细展开内存模型这个话题，解答读者心中的疑惑。 对为什么到目前为止我们都刻意的回避有关内存模型的内容作出一个相对完整的解释。 5.9.1 内存模型的重要性 内存一致模型，或称内存模型，是一份语言用户与语言自身、语言自身与所在的操作系统平台、 所在操作系统平台与硬件平台之间的契约。它定义了并行状态下拥有确定读取和写入的时序的条件， 并回答了一个共享变量是否具有足够的同步机制来保障一个线程的写入能否发生在另一个线程的读取之前这个问题。 在一份 Go 语言的程序被写成后，将经过编译器的转换与优化、所运行操作系统或虚拟机等动态优化器的优化，以及 CPU 硬件平台对指令流的优化才最终得以被执行。这个过程意味着，对于某一个变量的读取与写入操作，可能 被这个过程中任何一个中间步骤进行调整，从而偏离程序员在程序中所指定的原有顺序。 没有内存模型的保障，就无法正确的推演程序在最终被执行时的正确性。 内存模型的策略同样有着长期影响，并且直接决定了程序的可移植性和可维护性。 例如，过强的内存模型将约束硬件和编译器优化的空间，从而严重降低程序性能上限； 已经选择了强内存模型的硬件体系结构，无法在不破坏兼容性的情况下向更弱的内存模型进行迁移， 这种兼容性破坏所带来的代价就是要求其平台上的程序重新实现其源码。 这种横跨用户、软件与硬件三大领域的主题使得内存模型的设计愿景变得异常的困难，至今仍是一个开放的研究问题。因此在讨论 Go 语言的内存模型之前，我们还需要了解现有的内存模型、历史上软硬件平台之间形成契约的经验教训。 5.9.2 强序与弱序 令同步模型为对内存访问的一组约束，这些约束指定了需要如何以及何时完成同步，则当且仅当硬件与遵循该同步模型的所有软件顺序一致时，称该同步模型对于硬件而言满足弱序（Weak Ordering）。 5.9.3 免数据竞争范式 当一个程序在特定输入上具有顺序一致的执行顺序时，且其中两个相互冲突的操作同时执行，则称其为无数据竞争（Data-Race-Free, DRF）。 5.9.4 历史实践 C++ 是一个在内存模型方面实践优秀的一个例子。 线性一致性：又称强一致性或原子一致性。它要求任何一次读操作都能读到某个数据的最近一次写的数据，并且所有线程的操作顺序与全局时钟下的顺序是一致的。  x.store(1) x.load() G1 ---------+----------------+------\u003e G2 -------------------+-------------\u003e x.store(2) 在这种情况下线程 G1, G2 对 x 的两次写操作是原子的，且 x.store(1) 是严格的发生在 x.store(2) 之前，x.store(2) 严格的发生在 x.load() 之前。 值得一提的是，线性一致性对全局时钟的要求是难以实现的，这也是人们不断研究比这个一致性更弱条件下其他一致性的算法的原因。 顺序一致性：同样要求任何一次读操作都能读到数据最近一次写入的数据，但未要求与全局时钟的顺序一致。  x.store(1) x."]]},"format":{"bookmark_icon":"https://golang.design/under-the-hood/favicon.png"},"created_time":1677460051027,"last_edited_time":1677460054240,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"d772c84a-7288-470f-b572-7ee663d840ab":{"role":"reader","value":{"id":"d772c84a-7288-470f-b572-7ee663d840ab","version":17,"type":"sub_sub_header","properties":{"title":[["8.6 #60: Misunderstanding Go contexts"]]},"created_time":1677497058349,"last_edited_time":1677497065420,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"a8d376b3-17f8-4cd9-b314-8ad7176d9e1b":{"role":"reader","value":{"id":"a8d376b3-17f8-4cd9-b314-8ad7176d9e1b","version":7,"type":"text","created_time":1677497065831,"last_edited_time":1677499088017,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"c2b1bec3-6602-4ee2-9f32-4d77c553a7a5":{"role":"reader","value":{"id":"c2b1bec3-6602-4ee2-9f32-4d77c553a7a5","version":9,"type":"sub_header","properties":{"title":[["9 Concurrency: Practice"]]},"created_time":1677499091555,"last_edited_time":1677594501926,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"5a466fc5-c039-4c7c-97a9-620f2d136d32":{"role":"reader","value":{"id":"5a466fc5-c039-4c7c-97a9-620f2d136d32","version":77,"type":"sub_sub_header","properties":{"title":[["9.1 #61: Propagating an inappropriate context（错误传递context）"]]},"created_time":1677499100819,"last_edited_time":1677500544072,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"cf7a70d4-a166-4ad6-a1b9-28796d6c3d63":{"role":"reader","value":{"id":"cf7a70d4-a166-4ad6-a1b9-28796d6c3d63","version":10,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbibdjgitaj31q80meank.jpg"]]},"format":{"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbibdjgitaj31q80meank.jpg"},"created_time":1677500531533,"last_edited_time":1677500534213,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"0123f31d-9175-4e75-a1f2-5bd45fcfb612":{"role":"reader","value":{"id":"0123f31d-9175-4e75-a1f2-5bd45fcfb612","version":651,"type":"text","properties":{"title":[["为了能够异步执行写入消息队列的动作，又能继承来自request context中的值，我们可以编写自定义的context，只继承父context的值。"]]},"created_time":1677500545956,"last_edited_time":1677500738419,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"3dd7eaf0-156f-4c6a-bdcd-3a55c5fbcb3a":{"role":"reader","value":{"id":"3dd7eaf0-156f-4c6a-bdcd-3a55c5fbcb3a","version":15,"type":"code","properties":{"title":[["type detach struct {\n\tctx context.Context\n}\n\nfunc (d detach) Deadline() (time.Time, bool) {\n\treturn time.Time{}, false\n}\n\nfunc (d detach) Done() \u003c-chan struct{} {\n\treturn nil\n}\n\nfunc (d detach) Err() error {\n\treturn nil\n}\n\nfunc (d detach) Value(key any) any {\n\treturn d.ctx.Value(key)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n\tresponse, err := doSomeTask(r.Context(), r)\n\tif err != nil {\n\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n\t\treturn\n\t}\n\n\tgo func() {\n\t\terr := publish(detach{ctx: r.Context()}, response)\n\t\t// Do something with err\n\t\t_ = err\n\t}()\n\n\twriteResponse(response)\n}"]],"language":[["Go"]]},"created_time":1677500839790,"last_edited_time":1677500855280,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"9f6aff3b-0c78-4ae2-8126-85c866c15393":{"role":"reader","value":{"id":"9f6aff3b-0c78-4ae2-8126-85c866c15393","version":122,"type":"sub_sub_header","properties":{"title":[["9.2 #62: Starting a goroutine without knowing when to stop it（管理好协程）"]]},"created_time":1677504183112,"last_edited_time":1677584499350,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"205795a0-9ae6-4bb9-b9b4-84402296fb54":{"role":"reader","value":{"id":"205795a0-9ae6-4bb9-b9b4-84402296fb54","version":7,"type":"code","properties":{"title":[["func main() {\n\tw := newWatcher()\n\tdefer w.close()\n\n\t// Run the application\n}\n\nfunc newWatcher() watcher {\n\tw := watcher{}\n\tgo w.watch()\n\treturn w\n}\n\ntype watcher struct { /* Some resources */\n}\n\nfunc (w watcher) watch() {}\n\nfunc (w watcher) close() {\n\t// Close the resources\n}"]],"language":[["Go"]]},"created_time":1677505028826,"last_edited_time":1677505029303,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"255963cd-490e-4c81-be70-d07858aaa2ee":{"role":"reader","value":{"id":"255963cd-490e-4c81-be70-d07858aaa2ee","version":309,"type":"sub_sub_header","properties":{"title":[["9.3 #63: Not being careful with goroutines and loop variables（在range loop中执行协程，注意不要引用range生成的变量）"]]},"created_time":1677591205610,"last_edited_time":1677591266570,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"dfcc4d98-61f4-49eb-8dea-e93e16f9ca93":{"role":"reader","value":{"id":"dfcc4d98-61f4-49eb-8dea-e93e16f9ca93","version":58,"type":"text","properties":{"title":[["参考 "],["#30",[["a","https://yangsoon.github.io/100-go-mistakes-and-how-to-avoid-them--1#f78ef2507ea64ebda88578bfb188720c"]]]]},"created_time":1677591460957,"last_edited_time":1677591488995,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"c1fd97d9-c1ee-4dd1-9332-36d5595b086c":{"role":"reader","value":{"id":"c1fd97d9-c1ee-4dd1-9332-36d5595b086c","version":316,"type":"code","properties":{"title":[["func listing1() {\n\ts := []int{1, 2, 3}\n\t// 协程打印的结果可能会出现相同的值\n\tfor _, i := range s {\n\t\tgo func() {\n\t\t\tfmt.Print(i)\n\t\t}()\n\t}\n}\n// 解决方案一\nfunc listing2() {\n\ts := []int{1, 2, 3}\n\t\n\tfor _, i := range s {\n\t\tval := i\n\t\tgo func() {\n\t\t\tfmt.Print(val)\n\t\t}()\n\t}\n}\n// 解决方案二\nfunc listing3() {\n\ts := []int{1, 2, 3}\n\n\tfor _, i := range s {\n\t\tgo func(val int) {\n\t\t\tfmt.Print(val)\n\t\t}(i)\n\t}\n}"]],"language":[["Go"]]},"created_time":1677591299358,"last_edited_time":1677591360248,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"cc925770-1c7b-4ae5-823f-025bd222029b":{"role":"reader","value":{"id":"cc925770-1c7b-4ae5-823f-025bd222029b","version":125,"type":"sub_sub_header","properties":{"title":[["9.4 #64: Expecting deterministic behavior using select and channels（错误的以为 select 的执行结果是确定的）"]]},"created_time":1677591368970,"last_edited_time":1677591504407,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"fccf2654-571d-4d20-9226-6509e082c70c":{"role":"reader","value":{"id":"fccf2654-571d-4d20-9226-6509e082c70c","version":160,"type":"bulleted_list","properties":{"title":[["select 中的 case 执行时机是随机的"]]},"created_time":1677591967665,"last_edited_time":1677591986597,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"4c4b43ef-4eda-4ed2-9773-699c3d1943db":{"role":"reader","value":{"id":"4c4b43ef-4eda-4ed2-9773-699c3d1943db","version":10,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbjjepyykqj31ca0lg47c.jpg"]]},"format":{"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbjjepyykqj31ca0lg47c.jpg"},"created_time":1677591938850,"last_edited_time":1677591941495,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"34f14f8a-4616-4a18-9c69-89de6aa6781c":{"role":"reader","value":{"id":"34f14f8a-4616-4a18-9c69-89de6aa6781c","version":110,"type":"text","properties":{"title":[["解决方案可以是使用for-select嵌套："]]},"created_time":1677591988917,"last_edited_time":1677592058492,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"ae22c659-1211-43ce-9e83-5a792f1a021a":{"role":"reader","value":{"id":"ae22c659-1211-43ce-9e83-5a792f1a021a","version":15,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbjjgb39klj310s0juwh4.jpg"]]},"format":{"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbjjgb39klj310s0juwh4.jpg"},"created_time":1677592042520,"last_edited_time":1677592777461,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"0adc0022-5b09-49c5-93a9-1ba31aff7abb":{"role":"reader","value":{"id":"0adc0022-5b09-49c5-93a9-1ba31aff7abb","version":315,"type":"sub_sub_header","properties":{"title":[["9.5 #65: Not using notification channels（chan struct{} 可以用于通知事件）"]]},"created_time":1677593408024,"last_edited_time":1677593491928,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"9dded198-efb5-4a1e-bcd0-b9b75f8ec55b":{"role":"reader","value":{"id":"9dded198-efb5-4a1e-bcd0-b9b75f8ec55b","version":149,"type":"code","properties":{"title":[["// struct{} 不占用内存，经常用于通知场景\nchan struct{}"]],"language":[["Go"]]},"created_time":1677593513327,"last_edited_time":1677593542196,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"1f280e09-a0dd-4216-8597-b64b70fef159":{"role":"reader","value":{"id":"1f280e09-a0dd-4216-8597-b64b70fef159","version":4,"type":"sub_sub_header","properties":{"title":[["9.6 #66: Not using nil channels（利用nil的channel读写都会block的特性）"]]},"created_time":1677592067975,"last_edited_time":1677593400350,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"0715f0c5-5f79-4522-a41f-27233d9ed647":{"role":"reader","value":{"id":"0715f0c5-5f79-4522-a41f-27233d9ed647","version":12,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbjjsatms6j310a0m8q8p.jpg"]]},"format":{"block_width":480,"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbjjsatms6j310a0m8q8p.jpg","block_full_width":false,"block_page_width":false},"created_time":1677592780340,"last_edited_time":1677592805253,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"7d4a3d12-9804-40f6-a658-97353929b8e6":{"role":"reader","value":{"id":"7d4a3d12-9804-40f6-a658-97353929b8e6","version":331,"type":"bulleted_list","properties":{"title":[["GO对于close的channel仍然能够读取到0值，所以需要使用  "],["v, open := \u003c-ch",[["c"]]],[" 语法中的open来判断channel是否被close"]]},"created_time":1677592815786,"last_edited_time":1677592880629,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"8e1c18ad-763a-475e-89f7-e6bc06005ee2":{"role":"reader","value":{"id":"8e1c18ad-763a-475e-89f7-e6bc06005ee2","version":14,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbjjx84ansj31bs10yaip.jpg"]]},"format":{"block_width":576,"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbjjx84ansj31bs10yaip.jpg","block_full_width":false,"block_page_width":false},"created_time":1677593004442,"last_edited_time":1677593289174,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"b8eaa0a4-d435-4ee0-9551-4733f8163b15":{"role":"reader","value":{"id":"b8eaa0a4-d435-4ee0-9551-4733f8163b15","version":433,"type":"text","properties":{"title":[["解决方案：通过 ",[["b"]]],["v, open := \u003c-ch",[["c"],["b"]]],[" 语法判断 chan 是否被close，避免读取0值，close之后的channel置为nil，避免for循环空转",[["b"]]]]},"created_time":1677593187323,"last_edited_time":1677593265394,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"5f0c7c0c-7607-468f-85eb-d4b215228044":{"role":"reader","value":{"id":"5f0c7c0c-7607-468f-85eb-d4b215228044","version":12,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbjjzxzub1j31520s445i.jpg"]]},"format":{"block_width":576,"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbjjzxzub1j31520s445i.jpg","block_full_width":false,"block_page_width":false},"created_time":1677593161482,"last_edited_time":1677593282277,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"08e9a857-ec47-4fdb-8aa9-c5bc48c869ed":{"role":"reader","value":{"id":"08e9a857-ec47-4fdb-8aa9-c5bc48c869ed","version":118,"type":"sub_sub_header","properties":{"title":[["9.7 #67: Being puzzled about channel size（不清楚channel的大小如何设置）"]]},"created_time":1677593315976,"last_edited_time":1677593355635,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"e8cdcd4c-ee40-4960-a078-eafd872eafb5":{"role":"reader","value":{"id":"e8cdcd4c-ee40-4960-a078-eafd872eafb5","version":156,"type":"bulleted_list","properties":{"title":[["无缓存的channel可以用于同步场景"]]},"created_time":1677593597796,"last_edited_time":1677593615906,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"0546b163-58e4-43c3-9e72-b73acad85c60":{"role":"reader","value":{"id":"0546b163-58e4-43c3-9e72-b73acad85c60","version":189,"type":"bulleted_list","properties":{"title":[["带有缓存的channel经常用于传递消息，控制协程数量等等"]]},"created_time":1677593616538,"last_edited_time":1677593654862,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"f2c2e94e-998a-4de7-a5ae-bcf06d550ed8":{"role":"reader","value":{"id":"f2c2e94e-998a-4de7-a5ae-bcf06d550ed8","version":4,"type":"sub_sub_header","properties":{"title":[["9.8 #68: Forgetting about possible side effects with string formatting（字符串格式化可能会带来的并发错误）"]]},"created_time":1677585738834,"last_edited_time":1677593312480,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"ee5bb67f-6ad1-4fab-bb0b-1a7dce24d9c2":{"role":"reader","value":{"id":"ee5bb67f-6ad1-4fab-bb0b-1a7dce24d9c2","version":514,"type":"text","properties":{"title":[["如下例子，在 age \u003c 0 的场景下 UpdateAge 会执行到 fmt.Errorf 函数并打印结构体c，fmt.Errorf会直接调用c结构的 String 方法导致死锁。"]]},"created_time":1677585930924,"last_edited_time":1677586052704,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"f3ffd82d-32aa-4f02-a213-4433dc49ac47":{"role":"reader","value":{"id":"f3ffd82d-32aa-4f02-a213-4433dc49ac47","version":17,"type":"code","properties":{"title":[["type Customer struct {\n\tmutex sync.RWMutex\n\tid    string\n\tage   int\n}\n\nfunc (c *Customer) UpdateAge(age int) error {\n\tc.mutex.Lock()\n\tdefer c.mutex.Unlock()\n\n\tif age \u003c 0 {\n\t\treturn fmt.Errorf(\"age should be positive for customer %v\", c)\n\t}\n\n\tc.age = age\n\treturn nil\n}\n\nfunc (c *Customer) String() string {\n\tc.mutex.RLock()\n\tdefer c.mutex.RUnlock()\n\treturn fmt.Sprintf(\"id %s, age %d\", c.id, c.age)\n}"]],"language":[["Go"]]},"created_time":1677585899992,"last_edited_time":1677585921387,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"6cfd2378-16aa-4971-93d6-409a1d72e941":{"role":"reader","value":{"id":"6cfd2378-16aa-4971-93d6-409a1d72e941","version":332,"type":"text","properties":{"title":[["解决方案是缩小加锁的范围，只在对临界区的值进行修改的时候才加锁"]]},"created_time":1677586219769,"last_edited_time":1677586256695,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"05126ba2-4ec4-4fc7-95da-075532c368a1":{"role":"reader","value":{"id":"05126ba2-4ec4-4fc7-95da-075532c368a1","version":7,"type":"code","properties":{"title":[["func (c *Customer) UpdateAge2(age int) error {\n\tif age \u003c 0 {\n\t\treturn fmt.Errorf(\"age should be positive for customer %v\", c)\n\t}\n\n\tc.mutex.Lock()\n\tdefer c.mutex.Unlock()\n\n\tc.age = age\n\treturn nil\n}"]],"language":[["Go"]]},"created_time":1677586264761,"last_edited_time":1677586277297,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"a48e9d53-4a7b-4ccd-98c6-63a6fa09431b":{"role":"reader","value":{"id":"a48e9d53-4a7b-4ccd-98c6-63a6fa09431b","version":108,"type":"sub_sub_header","properties":{"title":[["9.9 #69: Creating data races with append（使用append函数的时候出现data race）"]]},"created_time":1677586289212,"last_edited_time":1677587250117,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"453398a1-1f7d-4d7f-a1a2-e55388f769ed":{"role":"reader","value":{"id":"453398a1-1f7d-4d7f-a1a2-e55388f769ed","version":113,"type":"bulleted_list","properties":{"title":[["注意append操作不是线程安全的"]]},"created_time":1677587217908,"last_edited_time":1677587234617,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"afeef38e-58d1-41e4-90fb-9eb2c37f6023":{"role":"reader","value":{"id":"afeef38e-58d1-41e4-90fb-9eb2c37f6023","version":10,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbjh3fld7pj31eg0n6n7d.jpg"]]},"format":{"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbjh3fld7pj31eg0n6n7d.jpg"},"created_time":1677587135650,"last_edited_time":1677587146764,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"0ffe02a2-7a29-4bee-80cb-975ea1a74581":{"role":"reader","value":{"id":"0ffe02a2-7a29-4bee-80cb-975ea1a74581","version":143,"type":"sub_sub_header","properties":{"title":[["9.10 #70: Using mutexes inaccurately with slices and maps（错误的给slice和map加锁）"]]},"created_time":1677587292072,"last_edited_time":1677588457576,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"88f060bd-7d3f-4788-ba4e-bfbc76dab641":{"role":"reader","value":{"id":"88f060bd-7d3f-4788-ba4e-bfbc76dab641","version":379,"type":"text","properties":{"title":[["当有2个协程同事调用 AddBalance 和 AverageBalance，还会出现data race，因为 AverageBalance 中对 c.balances 只拷贝引用，对slice同理。"]]},"created_time":1677588471645,"last_edited_time":1677588664006,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"f02802f2-ac92-45b2-9e34-8249cc28f83c":{"role":"reader","value":{"id":"f02802f2-ac92-45b2-9e34-8249cc28f83c","version":9,"type":"code","properties":{"title":[["type Cache struct {\n\tmu       sync.RWMutex\n\tbalances map[string]float64\n}\n\nfunc (c *Cache) AddBalance(id string, balance float64) {\n\tc.mu.Lock()\n\tc.balances[id] = balance\n\tc.mu.Unlock()\n}\n\nfunc (c *Cache) AverageBalance() float64 {\n\tc.mu.RLock()\n\tbalances := c.balances\n\tc.mu.RUnlock()\n\n\tsum := 0.\n\tfor _, balance := range balances {\n\t\tsum += balance\n\t}\n\treturn sum / float64(len(balances))\n}"]],"language":[["Go"]]},"created_time":1677588429369,"last_edited_time":1677588484729,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"beeca050-1653-4a87-b160-10addf066c52":{"role":"reader","value":{"id":"beeca050-1653-4a87-b160-10addf066c52","version":73,"type":"sub_sub_header","properties":{"title":[["9.11 #71: Misusing sync.WaitGroup（错误使用 sync.WaitGroup）"]]},"created_time":1677588675323,"last_edited_time":1677588691782,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"f77b15bb-406e-4855-b5ef-24046fc192d3":{"role":"reader","value":{"id":"f77b15bb-406e-4855-b5ef-24046fc192d3","version":481,"type":"text","properties":{"title":[["因为 for 循环创建的3个协程是异步执行，可能执行到wg.Wait的时候有2个协程已经执行成功并退出了，所以v的值可能为2"]]},"created_time":1677588837747,"last_edited_time":1677588903263,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"96d2f9c4-34eb-4e34-bb63-49498741c591":{"role":"reader","value":{"id":"96d2f9c4-34eb-4e34-bb63-49498741c591","version":16,"type":"code","properties":{"title":[["func main() {\n\twg := sync.WaitGroup{}\n\tvar v uint64\n\n\tfor i := 0; i \u003c 3; i++ {\n\t\tgo func() {\n\t\t\twg.Add(1)\n\t\t\tatomic.AddUint64(\u0026v, 1)\n\t\t\twg.Done()\n\t\t}()\n\t}\n\n\twg.Wait()\n\tfmt.Println(v)\n}"]],"language":[["Go"]]},"created_time":1677588834994,"last_edited_time":1677588841705,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"8d247983-4f18-442d-a7c4-b6bbb17290c7":{"role":"reader","value":{"id":"8d247983-4f18-442d-a7c4-b6bbb17290c7","version":76,"type":"text","properties":{"title":[["解决方案一"]]},"created_time":1677588917705,"last_edited_time":1677588941291,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"1246aa68-9cc7-4a6e-a08c-52954f88c4ff":{"role":"reader","value":{"id":"1246aa68-9cc7-4a6e-a08c-52954f88c4ff","version":16,"type":"code","properties":{"title":[["func main() {\n\twg := sync.WaitGroup{}\n\tvar v uint64\n\n\twg.Add(3)\n\tfor i := 0; i \u003c 3; i++ {\n\t\tgo func() {\n\t\t\tatomic.AddUint64(\u0026v, 1)\n\t\t\twg.Done()\n\t\t}()\n\t}\n\n\twg.Wait()\n\tfmt.Println(v)\n}"]],"language":[["Go"]]},"created_time":1677588927865,"last_edited_time":1677588931024,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"6c29ce3f-4eed-49b5-93c8-58df7a2a7e2b":{"role":"reader","value":{"id":"6c29ce3f-4eed-49b5-93c8-58df7a2a7e2b","version":37,"type":"text","properties":{"title":[["解决方案二"]]},"created_time":1677588942483,"last_edited_time":1677588945454,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"cd5ee62f-517b-47ff-9a8c-8225dda1402b":{"role":"reader","value":{"id":"cd5ee62f-517b-47ff-9a8c-8225dda1402b","version":16,"type":"code","properties":{"title":[["func main() {\n\twg := sync.WaitGroup{}\n\tvar v uint64\n\n\tfor i := 0; i \u003c 3; i++ {\n\t\twg.Add(1)\n\t\tgo func() {\n\t\t\tatomic.AddUint64(\u0026v, 1)\n\t\t\twg.Done()\n\t\t}()\n\t}\n\n\twg.Wait()\n\tfmt.Println(v)\n}"]],"language":[["Go"]]},"created_time":1677588950128,"last_edited_time":1677588954446,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"21c7ccf6-a336-4bb6-bcfa-675201e730b7":{"role":"reader","value":{"id":"21c7ccf6-a336-4bb6-bcfa-675201e730b7","version":156,"type":"sub_sub_header","properties":{"title":[["9.12 #72: Forgetting about sync.Cond（别忘记条件变量sync.Cond）"]]},"created_time":1677588963802,"last_edited_time":1677589298529,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"b2f26809-9764-4f19-a034-22447742004b":{"role":"reader","value":{"id":"b2f26809-9764-4f19-a034-22447742004b","version":12,"type":"bookmark","properties":{"link":[["https://geektutu.com/post/hpg-sync-cond.html"]],"title":[["Go sync.Cond | Go 语言高性能编程 | 极客兔兔"]],"description":[["Go 语言/golang 高性能编程，Go 语言进阶教程，Go 语言高性能编程(high performance go)。sync.Cond 是一个条件锁，也被称为条件变量，常用来一写多读(一个 goroutine 通知多个在等待的 goroutines)的场景。"]]},"format":{"bookmark_icon":"https://geektutu.com/img/icon.png"},"created_time":1677589948088,"last_edited_time":1677589951099,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"27550b2d-9cb9-4723-ab32-e19460bbdaf3":{"role":"reader","value":{"id":"27550b2d-9cb9-4723-ab32-e19460bbdaf3","version":18,"type":"code","properties":{"title":[["func main() {\n\ttype Donation struct {\n\t\tcond    *sync.Cond\n\t\tbalance int\n\t}\n\n\tdonation := \u0026Donation{\n\t\tcond: sync.NewCond(\u0026sync.Mutex{}),\n\t}\n\n\t// Listener goroutines\n\tf := func(goal int) {\n\t\tdonation.cond.L.Lock()\n\t\tfor donation.balance \u003c goal {\n\t\t\tdonation.cond.Wait()\n\t\t}\n\t\tfmt.Printf(\"%d$ goal reached\\n\", donation.balance)\n\t\tdonation.cond.L.Unlock()\n\t}\n\n\tgo f(10)\n\tgo f(15)\n\n\t// Updater goroutine\n\tfor {\n\t\ttime.Sleep(time.Second)\n\t\tdonation.cond.L.Lock()\n\t\tdonation.balance++\n\t\tdonation.cond.L.Unlock()\n\t\tdonation.cond.Broadcast()\n\t}\n}"]],"language":[["Go"]]},"created_time":1677589635249,"last_edited_time":1677589766952,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"1403eaf6-6acf-49a0-a0bf-63b7110b08c8":{"role":"reader","value":{"id":"1403eaf6-6acf-49a0-a0bf-63b7110b08c8","version":105,"type":"text","properties":{"title":[["使用Cond可以避免CPU空转的情况。"]]},"created_time":1677589733364,"last_edited_time":1677589996924,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"05073c8f-5ad7-409a-a745-19510ffa810a":{"role":"reader","value":{"id":"05073c8f-5ad7-409a-a745-19510ffa810a","version":143,"type":"sub_sub_header","properties":{"title":[["9.13 #73: Not using errgroup（使用 errgroup 采集多个协程执行结果）"]]},"created_time":1677590004183,"last_edited_time":1677590120396,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"2ae63cfd-1c6e-4115-95d8-8c9cdad6ed48":{"role":"reader","value":{"id":"2ae63cfd-1c6e-4115-95d8-8c9cdad6ed48","version":10,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbjiirbgghj31f60hywhb.jpg"]]},"format":{"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbjiirbgghj31f60hywhb.jpg"},"created_time":1677590095233,"last_edited_time":1677590098427,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"57ce497e-3cf8-49bc-b7d8-0b07f519d22f":{"role":"reader","value":{"id":"57ce497e-3cf8-49bc-b7d8-0b07f519d22f","version":375,"type":"text","properties":{"title":[["使用 "],["golang.org/x/sync/errgroup",[["a","http://golang.org/x/sync/errgroup"]]],[" 采集多个协程的错误, 但是 errorgroup限制比较多，需要函数签名符合"],["func() error {}",[["c"]]],[" "]]},"created_time":1677590258919,"last_edited_time":1677590862217,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"f399ca3f-f7da-4e33-897a-2bec1ce11812":{"role":"reader","value":{"id":"f399ca3f-f7da-4e33-897a-2bec1ce11812","version":10,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbjiqad262j31aq0rsaib.jpg"]]},"format":{"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbjiqad262j31aq0rsaib.jpg"},"created_time":1677590528818,"last_edited_time":1677590531589,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"13051c2f-d259-4003-8708-bd92d9da1e65":{"role":"reader","value":{"id":"13051c2f-d259-4003-8708-bd92d9da1e65","version":15,"type":"text","properties":{"title":[["k8s 中提供了集合多种错误的功能，可以参考 k8s.io/apimachinery/pkg/util/errors/errors.go:35"]]},"created_time":1677590863928,"last_edited_time":1677590864462,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"025990b7-1780-448e-bddb-c41d3b01a39d":{"role":"reader","value":{"id":"025990b7-1780-448e-bddb-c41d3b01a39d","version":133,"type":"sub_sub_header","properties":{"title":[["9.14 #74: Copying a sync type（同步类型的值不能被拷贝）"]]},"created_time":1677590673494,"last_edited_time":1677591145654,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"ab42b85c-e154-496c-89b6-fe46d0422f90":{"role":"reader","value":{"id":"ab42b85c-e154-496c-89b6-fe46d0422f90","version":12,"type":"image","properties":{"source":[["http://tva1.sinaimg.cn/large/006r0i4lly1hbjj0adk20j31200i2q9f.jpg"]]},"format":{"block_width":528,"display_source":"http://tva1.sinaimg.cn/large/006r0i4lly1hbjj0adk20j31200i2q9f.jpg","block_full_width":false,"block_page_width":false},"created_time":1677591105009,"last_edited_time":1677591118548,"parent_id":"f8e41082-81f4-4d47-a6f3-3489e7c3453c","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"dd2baae1-8900-4073-854b-bdde392d5b36":{"role":"reader","value":{"id":"dd2baae1-8900-4073-854b-bdde392d5b36","version":169,"type":"page","properties":{"title":[["关于作者"]]},"content":["1d759e84-b1ff-4bae-857e-e2fd95fa9b45","e34dbc42-98d0-4e1d-ad9e-dc6631aa7273","3c187b42-de80-4359-b13b-5c778a6f49a6","274ad047-a46e-4187-b438-129e6cfd5cc8","ade9b3ae-520f-4752-87d4-52a41bb1d875","770dde4e-b74e-4848-8b48-8b1ce3c111ea","2ca1f27b-da43-46f8-b8c0-ef3e05e583d9"],"format":{"page_icon":"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/020bfbea-dbb3-44dd-b5aa-5048fb71462f/IMG_2189.jpg","page_cover":"/images/page-cover/gradients_8.png","page_cover_position":0.3},"permissions":[{"role":"editor","type":"user_permission","user_id":"d1805983-7869-451d-bf8b-64135a5d4ee7"},{"role":"reader","type":"public_permission","added_timestamp":1666532032810}],"created_time":1666531980000,"last_edited_time":1677594616244,"parent_id":"314bb437-f8b5-44ca-a749-b2b1413baa58","parent_table":"block","alive":true,"file_ids":["5349e794-a695-40dd-8bb5-4ea012d8b3f0","0dba7a3b-a420-477f-a184-076421f71ce6","020bfbea-dbb3-44dd-b5aa-5048fb71462f"],"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"314bb437-f8b5-44ca-a749-b2b1413baa58":{"role":"reader","value":{"id":"314bb437-f8b5-44ca-a749-b2b1413baa58","version":5,"type":"column","content":["dd2baae1-8900-4073-854b-bdde392d5b36"],"format":{"column_ratio":0.5},"created_time":1666625040000,"last_edited_time":1666625040000,"parent_id":"82aad922-cb77-4452-81bf-56f4e8e5a408","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"82aad922-cb77-4452-81bf-56f4e8e5a408":{"role":"reader","value":{"id":"82aad922-cb77-4452-81bf-56f4e8e5a408","version":5,"type":"column_list","content":["314bb437-f8b5-44ca-a749-b2b1413baa58","c7c8db4e-2a84-4461-9042-c0ccd0c86b7a"],"created_time":1666625040000,"last_edited_time":1666625040000,"parent_id":"72a66971-7cf6-42c2-a252-4439d99d8f44","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}},"1d759e84-b1ff-4bae-857e-e2fd95fa9b45":{"role":"reader","value":{"id":"1d759e84-b1ff-4bae-857e-e2fd95fa9b45","version":39,"type":"sub_header","properties":{"title":[["About Me"]]},"created_time":1677585426899,"last_edited_time":1677585433015,"parent_id":"dd2baae1-8900-4073-854b-bdde392d5b36","parent_table":"block","alive":true,"created_by_table":"notion_user","created_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","last_edited_by_table":"notion_user","last_edited_by_id":"d1805983-7869-451d-bf8b-64135a5d4ee7","space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}}},"collection":{"89829c97-9e4b-43b0-b37c-457a3da9ad96":{"role":"reader","value":{"id":"89829c97-9e4b-43b0-b37c-457a3da9ad96","version":50,"name":[["读书笔记"]],"schema":{"Zr\u003cq":{"name":"Tags","type":"multi_select","options":[{"id":"24b84736-a103-42ac-9240-4822e0f65e43","color":"brown","value":"golang"}]},"vRhJ":{"name":"Created","type":"created_time"},"z`pV":{"name":"Text","type":"text"},"title":{"name":"Name","type":"title"}},"icon":"/icons/book_gray.svg","format":{"copied_from_pointer":{"id":"802f1041-8e8c-4dfb-9a7e-828adc379fe9","table":"collection","spaceId":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"},"collection_page_properties":[{"visible":true,"property":"vRhJ"},{"visible":true,"property":"Zr\u003cq"}]},"parent_id":"e7596c25-bafa-4ece-94b6-e7973c7a2ab3","parent_table":"block","alive":true,"file_ids":["bc7d6ffa-a7ed-4623-9b4b-760071f91143","53747170-d36e-41e1-b2b7-bc3fe775c828","2f5c27c6-3d03-4a36-9426-254d118d3831","43cb5540-5d53-449b-83bd-609b24688d0b","982ec7e7-aebe-4e08-b2be-22f8f4fe0275","85f9e952-304a-46a7-99e1-0b8806f8fa2e","76a743a7-2ac6-426f-810b-87b2b7091d16"],"copied_from":"802f1041-8e8c-4dfb-9a7e-828adc379fe9","migrated":true,"space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}}},"collection_view":{"11f62eb2-ba92-4ffd-91b4-c964b8cedfeb":{"role":"reader","value":{"id":"11f62eb2-ba92-4ffd-91b4-c964b8cedfeb","version":7,"type":"gallery","name":"Blog","format":{"gallery_cover":{"type":"page_cover"},"collection_pointer":{"id":"89829c97-9e4b-43b0-b37c-457a3da9ad96","table":"collection","spaceId":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"},"gallery_properties":[{"visible":true,"property":"title"},{"visible":true,"property":"vRhJ"},{"visible":true,"property":"Zr\u003cq"},{"visible":true,"property":"z`pV"}],"collection_peek_mode":"full_page","gallery_cover_aspect":"cover"},"parent_id":"e7596c25-bafa-4ece-94b6-e7973c7a2ab3","parent_table":"block","alive":true,"page_sort":["6838510a-0002-4284-b31b-f6587ab3eae0","d3ecd552-789f-452c-8753-2f0226325f65","a8bd2ec9-1288-4669-9940-ad46c5539100","3397e27f-0e8a-49b8-89ae-67d10e3d94fa","db80f497-e22c-4bff-bdcb-0ac06b5c4528","f8e41082-81f4-4d47-a6f3-3489e7c3453c","e04337ab-49dd-4dfe-80b2-0330e8da5e06"],"query2":{"aggregations":[{"aggregator":"count"}]},"space_id":"fe0e4127-6cf7-4d6d-8491-aa23773532f6"}}},"notion_user":{},"collection_query":{},"signed_urls":{"f8e41082-81f4-4d47-a6f3-3489e7c3453c":"https://s3.us-west-2.amazonaws.com/secure.notion-static.com/47263733-11bc-4ae7-9e1e-c3401a49c171/Manning.100.Go.Mistakes.and.How.to.Avoid.Them.2022-1%EF%BC%88%E6%8B%96%E7%A7%BB%E9%A1%B9%E7%9B%AE%EF%BC%89.png?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Content-Sha256=UNSIGNED-PAYLOAD\u0026X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20230228%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20230228T143121Z\u0026X-Amz-Expires=86400\u0026X-Amz-Signature=618f3b0cf8993b7aafd15b24a7058707d5a8b85de3dc097559affe3d0b4eeea5\u0026X-Amz-SignedHeaders=host\u0026x-id=GetObject"},"preview_images":{"notion.so/image/s3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F47263733-11bc-4ae7-9e1e-c3401a49c171%2FManning.100.Go.Mistakes.and.How.to.Avoid.Them.2022-1%EF%BC%88%E6%8B%96%E7%A7%BB%E9%A1%B9%E7%9B%AE%EF%BC%89.png":{"originalWidth":2000,"originalHeight":2508,"dataURIBase64":"data:image/webp;base64,UklGRkoAAABXRUJQVlA4ID4AAACQAQCdASoNABAABUB8JZQAAUJYnCAA/i3sgO0Yegdb+5LvlWhw/psHDLyVDpX8zYYcjaZB/BXtD4y71SAAAA=="},"notion.so/image/s3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa22fb73f-5a7d-4fdc-8319-52ed15316e76%2Fimages.jpeg":{"originalWidth":2000,"originalHeight":1159,"dataURIBase64":"data:image/webp;base64,UklGRjwAAABXRUJQVlA4IDAAAACwAQCdASoQAAkABUB8JQAAT6/36IiAAP4EcU3AJPD5WZWYi6rGw+MWNhG0kKdLMAA="},"notion.so/image/s3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F37907dd5-3c76-4966-a419-daa027a84972%2FIMG_2189.jpg":{"originalWidth":2000,"originalHeight":2003,"dataURIBase64":"data:image/webp;base64,UklGRmoAAABXRUJQVlA4IF4AAADQAQCdASoQABAABUB8JbACdAERATxWoAD+0Vlxx+kOh3kDC0Z3s4OjUZzRpnTiXUiN5qtuCLGbw3Q3meKHmbJDj3X9KoWlb/kas/KasMX31nkEcPwD09TPGVsO8AAA"},"notion.so/image/img2.doubanio.com%2Fview%2Fsubject%2Fl%2Fpublic%2Fs34311243.jpg":{"originalWidth":2000,"originalHeight":2507,"dataURIBase64":"data:image/webp;base64,UklGRk4AAABXRUJQVlA4IEIAAACwAQCdASoNABAABUB8JZQAAcCzMdgAAP1pPb5smyxoh54e7LDGK8Yk2gEHbh/20RBmhShKjfB1bjvvEl7pU7XAAAA="},"notion.so/image/img1.doubanio.com%2Ffavicon.ico":null,"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbfjzjehr4j30tc0ccq5c.jpg":{"originalWidth":2000,"originalHeight":841,"dataURIBase64":"data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAAAwAQCdASoQAAcABUB8JZQAA3AA/vBmGaPoMMfT+4RThezUN53k8lwNzeTsgAAA"},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbfjzrczn0j30t00bmgnc.jpg":{"originalWidth":2000,"originalHeight":801,"dataURIBase64":"data:image/webp;base64,UklGRjYAAABXRUJQVlA4ICoAAACQAQCdASoQAAYABUB8JZQAApuLmvgA/usyeOnRnoxEhb3C52zBu7IA3AA="},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbfkkxdgp1j31gw0i6tel.jpg":{"originalWidth":2000,"originalHeight":687,"dataURIBase64":"data:image/webp;base64,UklGRiwAAABXRUJQVlA4ICAAAACQAQCdASoQAAUABUB8JZwAAudR6dAA/sYFJUtPYAAAAA=="},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbfqoq89goj31ja0tmani.jpg":{"originalWidth":2000,"originalHeight":1071,"dataURIBase64":"data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACwAQCdASoQAAkABUB8JQAAXOudR8AAAP7tzTjaDKMHDJ3iIuQAAyBaRRsyGwAA"},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbfr8gkmhjj319a0hatdy.jpg":{"originalWidth":2000,"originalHeight":763,"dataURIBase64":"data:image/webp;base64,UklGRjAAAABXRUJQVlA4ICQAAAAwAQCdASoQAAYABUB8JYwAA3AA/vBl/VgRnYjho4mzKY1AAAA="},"notion.so/image/golang.design%2Funder-the-hood%2Ffavicon.png":{"originalWidth":2000,"originalHeight":2000,"dataURIBase64":"data:image/webp;base64,UklGRnwAAABXRUJQVlA4WAoAAAAQAAAADwAADwAAQUxQSD0AAAARL0AWYJocyO4IEugqIgK/FAohSXLmEE5hFR4hGPz6w3w2iOj/BPB/2HYPtOSwLIPa5mAvSdOwHUBmJj8BAFZQOCAYAAAAMAEAnQEqEAAQAAVAfCWkAANwAP7w5sAA"},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbibdjgitaj31q80meank.jpg":{"originalWidth":2000,"originalHeight":720,"dataURIBase64":"data:image/webp;base64,UklGRkIAAABXRUJQVlA4IDYAAADwAQCdASoQAAYABUB8JQBdgCIhCA5MkBgA/u/D+wKXNbqWDcr/ALDtIhD/DxlKxDxIjiT4AAA="},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjjepyykqj31ca0lg47c.jpg":{"originalWidth":2000,"originalHeight":888,"dataURIBase64":"data:image/webp;base64,UklGRkAAAABXRUJQVlA4IDQAAABwAQCdASoQAAcABUB8JQAAXILjAAD+78P0LX+qJKHEgMI0ar+zRjIgffCYuPUeFApoAAAA"},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjjgb39klj310s0juwh4.jpg":{"originalWidth":2000,"originalHeight":1079,"dataURIBase64":"data:image/webp;base64,UklGRigAAABXRUJQVlA4IBwAAAAwAQCdASoQAAkABUB8JaQAA3AA/vCTr0unFgAA"},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjjsatms6j310a0m8q8p.jpg":{"originalWidth":2000,"originalHeight":1225,"dataURIBase64":"data:image/webp;base64,UklGRkQAAABXRUJQVlA4IDgAAADQAQCdASoQAAoABUB8JZAAAudSvXUaAAD+78Nlqe7GDD+q7mOMW/2C5MYVqQTcWQBmV3rBjogAAA=="},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjjx84ansj31bs10yaip.jpg":{"originalWidth":2000,"originalHeight":1547,"dataURIBase64":"data:image/webp;base64,UklGRjQAAABXRUJQVlA4ICgAAABwAQCdASoQAAwABUB8JQAAXOi1gAD+78PTalf6BwRerTmRXpyaRDAA"},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjjzxzub1j31520s445i.jpg":{"originalWidth":2000,"originalHeight":1369,"dataURIBase64":"data:image/webp;base64,UklGRjgAAABXRUJQVlA4ICwAAACwAQCdASoQAAsABUB8JQAAXQXhlZwAAP7vvWec+Y0zLFdOWoXJvR5h4AAAAA=="},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjh3fld7pj31eg0n6n7d.jpg":{"originalWidth":2000,"originalHeight":919,"dataURIBase64":"data:image/webp;base64,UklGRjQAAABXRUJQVlA4ICgAAACwAQCdASoQAAcABUB8JZQAAxZgjkQAAP7nrpu3K66aoH3cjtsAS8gA"},"notion.so/image/geektutu.com%2Fimg%2Ficon.png":{"originalWidth":2000,"originalHeight":2000,"dataURIBase64":"data:image/webp;base64,UklGRmYAAABXRUJQVlA4IFoAAABwAgCdASoQABAABUB8JbACdH8AFC6wyImyc7DAAPaOm7ZuB9T9glxeiEuAabs/A/Yx58LekgPLrFy+aWU25Bqx00Pi1ZMHr4aDoxmAEN/qo7Ux6LN80bBgAAA="},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjiirbgghj31f60hywhb.jpg":{"originalWidth":2000,"originalHeight":701,"dataURIBase64":"data:image/webp;base64,UklGRigAAABXRUJQVlA4IBwAAAAwAQCdASoQAAYABUB8JaQAA3AA/vBnJdvxRIAA"},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjiqad262j31aq0rsaib.jpg":{"originalWidth":2000,"originalHeight":1189,"dataURIBase64":"data:image/webp;base64,UklGRjIAAABXRUJQVlA4ICYAAAAwAQCdASoQAAoABUB8JZwAA3AA/vBkMLPCIt2QO3UjS1tNtwaAAA=="},"notion.so/image/tva1.sinaimg.cn%2Flarge%2F006r0i4lly1hbjj0adk20j31200i2q9f.jpg":{"originalWidth":2000,"originalHeight":950,"dataURIBase64":"data:image/webp;base64,UklGRjwAAABXRUJQVlA4IDAAAACwAQCdASoQAAgABUB8JQAAXUjdZLLAAP7vxEd0wiRocXfi5fbFND1NmUxfYhGGAAA="},"notion.so/image/notion.so%2Fimages%2Fpage-cover%2Fgradients_8.png":{"originalWidth":2000,"originalHeight":2000,"dataURIBase64":"data:image/webp;base64,UklGRjwAAABXRUJQVlA4IDAAAAAQAgCdASoQABAABUB8JbACdAD0rs0LxfQAAN2Q17E9Qv7sg8pZvQfdquRRRGrAAAA="},"notion.so/image/s3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F020bfbea-dbb3-44dd-b5aa-5048fb71462f%2FIMG_2189.jpg":{"originalWidth":2000,"originalHeight":2003,"dataURIBase64":"data:image/webp;base64,UklGRmoAAABXRUJQVlA4IF4AAADQAQCdASoQABAABUB8JbACdAERATxWoAD+0Vlxx+kOh3kDC0Z3s4OjUZzRpnTiXUiN5qtuCLGbw3Q3meKHmbJDj3X9KoWlb/kas/KasMX31nkEcPwD09TPGVsO8AAA"}}},"pageId":"f8e41082-81f4-4d47-a6f3-3489e7c3453c"},"__N_SSG":true},"page":"/[pageId]","query":{"pageId":"100-go-mistakes-and-how-to-avoid-them--2"},"buildId":"0jlsjuX7o0EQ7wPlD8p0p","isFallback":false,"dynamicIds":[635,3358],"gsp":true,"scriptLoader":[]}</script></body></html>