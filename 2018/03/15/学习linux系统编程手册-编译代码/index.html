<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 学习linux/unix系统编程手册-编译代码 · yangsoon</title><meta name="description" content="学习linux/unix系统编程手册-编译代码 - yangs"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://yangsoon.github.io/atom.xml" title="yangsoon"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/yangsoon" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">学习linux/unix系统编程手册-编译代码</h1><div class="post-info">2018年3月15日</div><div class="post-content"><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>发现每次写文章都要加个前言来瞎扯一波，最近在找实习，之前以为大四上就比较无聊了，后来发现大四下更无聊，不过也有时间来学一些自己喜欢的东西，但是经常会学着学着就打开抖音看小姐姐了，这样不行不行… 所以就要求自己争取每周都能写几篇文章来记录都学了什么。上学期的时候买了一本《linux/unix系统编程手册》里面有相应的demo代码，于是想编译一下，没错我在终端里输入了 <code>gcc demo.c</code> 。结果可想而知报了一大推错。这篇文章是小白记录文，大神就不用看了。</p>
<a id="more"></a>
<h3 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h3><h4 id="1-gcc-I"><a href="#1-gcc-I" class="headerlink" title="1. gcc -I"></a>1. <code>gcc -I</code></h4><p>执行<code>gcc demo.c</code>之后，会出现这样的报错。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">seek_io.c:4:22: 致命错误：tlpi_hdr.h：没有那个文件或目录</div><div class="line"> #include &quot;tlpi_hdr.h&quot;</div><div class="line">                      ^</div><div class="line">编译中断。</div></pre></td></tr></table></figure>
<p>因为没有指定头文件<code>tlpi_hdr.h</code>的路径，所以编译器无法找到指定的头文件，所以我们需要给gcc指定对应的头文件所在路径。当然可以修改源码，用相对/绝对路径调用头文件。但是这样显然不好，如果任何文件位置发生变化，都要再次修改源码。</p>
<p>gcc有-I这个选项，可以把include “…”包含的文件路径放在-I后面。于是做了如下修改：</p>
<p>执行 <code>gcc -I /home/vagrant/project/tlpi-dist/lib demo.c</code>但是还是报错:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">/tmp/ccj4Ei8K.o：在函数‘main’中：</div><div class="line">seek_io.c:(.text+0x46)：对‘usageErr’未定义的引用</div><div class="line">seek_io.c:(.text+0x80)：对‘errExit’未定义的引用</div><div class="line">seek_io.c:(.text+0x125)：对‘getLong’未定义的引用</div><div class="line">seek_io.c:(.text+0x165)：对‘errExit’未定义的引用</div><div class="line">seek_io.c:(.text+0x194)：对‘errExit’未定义的引用</div><div class="line">collect2: 错误：ld 返回 1</div></pre></td></tr></table></figure>
<h4 id="2-链接"><a href="#2-链接" class="headerlink" title="2. 链接"></a>2. 链接</h4><p>之后在网上查阅资料才知道，出现这种情况的原因，主要是C/C++编译为obj文件的时候并不需要函数的具体实现，只要有函数的原型即可。但是在链接为可执行文件的时候就必须要具体的实现了。如果错误是未声明的引用，那就是找不到函数的原型。</p>
<p>下面简单的说一下gcc编译流程 1. 预处理阶段 2. 编译阶段 3. 汇编阶段 4. 链接阶段</p>
<p>问题就出现在链接阶段，程序中没有定义一系列函数的实现，所以会报出上面的错误。函数库一般分为静态库和动态库两种。静态库是指编译链接时，把库文件的代码全部加入到可执行文件中，因此生成的文件比较大，但在运行时也就不再需要库文件了。其后缀名一般为”.a”。动态库与之相反，在编译链接时并没有把库文件的代码加入到可执行文件中，而是在程序执行时由运行时链接文件加载库，这样可以节省系统的开销。动态库一般后缀名为”.so”。</p>
<p>这时候就需要我们指定函数库的位置。很高兴，tlpi帮我们打包好了。所以继续修改:</p>
<p><code>gcc -I /home/vagrant/project/tlpi-dist/lib demo.c /home/vagrant/project/tlpi-dist/libtlpi.a</code> </p>
<p>至此我们可以编译demo.c代码了，但是每次都要输入一堆路径，确实有些烦，为了能在各处写代码，还不用输入一大堆路径，我就写了一个简单的shell脚本。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">export TLPI_PATH="/home/vagrant/project/tlpi-dist"</div><div class="line">function glink()&#123;</div><div class="line">    if [ $# -ne 1 ]</div><div class="line">    then</div><div class="line">      echo "请输入一个程序名"</div><div class="line">      return</div><div class="line">    else</div><div class="line">      name=$1</div><div class="line">      echo "gcc -I $&#123;TLPI_PATH&#125;/lib $1 $&#123;TLPI_PATH&#125;/libtlpi.a -o $&#123;name%.*&#125;.o"</div><div class="line">      gcc -I $&#123;TLPI_PATH&#125;/lib $1 $&#123;TLPI_PATH&#125;/libtlpi.a -o $&#123;name%.*&#125;.o</div><div class="line">    fi</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>打开<code>.zshrc</code>或者<code>.bashrc</code>文件，加入上面的代码，<code>TLPI_PATH</code>填上你自己的文件路径，之后执行<code>source .zshrc</code>或者<code>source .bashrc</code>。然后可以用 <code>glink demo.c</code>来编译自己的代码。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><blockquote>
<p><a href="http://www.cnblogs.com/xbf9xbf/p/4755458.html" target="_blank" rel="noopener">http://www.cnblogs.com/xbf9xbf/p/4755458.html</a></p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a href="/2018/03/15/python-学习笔记/" class="prev">上一篇</a><a href="/2017/12/18/一个简单的telegram-bot/" class="next">下一篇</a></div><div id="container"></div><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>var gitment = new Gitment({
    id: 'Thu Mar 15 2018 14:22:38 GMT+0800',
    owner: 'yangsoon',
    repo: 'yangsoon.github.io',
    oauth: {
        client_id: 'c6e81705ee274d631d1d',
        client_secret: 'd2366443245bc5528fc5a73af235d9e23d14e33a',
    },
})
gitment.render('container')</script><div class="copyright"><p>© 2015 - 2018 <a href="https://yangsoon.github.io">yangs</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>